!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase,t.firebase.INTERNAL.modularAPIs)}(this,function(ff,gf){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(ff),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function a(t,e){for(var n=0,r=e.length,s=t.length;n<r;n++,s++)t[s]=e[n];return t}function n(t){for(var e=[],n=0,r=0;r<t.length;r++){var s=t.charCodeAt(r);s<128?e[n++]=s:(s<2048?e[n++]=s>>6|192:(55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128):e[n++]=s>>12|224,e[n++]=s>>6&63|128),e[n++]=63&s|128)}return e}var s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],s=0;s<t.length;s+=3){var i=t[s],o=s+1<t.length,a=o?t[s+1]:0,h=s+2<t.length,u=h?t[s+2]:0,c=(15&a)<<2|u>>6,u=63&u;h||(u=64,o||(c=64)),r.push(n[i>>2],n[(3&i)<<4|a>>4],n[c],n[u])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(n(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var s,i,o,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(i=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&(i=t[n++]))<<12|(63&(o=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))):(i=t[n++],o=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&o))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],s=0;s<t.length;){var i=n[t.charAt(s++)],o=s<t.length?n[t.charAt(s)]:0,a=++s<t.length?n[t.charAt(s)]:64,h=++s<t.length?n[t.charAt(s)]:64;if(++s,null==i||null==o||null==a||null==h)throw Error();r.push(i<<2|o>>4),64!==a&&(r.push(o<<4&240|a>>2),64!==h&&r.push(a<<6&192|h))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},h=function(t){return function(t){t=n(t);return s.encodeByteArray(t,!0)}(t).replace(/\./g,"")};function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function i(){return!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var u,c="FirebaseError",l=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(f,u=Error),f);function f(t,e,n){e=u.call(this,e)||this;return e.code=t,e.customData=n,e.name=c,Object.setPrototypeOf(e,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,g.prototype.create),e}var g=(m.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,s=e[0]||{},i=this.service+"/"+t,t=this.errors[t],t=t?(r=s,t.replace(p,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+i+").";return new l(i,t,s)},m);function m(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var p=/\{\$([^}]+)}/g;function y(t){return t&&t._delegate?t._delegate:t}var w,v=(b.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},b.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},b.prototype.setServiceProps=function(t){return this.serviceProps=t,this},b.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},b);function b(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}(C=w=w||{})[C.DEBUG=0]="DEBUG",C[C.VERBOSE=1]="VERBOSE",C[C.INFO=2]="INFO",C[C.WARN=3]="WARN",C[C.ERROR=4]="ERROR",C[C.SILENT=5]="SILENT";function T(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var s=(new Date).toISOString(),i=_[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,a(["["+s+"]  "+t.name+":"],n))}}var E={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},I=w.INFO,_=((Ee={})[w.DEBUG]="log",Ee[w.VERBOSE]="log",Ee[w.INFO]="info",Ee[w.WARN]="warn",Ee[w.ERROR]="error",Ee),S=(Object.defineProperty(A.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in w))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),A.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?E[t]:t},Object.defineProperty(A.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),A.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,a([this,w.DEBUG],t)),this._logHandler.apply(this,a([this,w.DEBUG],t))},A.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,a([this,w.VERBOSE],t)),this._logHandler.apply(this,a([this,w.VERBOSE],t))},A.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,a([this,w.INFO],t)),this._logHandler.apply(this,a([this,w.INFO],t))},A.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,a([this,w.WARN],t)),this._logHandler.apply(this,a([this,w.WARN],t))},A.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,a([this,w.ERROR],t)),this._logHandler.apply(this,a([this,w.ERROR],t))},A);function A(t){this.name=t,this._logLevel=I,this._logHandler=T,this._userLogHandler=null}var D=function(t,e){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function N(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var C,x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k={},R=x||self;function L(){}function O(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function M(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),F=0;function V(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:U).apply(null,arguments)}function B(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function j(t,i){function e(){}e.prototype=i.prototype,t.Z=i.prototype,t.prototype=new e,(t.prototype.constructor=t).Vb=function(t,e,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[e].apply(t,r)}}function $(){this.s=this.s,this.o=this.o}var K={};$.prototype.s=!1,$.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,t=Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++F),delete K[t])},$.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,s="string"==typeof t?t.split(""):t,i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function z(){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Y,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:e<t?1:0}t:{var tt=R.navigator;if(tt){tt=tt.userAgent;if(tt){Y=tt;break t}}Y=""}function et(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function st(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var s=0;s<rt.length;s++)e=rt[s],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function it(t){return it[" "](t),t}it[" "]=L;var ot,at=J(Y,"Opera"),ht=J(Y,"Trident")||J(Y,"MSIE"),ut=J(Y,"Edge"),ct=ut||ht,lt=J(Y,"Gecko")&&!(J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge"))&&!(J(Y,"Trident")||J(Y,"MSIE"))&&!J(Y,"Edge"),dt=J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge");function ft(){var t=R.document;return t?t.documentMode:void 0}t:{var gt="",mt=(mt=Y,lt?/rv:([^\);]+)(\)|;)/.exec(mt):ut?/Edge\/([\d\.]+)/.exec(mt):ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(mt):dt?/WebKit\/(\S+)/.exec(mt):at?/(?:Version)[ \/]?(\S+)/.exec(mt):void 0);if(mt&&(gt=mt?mt[1]:""),ht){mt=ft();if(null!=mt&&mt>parseFloat(gt)){ot=String(mt);break t}}ot=gt}var pt={};function yt(){return t=function(){for(var t=0,e=X(String(ot)).split("."),n=X("9").split("."),r=Math.max(e.length,n.length),s=0;0==t&&s<r;s++)for(var i=e[s]||"",o=n[s]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=i[0].length||0!=o[0].length)&&(t=Z(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||Z(0==i[2].length,0==o[2].length)||Z(i[2],o[2]),i=i[3],o=o[3],0==t););return 0<=t},e=pt,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9);var t,e}var wt=R.document&&ht&&(ft()||parseInt(ot,10))||void 0,vt=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{R.addEventListener("test",L,e),R.removeEventListener("test",L,e)}catch(t){}return t}();function bt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(bt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(lt){t:{try{it(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Et[t.pointerType]||"",this.state=t.state,(this.i=t).defaultPrevented&&Tt.Z.h.call(this)}}bt.prototype.h=function(){this.defaultPrevented=!0},j(Tt,bt);var Et={2:"touch",3:"pen",4:"mouse"};Tt.prototype.h=function(){Tt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var It="closure_listenable_"+(1e6*Math.random()|0),_t=0;function St(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=s,this.key=++_t,this.ca=this.fa=!1}function At(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Dt(t){this.src=t,this.g={},this.h=0}function Nt(t,e){var n,r,s,i=e.type;i in t.g&&(n=t.g[i],(s=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),s&&(At(e),0==t.g[i].length&&(delete t.g[i],t.h--)))}function Ct(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==r)return s}return-1}Dt.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Ct(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new St(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var xt="closure_lm_"+(1e6*Math.random()|0),kt={};function Rt(t,e,n,r,s){if(r&&r.once)return function t(e,n,r,s,i){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],r,s,i);return null}r=Ut(r);return e&&e[It]?e.O(n,r,M(s)?!!s.capture:!!s,i):Lt(e,n,r,!0,s,i)}(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Rt(t,e[i],n,r,s);return null}return n=Ut(n),t&&t[It]?t.N(e,n,M(r)?!!r.capture:!!r,s):Lt(t,e,n,!1,r,s)}function Lt(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o,a=M(s)?!!s.capture:!!s,h=Ft(t);if(h||(t[xt]=h=new Dt(t)),(n=h.add(e,n,r,a,i)).proxy)return n;if(o=Pt,(n.proxy=r=function t(e){return o.call(t.src,t.listener,e)}).src=t,r.listener=n,t.addEventListener)void 0===(s=!vt?a:s)&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(Mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ot(t){var e,n,r;"number"!=typeof t&&t&&!t.ca&&((e=t.src)&&e[It]?Nt(e.i,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Nt(n,t),0==n.h&&(n.src=null,e[xt]=null)):At(t)))}function Mt(t){return t in kt?kt[t]:kt[t]="on"+t}function Pt(t,e){var n,r;return t=!!t.ca||(e=new Tt(e,this),n=t.listener,r=t.ia||t.src,t.fa&&Ot(t),n.call(r,e))}function Ft(t){return(t=t[xt])instanceof Dt?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(e){return"function"==typeof e?e:(e[Vt]||(e[Vt]=function(t){return e.handleEvent(t)}),e[Vt])}function qt(){$.call(this),this.i=new Dt(this),(this.P=this).I=null}function Bt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e?e=new bt(e,t):e instanceof bt?e.target=e.target||t:(o=e,st(e=new bt(r,t),o)),o=!0,n)for(var s=n.length-1;0<=s;s--)var i=e.g=n[s],o=jt(i,r,!0,e)&&o;if(o=jt(i=e.g=t,r,!0,e)&&o,o=jt(i,r,!1,e)&&o,n)for(s=0;s<n.length;s++)o=jt(i=e.g=n[s],r,!1,e)&&o}function jt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o,a,h=e[i];h&&!h.ca&&h.capture==n&&(o=h.listener,a=h.ia||h.src,h.fa&&Nt(t.i,h),s=!1!==o.call(a,r)&&s)}return s&&!r.defaultPrevented}j(qt,$),qt.prototype[It]=!0,qt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,s,i){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],r,s,i);else s=M(s)?!!s.capture:!!s,r=Ut(r),e&&e[It]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=Ct(o=e.g[n],r,s,i))&&(At(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete e.g[n],e.h--))):(e=e&&Ft(e))&&(n=e.g[n.toString()],(r=(e=-1)<(e=n?Ct(n,r,s,i):e)?n[e]:null)&&Ot(r))}(this,t,e,n,r)},qt.prototype.M=function(){if(qt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)At(n[r]);delete e.g[t],e.h--}}this.I=null},qt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},qt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var $t=R.JSON.stringify;var Kt=(Gt.prototype.add=function(t,e){var n=Ht.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},Gt);function Gt(){this.h=this.g=null}var Ht=(zt.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},new zt(function(){return new Wt},function(t){return t.reset()}));function zt(t,e){this.i=t,this.j=e,this.h=0,this.g=null}var Qt,Wt=(Yt.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},Yt.prototype.reset=function(){this.next=this.g=this.h=null},Yt);function Yt(){this.next=this.g=this.h=null}function Xt(t,e){var n;Qt||(n=R.Promise.resolve(void 0),Qt=function(){n.then(te)}),Jt||(Qt(),Jt=!0),Zt.add(t,e)}var Jt=!1,Zt=new Kt;function te(){for(var t;e=t=void 0,e=null,(t=Zt).g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(t){!function(t){R.setTimeout(function(){throw t},0)}(t)}var e=Ht;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}Jt=!1}function ee(t,e){qt.call(this),this.h=t||1,this.g=e||R,this.j=q(this.kb,this),this.l=Date.now()}function ne(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function re(t,e,n){if("function"==typeof t)n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:R.setTimeout(t,e||0)}j(ee,qt),(C=ee.prototype).da=!1,C.S=null,C.kb=function(){var t;this.da&&(0<(t=Date.now()-this.l)&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Bt(this,"tick"),this.da&&(ne(this),this.start())))},C.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},C.M=function(){ee.Z.M.call(this),ne(this),delete this.g};var se,ie=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(oe,se=$),oe.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=re(function(){e.g=null,e.i&&(e.i=!1,t(e))},e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)},oe.prototype.M=function(){se.prototype.M.call(this),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},oe);function oe(t,e){var n=se.call(this)||this;return n.m=t,n.j=e,n.h=null,n.i=!1,n.g=null,n}function ae(t){$.call(this),this.h=t,this.g={}}j(ae,$);var he=[];function ue(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var s=0;s<n.length;s++){var i=Rt(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function ce(t){et(t.g,function(t,e){this.g.hasOwnProperty(e)&&Ot(t)},t),t.g={}}function le(){this.g=!0}function de(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return $t(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ae.prototype.M=function(){ae.Z.M.call(this),ce(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},le.prototype.Aa=function(){this.g=!1},le.prototype.info=function(){};var fe={},ge=null;function me(){return ge=ge||new qt}function pe(t){bt.call(this,fe.Ma,t)}function ye(){var t=me();Bt(t,new pe(t))}function we(t,e){bt.call(this,fe.STAT_EVENT,t),this.stat=e}function ve(t){var e=me();Bt(e,new we(e,t))}function be(t,e){bt.call(this,fe.Na,t),this.size=e}function Te(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){t()},e)}fe.Ma="serverreachability",j(pe,bt),fe.STAT_EVENT="statevent",j(we,bt),fe.Na="timingevent",j(be,bt);var Ee={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},x={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ie(){}function _e(t){return t.h||(t.h=t.i())}function Se(){}Ie.prototype.h=null;Kt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ae(){bt.call(this,"d")}function De(){bt.call(this,"c")}function Ne(){}function Ce(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ae(this),this.P=Re,this.W=new ee(t=ct?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new xe}function xe(){this.i=null,this.g="",this.h=!1}j(Ae,bt),j(De,bt),j(Ne,Ie),Ne.prototype.g=function(){return new XMLHttpRequest},Ne.prototype.i=function(){return{}};var ke=new Ne,Re=45e3,Le={},Oe={};function Me(t,e,n){t.K=1,t.v=rn(Xe(e)),t.s=n,t.U=!0,Pe(t,null)}function Pe(t,e){t.F=Date.now(),Ue(t),t.A=Xe(t.v);var o,a,h,u,c,l,n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),yn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new xe,t.g=wr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ie(q(t.Ia,t,t.g),t.O)),ue(t.V,t.g,"readystatechange",t.gb),e=t.H?nt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),ye(),o=t.j,a=t.u,h=t.A,u=t.m,c=t.X,l=t.s,o.info(function(){if(o.g)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,s,i=e[n].split("=");1<i.length&&(r=i[0],i=i[1],t=2<=(s=r.split("_")).length&&"type"==s[1]?t+(r+"=")+i+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+u+") [attempt "+c+"]: "+a+"\n"+h+"\n"+t})}function Fe(t){return t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Ve(t,e,n){for(var r,s,i,o,a,h=!0;!t.I&&t.C<n.length;){if(i=n,a=o=void 0,o=(s=t).C,(r=-1==(a=i.indexOf("\n",o))?Oe:(o=Number(i.substring(o,a)),isNaN(o)?Le:(a+=1)+o>i.length?Oe:(i=i.substr(a,o),s.C=a+o,i)))==Oe){4==e&&(t.o=4,ve(14),h=!1),de(t.j,t.m,null,"[Incomplete Response]");break}if(r==Le){t.o=4,ve(15),de(t.j,t.m,n,"[Invalid Chunk]"),h=!1;break}de(t.j,t.m,r,null),Ke(t,r)}Fe(t)&&r!=Oe&&r!=Le&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ve(16),h=!1),t.i=t.i&&h,h?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),cr(e),e.L=!0,ve(11))):(de(t.j,t.m,n,"[Invalid Chunked Response]"),$e(t),je(t))}function Ue(t){t.Y=Date.now()+t.P,qe(t,t.P)}function qe(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Te(q(t.eb,t),e)}function Be(t){t.B&&(R.clearTimeout(t.B),t.B=null)}function je(t){0==t.l.G||t.I||fr(t.l,t)}function $e(t){Be(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,ne(t.W),ce(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ke(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Sn(n.i,t)))if(n.I=t.N,!t.J&&Sn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(m){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;dr(n),er(n)}ur(n),ve(18)}}else n.ta=s[1],0<n.ta-n.U&&s[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=Te(q(n.ab,n),6e3));if(_n(n.i)<=1&&n.ka){try{n.ka()}catch(m){}n.ka=void 0}}else mr(n,11)}else if(!t.J&&n.g!=t||dr(n),!W(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){var i,o,a,h,u,c,l,d,f,g,m=s[e];n.U=m[0],m=m[1],2==n.G?"c"==m[0]?(n.J=m[1],n.la=m[2],null!=(i=m[3])&&(n.ma=i,n.h.info("VER="+n.ma)),null!=(o=m[4])&&(n.za=o,n.h.info("SVER="+n.za)),null!=(a=m[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(h=t.g)&&(!(u=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(c=r.i).g&&(J(u,"spdy")||J(u,"quic")||J(u,"h2"))&&(c.j=c.l,c.g=new Set,c.h&&(An(c,c.h),c.h=null)),!r.D||(l=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=l,nn(r.F,r.D,l))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),d=t,(r=n).oa=yr(r,r.H?r.la:null,r.W),d.J?(Dn(r.i,d),f=d,(g=r.K)&&f.setTimeout(g),f.B&&(Be(f),Ue(f)),r.g=d):hr(r),0<n.l.length&&sr(n)):"stop"!=m[0]&&"close"!=m[0]||mr(n,7):3==n.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?mr(n,7):tr(n):"noop"!=m[0]&&n.j&&n.j.wa(m),n.A=0)}ye()}catch(m){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)H(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(O(t)||"string"==typeof t)for(var n=[],r=t.length,s=0;s<r;s++)n.push(s);else for(s in n=[],r=0,t)n[r++]=s;for(var s=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function He(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof He)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Qe(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){for(var s={},n=e=0;e<t.g.length;)Qe(s,r=t.g[e])||(s[t.g[n++]=r]=1),e++;t.g.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(C=Ce.prototype).setTimeout=function(t){this.P=t},C.gb=function(t){t=t.target;var e=this.L;e&&3==Wn(t)?e.l():this.Ia(t)},C.Ia=function(t){try{if(t==this.g)t:{var e=Wn(this.g),n=this.g.Da();this.g.ba();if(!(e<3)&&(3!=e||ct||this.g&&(this.h.h||this.g.ga()||Yn(this.g)))){this.I||4!=e||7==n||ye(),Be(this);var r=this.g.ba();this.N=r;e:if(Fe(this)){var s=Yn(this.g);t="";var i=s.length,o=4==Wn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$e(this),je(this);var a="";break e}this.h.i=new R.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,t+=this.h.i.decode(s[n],{stream:o&&n==i-1});s.splice(0,i),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.X,p=e,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.$&&!this.J){e:{if(this.g){var h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(h)){var c=h;break e}}c=null}if(!(r=c)){this.i=!1,this.o=3,ve(12),$e(this),je(this);break t}de(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ke(this,r)}this.U?(Ve(this,e,a),ct&&this.i&&3==e&&(ue(this.V,this.W,"tick",this.fb),this.W.start())):(de(this.j,this.m,a,null),Ke(this,a)),4==e&&$e(this),this.i&&!this.I&&(4==e?fr(this.l,this):(this.i=!1,Ue(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,ve(12)):(this.o=0,ve(13)),$e(this),je(this)}}}catch(e){}var l,d,f,g,m,p,y},C.fb=function(){var t,e;this.g&&(t=Wn(this.g),e=this.g.ga(),this.C<e.length&&(Be(this),Ve(this,t,e),this.i&&4!=t&&Ue(this)))},C.cancel=function(){this.I=!0,$e(this)},C.eb=function(){this.B=null;var t,e,n=Date.now();0<=n-this.Y?(t=this.j,e=this.A,t.info(function(){return"TIMEOUT: "+e}),2!=this.K&&(ye(),ve(17)),$e(this),this.o=2,je(this)):qe(this,this.Y-n)},(C=He.prototype).R=function(){ze(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},C.T=function(){return ze(this),this.g.concat()},C.get=function(t,e){return Qe(this.h,t)?this.h[t]:e},C.set=function(t,e){Qe(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},C.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ye?(this.g=void 0!==e?e:t.g,Je(this,t.j),this.s=t.s,Ze(this,t.i),tn(this,t.m),this.l=t.l,e=t.h,(n=new fn).i=e.i,e.g&&(n.g=new He(e.g),n.h=e.h),en(this,n),this.o=t.o):t&&(n=String(t).match(We))?(this.g=!!e,Je(this,n[1]||"",!0),this.s=sn(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.l=sn(n[5]||"",!0),en(this,n[6]||"",!0),this.o=sn(n[7]||"")):(this.g=!!e,this.h=new fn(null,this.g))}function Xe(t){return new Ye(t)}function Je(t,e,n){t.j=n?sn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ze(t,e,n){t.i=n?sn(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function en(t,e,n){var r,s;e instanceof fn?(t.h=e,r=t.h,(s=t.g)&&!r.j&&(gn(r),r.i=null,r.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(mn(this,e),yn(this,n,t))},r)),r.j=s):(n||(e=on(e,ln)),t.h=new fn(e,t.g))}function nn(t,e,n){t.h.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function sn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,an),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function an(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.j;e&&t.push(on(e,hn,!0),":");var n=this.i;return!n&&"file"!=e||(t.push("//"),(e=this.s)&&t.push(on(e,hn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",on(n,dn)),t.join("")};var hn=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,ln=/[#\?@]/g,dn=/#/g;function fn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function gn(n){n.g||(n.g=new He,n.h=0,n.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,s=t[n].indexOf("="),i=null;0<=s?(r=t[n].substring(0,s),i=t[n].substring(s+1)):r=t[n],e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function mn(t,e){gn(t),e=wn(t,e),Qe(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Qe((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&ze(t)))}function pn(t,e){return gn(t),e=wn(t,e),Qe(t.g.h,e)}function yn(t,e,n){mn(t,e),0<n.length&&(t.i=null,t.g.set(wn(t,e),Q(n)),t.h+=n.length)}function wn(t,e){return e=String(e),e=t.j?e.toLowerCase():e}(C=fn.prototype).add=function(t,e){gn(this),this.i=null,t=wn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},C.forEach=function(n,r){gn(this),this.g.forEach(function(t,e){H(t,function(t){n.call(r,t,e,this)},this)},this)},C.T=function(){gn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n},C.R=function(t){gn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=z(e,this.g.get(wn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},C.set=function(t,e){return gn(this),this.i=null,pn(this,t=wn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},C.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},C.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++)for(var r=e[n],s=encodeURIComponent(String(r)),r=this.R(r),i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}return this.i=t.join("&")};var vn=function(t,e){this.h=t,this.g=e};function bn(t){this.l=t||En,t=R.PerformanceNavigationTiming?0<(t=R.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Tn,En=10;function In(t){return t.h||t.g&&t.g.size>=t.j}function _n(t){return t.h?1:t.g?t.g.size:0}function Sn(t,e){return t.h?t.h==e:t.g&&t.g.has(e)}function An(t,e){t.g?t.g.add(e):t.h=e}function Dn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Nn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return Q(t.i);var r=t.i;try{for(var s=N(t.g.values()),i=s.next();!i.done;i=s.next())var o=i.value,r=r.concat(o.D)}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r}function Cn(){}function xn(){this.g=new Cn}function kn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function Rn(t){this.l=t.$b||null,this.j=t.ib||!1}function Ln(t,e){qt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=On,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}bn.prototype.cancel=function(){var e,t;if(this.i=Nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=N(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}},Cn.prototype.stringify=function(t){return R.JSON.stringify(t,void 0)},Cn.prototype.parse=function(t){return R.JSON.parse(t,void 0)},j(Rn,Ie),Rn.prototype.g=function(){return new Ln(this.l,this.j)},Rn.prototype.i=(Tn={},function(){return Tn}),j(Ln,qt);var On=0;function Mn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Pn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Fn(t)}function Fn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(C=Ln.prototype).open=function(t,e){if(this.readyState!=On)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Fn(this)},C.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||R).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},C.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pn(this)),this.readyState=On},C.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==R.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Mn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},C.Sa=function(t){var e;this.g&&(this.u&&t.value?this.response.push(t.value):this.u||(e=t.value||new Uint8Array(0),(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)),(t.done?Pn:Fn)(this),3==this.readyState&&Mn(this))},C.Ua=function(t){this.g&&(this.response=this.responseText=t,Pn(this))},C.Ta=function(t){this.g&&(this.response=t,Pn(this))},C.ha=function(){this.g&&Pn(this)},C.setRequestHeader=function(t,e){this.v.append(t,e)},C.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},C.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ln.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Vn=R.JSON.parse;function Un(t){qt.call(this),this.headers=new He,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=qn,this.K=this.L=!1}j(Un,qt);var qn="",Bn=/^https?$/i,jn=["POST","PUT"];function $n(t){return"content-type"==t.toLowerCase()}function Kn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Gn(t),zn(t)}function Gn(t){t.D||(t.D=!0,Bt(t,"complete"),Bt(t,"error"))}function Hn(t){if(t.h&&void 0!==k&&(!t.C[1]||4!=Wn(t)||2!=t.ba()))if(t.v&&4==Wn(t))re(t.Fa,0,t);else if(Bt(t,"readystatechange"),4==Wn(t)){t.h=!1;try{var e,n,r,s,i=t.ba();t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break t;default:o=!1}if((e=o)||((n=0===i)&&(!(s=String(t.H).match(We)[1]||null)&&R.self&&R.self.location&&(s=(r=R.self.location.protocol).substr(0,r.length-1)),n=!Bn.test(s?s.toLowerCase():"")),e=n),e)Bt(t,"complete"),Bt(t,"success");else{t.m=6;try{var a=2<Wn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Gn(t)}}finally{zn(t)}}}function zn(t,e){if(t.g){Qn(t);var n=t.g,r=t.C[0]?L:null;t.g=null,t.C=null,e||Bt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Qn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(R.clearTimeout(t.A),t.A=null)}function Wn(t){return t.g?t.g.readyState:0}function Yn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case qn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var s;r||(s="",et(n,function(t,e){s+=e,s+=":",s+=t,s+="\r\n"}),n=s,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function Jn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Zn(t){this.za=0,this.l=[],this.h=new le,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Jn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Jn("baseRetryDelayMs",5e3,t),this.$a=Jn("retryDelaySeedMs",1e4,t),this.Ya=Jn("forwardChannelMaxRetries",2,t),this.ra=Jn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new bn(t&&t.concurrentRequestLimit),this.Ca=new xn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function tr(t){var e,n;nr(t),3==t.G&&(e=t.V++,nn(n=Xe(t.F),"SID",t.J),nn(n,"RID",e),nn(n,"TYPE","terminate"),or(t,n),(e=new Ce(t,t.h,e,void 0)).K=2,e.v=rn(Xe(n)),n=!1,!(n=R.navigator&&R.navigator.sendBeacon?R.navigator.sendBeacon(e.v.toString(),""):n)&&R.Image&&((new Image).src=e.v,n=!0),n||(e.g=wr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ue(e)),pr(t)}function er(t){t.g&&(cr(t),t.g.cancel(),t.g=null)}function nr(t){er(t),t.u&&(R.clearTimeout(t.u),t.u=null),dr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&R.clearTimeout(t.m),t.m=null)}function rr(t,e){t.l.push(new vn(t.Za++,e)),3==t.G&&sr(t)}function sr(t){In(t.i)||t.m||(t.m=!0,Xt(t.Ha,t),t.C=0)}function ir(t,e){var n=e?e.m:t.V++,r=Xe(t.F);nn(r,"SID",t.J),nn(r,"RID",n),nn(r,"AID",t.U),or(t,r),t.o&&t.s&&Xn(r,t.o,t.s),n=new Ce(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=ar(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),An(t.i,n),Me(n,r,e)}function or(t,n){t.j&&Ge({},function(t,e){nn(n,e,t)})}function ar(t,e,n){n=Math.min(t.l.length,n);var r=t.j?q(t.j.Oa,t.j,t):null;t:for(var s=t.l,i=-1;;){var o=["count="+n];-1==i?0<n?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);for(var a=!0,h=0;h<n;h++){var u=s[h].h,c=s[h].g;if((u-=i)<0)i=Math.max(0,s[h].h-100),a=!1;else try{!function(t,r,e){var s=e||"";try{Ge(t,function(t,e){var n=t;M(t)&&(n=$t(t)),r.push(s+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(s+"type="+encodeURIComponent("_badmap")),t}}(c,o,"req"+u+"_")}catch(t){r&&r(c)}}if(a){r=o.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function hr(t){t.g||t.u||(t.Y=1,Xt(t.Ga,t),t.A=0)}function ur(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=Te(q(t.Ga,t),gr(t,t.A)),t.A++,1)}function cr(t){null!=t.B&&(R.clearTimeout(t.B),t.B=null)}function lr(t){t.g=new Ce(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Xe(t.oa);nn(e,"RID","rpc"),nn(e,"SID",t.J),nn(e,"CI",t.N?"0":"1"),nn(e,"AID",t.U),or(t,e),nn(e,"TYPE","xmlhttp"),t.o&&t.s&&Xn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=rn(Xe(e)),n.s=null,n.U=!0,Pe(n,t)}function dr(t){null!=t.v&&(R.clearTimeout(t.v),t.v=null)}function fr(t,e){var n,r,s,i=null;if(t.g==e){dr(t),cr(t),t.g=null;var o=2}else{if(!Sn(t.i,e))return;i=e.D,Dn(t.i,e),o=1}if(t.I=e.N,0!=t.G)if(e.i)1==o?(i=e.s?e.s.length:0,e=Date.now()-e.F,n=t.C,Bt(o=me(),new be(o,i)),sr(t)):hr(t);else if(3==(n=e.o)||0==n&&0<t.I||(1!=o||(s=e,_n((r=t).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=s.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=Te(q(r.Ha,r,s),gr(r,r.C)),r.C++,0))))&&(2!=o||!ur(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),n){case 1:mr(t,5);break;case 4:mr(t,10);break;case 3:mr(t,6);break;default:mr(t,2)}}function gr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function mr(t,e){var n,r,s,i;t.h.info("Error code "+e),2==e?(r=null,t.j&&(r=null),i=q(t.jb,t),r||(r=new Ye("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||Je(r,"https"),rn(r)),n=r.toString(),r=i,i=new le,R.Image?((s=new Image).onload=B(kn,i,s,"TestLoadImage: loaded",!0,r),s.onerror=B(kn,i,s,"TestLoadImage: error",!1,r),s.onabort=B(kn,i,s,"TestLoadImage: abort",!1,r),s.ontimeout=B(kn,i,s,"TestLoadImage: timeout",!1,r),R.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=n):r(!1)):ve(2),t.G=0,t.j&&t.j.va(e),pr(t),nr(t)}function pr(t){t.G=0,t.I=-1,t.j&&(0==Nn(t.i).length&&0==t.l.length||(t.i.i.length=0,Q(t.l),t.l.length=0),t.j.ua())}function yr(t,e,n){var r,s,i,o,a,h=(o=n)instanceof Ye?Xe(o):new Ye(o,void 0);return""!=h.i?(e&&Ze(h,e+"."+h.i),tn(h,h.m)):(a=R.location,r=a.protocol,s=e?e+"."+a.hostname:a.hostname,i=+a.port,o=n,a=new Ye(null,void 0),r&&Je(a,r),s&&Ze(a,s),i&&tn(a,i),o&&(a.l=o),h=a),t.aa&&et(t.aa,function(t,e){nn(h,e,t)}),e=t.D,n=t.sa,e&&n&&nn(h,e,n),nn(h,"VER",t.ma),or(t,h),h}function wr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Un(new Rn({ib:!0})):new Un(t.qa)).L=t.H,e}function vr(){}function br(){if(ht&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function Tr(t,e){qt.call(this),this.g=new Zn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new _r(this)}function Er(t){Ae.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Ir(){De.call(this),this.status=1}function _r(t){this.g=t}(C=Un.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||ke).g(),this.C=this.u?_e(this.u):_e(ke),this.g.onreadystatechange=q(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Kn(this,t)}t=n||"";var s,i=new He(this.headers);r&&Ge(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=$n,n=t.length,r="string"==typeof t?t.split(""):t,s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=R.FormData&&t instanceof R.FormData,0<=G(jn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Qn(this),0<this.B&&((this.K=(s=this.g,ht&&yt()&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=q(this.pa,this)):this.A=re(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Kn(this,t)}},C.pa=function(){void 0!==k&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Bt(this,"timeout"),this.abort(8))},C.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Bt(this,"complete"),Bt(this,"abort"),zn(this))},C.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zn(this,!0)),Un.Z.M.call(this)},C.Fa=function(){this.s||(this.F||this.v||this.l?Hn(this):this.cb())},C.cb=function(){Hn(this)},C.ba=function(){try{return 2<Wn(this)?this.g.status:-1}catch(t){return-1}},C.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},C.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Vn(e)}},C.Da=function(){return this.m},C.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(C=Zn.prototype).ma=8,C.G=1,C.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},C.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ce(this,this.h,t,void 0),n=this.s;if(this.P&&(n?st(n=nt(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,s=0;s<this.l.length;s++){var i=this.l[s];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(r+=i)){r=s;break t}if(4096===r||s===this.l.length-1){r=s+1;break t}}r=1e3}else r=1e3;r=ar(this,e,r),nn(s=Xe(this.F),"RID",t),nn(s,"CVER",22),this.D&&nn(s,"X-HTTP-Session-Id",this.D),or(this,s),this.o&&n&&Xn(s,this.o,n),An(this.i,e),this.Ra&&nn(s,"TYPE","init"),this.ja?(nn(s,"$req",r),nn(s,"SID","null"),e.$=!0,Me(e,s,null)):Me(e,s,r),this.G=2}}else 3==this.G&&(t?ir(this,t):0==this.l.length||In(this.i)||ir(this))},C.Ga=function(){var t;this.u=null,lr(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(t=2*this.O,this.h.info("BP detection timer enabled: "+t),this.B=Te(q(this.bb,this),t))},C.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ve(10),er(this),lr(this))},C.ab=function(){null!=this.v&&(this.v=null,er(this),ur(this),ve(19))},C.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ve(2)):(this.h.info("Failed to ping google.com"),ve(1))},(C=vr.prototype).xa=function(){},C.wa=function(){},C.va=function(){},C.ua=function(){},C.Oa=function(){},br.prototype.g=function(t,e){return new Tr(t,e)},j(Tr,qt),Tr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Xt(q(t.hb,t,e))),ve(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=yr(t,null,t.W),sr(t)},Tr.prototype.close=function(){tr(this.g)},Tr.prototype.u=function(t){var e;"string"==typeof t?((e={}).__data__=t,rr(this.g,e)):this.v?((e={}).__data__=$t(t),rr(this.g,e)):rr(this.g,t)},Tr.prototype.M=function(){this.g.j=null,delete this.j,tr(this.g),delete this.g,Tr.Z.M.call(this)},j(Er,Ae),j(Ir,De),j(_r,vr),_r.prototype.xa=function(){Bt(this.g,"a")},_r.prototype.wa=function(t){Bt(this.g,new Er(t))},_r.prototype.va=function(t){Bt(this.g,new Ir)},_r.prototype.ua=function(){Bt(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,Tr.prototype.send=Tr.prototype.u,Tr.prototype.open=Tr.prototype.m,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,x.COMPLETE="complete",(Se.EventType=Kt).OPEN="a",Kt.CLOSE="b",Kt.ERROR="c",Kt.MESSAGE="d",qt.prototype.listen=qt.prototype.N,Un.prototype.listenOnce=Un.prototype.O,Un.prototype.getLastError=Un.prototype.La,Un.prototype.getLastErrorCode=Un.prototype.Da,Un.prototype.getStatus=Un.prototype.ba,Un.prototype.getResponseJson=Un.prototype.Qa,Un.prototype.getResponseText=Un.prototype.ga,Un.prototype.send=Un.prototype.ea;var Sr,Ar=me,Dr=Ee,Nr=x,Cr=fe,xr=10,kr=11,Rr=Rn,Lr=Se,Or=Un;let Mr="9.0.0-2021720181311";class Pr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.t(t),this.i=t=>e.writeSequenceNumber(t))}t(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){var t=++this.previousValue;return this.i&&this.i(t),t}}Pr.o=-1;const Fr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Vr extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}const Ur=new S("@firebase/firestore");function qr(){return Ur.logLevel}function Br(t,...e){Ur.logLevel<=w.DEBUG&&(e=e.map(Kr),Ur.debug(`Firestore (${Mr}): ${t}`,...e))}function jr(t,...e){Ur.logLevel<=w.ERROR&&(e=e.map(Kr),Ur.error(`Firestore (${Mr}): ${t}`,...e))}function $r(t,...e){Ur.logLevel<=w.WARN&&(e=e.map(Kr),Ur.warn(`Firestore (${Mr}): ${t}`,...e))}function Kr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Gr(t="Unexpected state"){t=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+t;throw jr(t),new Error(t)}function Hr(t){t||Gr()}class zr{static u(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){var s=function(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}(40);for(let t=0;t<s.length;++t)r.length<20&&s[t]<n&&(r+=e.charAt(s[t]%e.length))}return r}}function Qr(t,e){return t<e?-1:e<t?1:0}function Wr(t,n,r){return t.length===n.length&&t.every((t,e)=>r(t,n[e]))}function Yr(t){return t+"\0"}class Xr{constructor(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Vr(Fr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Xr.fromMillis(Date.now())}static fromDate(t){return Xr.fromMillis(t.getTime())}static fromMillis(t){var e=Math.floor(t/1e3),t=Math.floor(1e6*(t-1e3*e));return new Xr(e,t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Qr(this.nanoseconds,t.nanoseconds):Qr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Jr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Jr(t)}static min(){return new Jr(new Xr(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Zr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ts(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function es(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ns{constructor(t,e,n){void 0===e?e=0:e>t.length&&Gr(),void 0===n?n=t.length-e:n>t.length-e&&Gr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ns.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ns?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(n){for(let t=this.offset,e=this.limit();t<e;t++)n(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let t=0;t<r;t++){const r=e.get(t),s=n.get(t);if(r<s)return-1;if(r>s)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class rs extends ns{construct(t,e,n){return new rs(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(0<=n.indexOf("//"))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>0<t.length))}return new rs(e)}static emptyPath(){return new rs([])}}const ss=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class is extends ns{construct(t,e,n){return new is(t,e,n)}static isValidIdentifier(t){return ss.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!is.isValidIdentifier(t)?"`"+t+"`":t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new is(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;var s=()=>{if(0===n.length)throw new Vr(Fr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Vr(Fr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Vr(Fr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?i=!i:"."!==e||i?n+=e:s(),r++}if(s(),i)throw new Vr(Fr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new is(e)}static emptyPath(){return new is([])}}class os{constructor(t){(this.fields=t).sort(is.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Wr(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class as{constructor(t){this.binaryString=t}static fromBase64String(t){t=atob(t);return new as(t)}static fromUint8Array(t){t=function(e){let n="";for(let t=0;t<e.length;++t)n+=String.fromCharCode(e[t]);return n}(t);return new as(t)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Qr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}as.EMPTY_BYTE_STRING=new as("");const hs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function us(e){if(Hr(!!e),"string"!=typeof e)return{seconds:cs(e.seconds),nanos:cs(e.nanos)};{let t=0;var n=hs.exec(e);Hr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),t=Number(n));const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}}function cs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ls(t){return"string"==typeof t?as.fromBase64String(t):as.fromUint8Array(t)}function ds(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function fs(t){t=us(t.mapValue.fields.__local_write_time__.timestampValue);return new Xr(t.seconds,t.nanos)}function gs(t){return null==t}function ms(t){return 0===t&&1/t==-1/0}function ps(t){return"number"==typeof t&&Number.isInteger(t)&&!ms(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class ys{constructor(t){this.path=t}static fromPath(t){return new ys(rs.fromString(t))}static fromName(t){return new ys(rs.fromString(t).popFirst(5))}hasCollectionId(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===rs.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return rs.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ys(new rs(t.slice()))}}function ws(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ds(t)?4:10:Gr()}function vs(n,r){var t,e,s=ws(n);if(s!==ws(r))return!1;switch(s){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return fs(n).isEqual(fs(r));case 3:return function(t){if("string"==typeof n.timestampValue&&"string"==typeof t.timestampValue&&n.timestampValue.length===t.timestampValue.length)return n.timestampValue===t.timestampValue;var e=us(n.timestampValue),t=us(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return e=r,ls(n.bytesValue).isEqual(ls(e.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return t=r,cs((e=n).geoPointValue.latitude)===cs(t.geoPointValue.latitude)&&cs(e.geoPointValue.longitude)===cs(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return cs(t.integerValue)===cs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=cs(t.doubleValue),e=cs(e.doubleValue);return t===e?ms(t)===ms(e):isNaN(t)&&isNaN(e)}return!1}(n,r);case 9:return Wr(n.arrayValue.values||[],r.arrayValue.values||[],vs);case 10:return function(t){const e=t.mapValue.fields||{},n=r.mapValue.fields||{};if(Zr(e)!==Zr(n))return!1;for(const t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!vs(e[t],n[t])))return!1;return!0}(n);default:return Gr()}}function bs(t,e){return void 0!==(t.values||[]).find(t=>vs(t,e))}function Ts(t,e){var n,r,s,i=ws(t),o=ws(e);if(i!==o)return Qr(i,o);switch(i){case 0:return 0;case 1:return Qr(t.booleanValue,e.booleanValue);case 2:return r=e,s=cs(t.integerValue||t.doubleValue),r=cs(r.integerValue||r.doubleValue),s<r?-1:r<s?1:s===r?0:isNaN(s)?isNaN(r)?0:-1:1;case 3:return Es(t.timestampValue,e.timestampValue);case 4:return Es(fs(t),fs(e));case 5:return Qr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ls(t),r=ls(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){var n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Qr(n[t],r[t]);if(0!==e)return e}return Qr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,s=e.geoPointValue,0!==(r=Qr(cs(n.latitude),cs(s.latitude)))?r:Qr(cs(n.longitude),cs(s.longitude));case 9:return function(t,e){var n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Ts(n[t],r[t]);if(e)return e}return Qr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Qr(r[t],i[t]);if(0!==e)return e;var o=Ts(n[r[t]],s[i[t]]);if(0!==o)return o}return Qr(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Gr()}}function Es(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Qr(t,e);var n=us(t),t=us(e),e=Qr(n.seconds,t.seconds);return 0!==e?e:Qr(n.nanos,t.nanos)}function Is(t){return function i(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=us(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ls(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,ys.fromName(e).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=i(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${i(t.fields[s])}`;return n+"}"}(t.mapValue):Gr();var e}(t)}function _s(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ss(t){return t&&"integerValue"in t}function As(t){return!!t&&"arrayValue"in t}function Ds(t){return t&&"nullValue"in t}function Ns(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Cs(t){return t&&"mapValue"in t}function xs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const n={mapValue:{fields:{}}};return ts(e.mapValue.fields,(t,e)=>n.mapValue.fields[t]=xs(e)),n}if(e.arrayValue){const r={arrayValue:{values:[]}};for(let t=0;t<(e.arrayValue.values||[]).length;++t)r.arrayValue.values[t]=xs(e.arrayValue.values[t]);return r}return Object.assign({},e)}class ks{constructor(t){this.value=t}static empty(){return new ks({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Cs(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=xs(e)}setAll(t){let n=is.emptyPath(),r={},s=[];t.forEach((t,e)=>{if(!n.isImmediateParentOf(e)){const t=this.getFieldsMap(n);this.applyChanges(t,r,s),r={},s=[],n=e.popLast()}t?r[e.lastSegment()]=xs(t):s.push(e.lastSegment())});t=this.getFieldsMap(n);this.applyChanges(t,r,s)}delete(t){const e=this.field(t.popLast());Cs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return vs(this.value,t.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let e=0;e<n.length;++e){let t=r.mapValue.fields[n.get(e)];Cs(t)&&t.mapValue.fields||(t={mapValue:{fields:{}}},r.mapValue.fields[n.get(e)]=t),r=t}return r.mapValue.fields}applyChanges(n,t,e){ts(t,(t,e)=>n[t]=e);for(const t of e)delete n[t]}clone(){return new ks(xs(this.value))}}class Rs{constructor(t,e,n,r,s){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=s}static newInvalidDocument(t){return new Rs(t,0,Jr.min(),ks.empty(),0)}static newFoundDocument(t,e,n){return new Rs(t,1,e,n,0)}static newNoDocument(t,e){return new Rs(t,2,e,ks.empty(),0)}static newUnknownDocument(t,e){return new Rs(t,3,e,ks.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ks.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ks.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Rs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new Rs(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ls{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.h=null}}function Os(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Ls(t,e,n,r,s,i,o)}function Ms(t){const e=t;if(null===e.h){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>function(t){return t.field.canonicalString()+t.op.toString()+Is(t.value)}(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),gs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Qs(e.startAt)),e.endAt&&(t+="|ub:",t+=Qs(e.endAt)),e.h=t}return e.h}function Ps(e,n){if(e.limit!==n.limit)return!1;if(e.orderBy.length!==n.orderBy.length)return!1;for(let t=0;t<e.orderBy.length;t++)if(r=e.orderBy[t],s=n.orderBy[t],r.dir!==s.dir||!r.field.isEqual(s.field))return!1;var r,s,i,o;if(e.filters.length!==n.filters.length)return!1;for(let t=0;t<e.filters.length;t++)if(i=e.filters[t],o=n.filters[t],i.op!==o.op||!i.field.isEqual(o.field)||!vs(i.value,o.value))return!1;return e.collectionGroup===n.collectionGroup&&!!e.path.isEqual(n.path)&&!!Xs(e.startAt,n.startAt)&&Xs(e.endAt,n.endAt)}function Fs(t){return ys.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Vs extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Us(t,e,n):"array-contains"===e?new $s(t,n):"in"===e?new Ks(t,n):"not-in"===e?new Gs(t,n):"array-contains-any"===e?new Hs(t,n):new Vs(t,e,n)}static l(t,e,n){return new("in"===e?qs:Bs)(t,n)}matches(t){t=t.data.field(this.field);return"!="===this.op?null!==t&&this.m(Ts(t,this.value)):null!==t&&ws(this.value)===ws(t)&&this.m(Ts(t,this.value))}m(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Gr()}}g(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class Us extends Vs{constructor(t,e,n){super(t,e,n),this.key=ys.fromName(n.referenceValue)}matches(t){t=ys.comparator(t.key,this.key);return this.m(t)}}class qs extends Vs{constructor(t,e){super(t,"in",e),this.keys=js(0,e)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Bs extends Vs{constructor(t,e){super(t,"not-in",e),this.keys=js(0,e)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function js(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(t=>ys.fromName(t.referenceValue))}class $s extends Vs{constructor(t,e){super(t,"array-contains",e)}matches(t){t=t.data.field(this.field);return As(t)&&bs(t.arrayValue,this.value)}}class Ks extends Vs{constructor(t,e){super(t,"in",e)}matches(t){t=t.data.field(this.field);return null!==t&&bs(this.value.arrayValue,t)}}class Gs extends Vs{constructor(t,e){super(t,"not-in",e)}matches(t){if(bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!bs(this.value.arrayValue,t)}}class Hs extends Vs{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!As(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>bs(this.value.arrayValue,t))}}class zs{constructor(t,e){this.position=t,this.before=e}}function Qs(t){return`${t.before?"b":"a"}:${t.position.map(t=>Is(t)).join(",")}`}class Ws{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ys(e,n,r){let s=0;for(let t=0;t<e.position.length;t++){const i=n[t],o=e.position[t];if(s=i.field.isKeyField()?ys.comparator(ys.fromName(o.referenceValue),r.key):Ts(o,r.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return e.before?s<=0:s<0}function Xs(e,n){if(null===e)return null===n;if(null===n)return!1;if(e.before!==n.before||e.position.length!==n.position.length)return!1;for(let t=0;t<e.position.length;t++)if(!vs(e.position[t],n.position[t]))return!1;return!0}class Js{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt}}function Zs(t,e,n,r,s,i,o,a){return new Js(t,e,n,r,s,i,o,a)}function ti(t){return new Js(t)}function ei(t){return!gs(t.limit)&&"F"===t.limitType}function ni(t){return!gs(t.limit)&&"L"===t.limitType}function ri(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function si(t){for(const e of t.filters)if(e.g())return e.field;return null}function ii(t){return null!==t.collectionGroup}function oi(e){const n=e;if(null===n.p){n.p=[];const e=si(n),t=ri(n);if(null!==e&&null===t)e.isKeyField()||n.p.push(new Ws(e)),n.p.push(new Ws(is.keyField(),"asc"));else{let t=!1;for(const r of n.explicitOrderBy)n.p.push(r),r.field.isKeyField()&&(t=!0);if(!t){const e=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.p.push(new Ws(is.keyField(),e))}}}return n.p}function ai(t){const e=t;if(!e.T)if("F"===e.limitType)e.T=Os(e.path,e.collectionGroup,oi(e),e.filters,e.limit,e.startAt,e.endAt);else{const r=[];for(const s of oi(e)){const e="desc"===s.dir?"asc":"desc";r.push(new Ws(s.field,e))}var n=e.endAt?new zs(e.endAt.position,!e.endAt.before):null,t=e.startAt?new zs(e.startAt.position,!e.startAt.before):null;e.T=Os(e.path,e.collectionGroup,r,e.filters,e.limit,n,t)}return e.T}function hi(t,e,n){return new Js(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ui(t,e){return Ps(ai(t),ai(e))&&t.limitType===e.limitType}function ci(t){return`${Ms(ai(t))}|lt:${t.limitType}`}function li(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),0<t.filters.length&&(e+=`, filters: [${t.filters.map(t=>{return`${(t=t).field.canonicalString()} ${t.op} ${Is(t.value)}`}).join(", ")}]`),gs(t.limit)||(e+=", limit: "+t.limit),0<t.orderBy.length&&(e+=`, orderBy: [${t.orderBy.map(t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Qs(t.startAt)),t.endAt&&(e+=", endAt: "+Qs(t.endAt)),`Target(${e})`}(ai(t))}; limitType=${t.limitType})`}function di(n,t){return t.isFoundDocument()&&(e=n,r=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):ys.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r))&&function(t){for(const e of n.explicitOrderBy)if(!e.field.isKeyField()&&null===t.data.field(e.field))return;return 1}(t)&&function(t){for(const e of n.filters)if(!e.matches(t))return;return 1}(t)&&(r=t,(!(t=n).startAt||Ys(t.startAt,oi(t),r))&&(!t.endAt||!Ys(t.endAt,oi(t),r)));var e,r}function fi(s){return(t,e)=>{let n=!1;for(const r of oi(s)){const s=function(t,r,e){var n=t.field.isKeyField()?ys.comparator(r.key,e.key):function(t,e){var n=r.data.field(t),t=e.data.field(t);return null!==n&&null!==t?Ts(n,t):Gr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Gr()}}(r,t,e);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function gi(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ms(e)?"-0":e}}function mi(t){return{integerValue:""+t}}function pi(t,e){return ps(e)?mi(e):gi(t,e)}class yi{constructor(){this._=void 0}}function wi(t,e){return t instanceof _i?Ss(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}class vi extends yi{}class bi extends yi{constructor(t){super(),this.elements=t}}function Ti(t,e){const n=Ai(e);for(const e of t.elements)n.some(t=>vs(t,e))||n.push(e);return{arrayValue:{values:n}}}class Ei extends yi{constructor(t){super(),this.elements=t}}function Ii(t,e){let n=Ai(e);for(const e of t.elements)n=n.filter(t=>!vs(t,e));return{arrayValue:{values:n}}}class _i extends yi{constructor(t,e){super(),this.R=t,this.A=e}}function Si(t){return cs(t.integerValue||t.doubleValue)}function Ai(t){return As(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Di{constructor(t,e){this.field=t,this.transform=e}}class Ni{constructor(t,e){this.version=t,this.transformResults=e}}class Ci{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ci}static exists(t){return new Ci(void 0,t)}static updateTime(t){return new Ci(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function xi(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ki{}function Ri(t,e,n){t instanceof Pi?function(t,e,n){const r=t.value.clone(),s=Ui(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Fi?function(t,e,n){if(!xi(t.precondition,e))return e.convertToUnknownDocument(n.version);const r=Ui(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Vi(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):e.convertToNoDocument(n.version).setHasCommittedMutations()}function Li(t,e,n){t instanceof Pi?function(t,e,n){if(xi(t.precondition,e)){const r=t.value.clone(),s=qi(t.fieldTransforms,n,e);r.setAll(s),e.convertToFoundDocument(Mi(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Fi?function(t,e,n){if(xi(t.precondition,e)){const r=qi(t.fieldTransforms,n,e),s=e.data;s.setAll(Vi(t)),s.setAll(r),e.convertToFoundDocument(Mi(e),s).setHasLocalMutations()}}(t,e,n):(e=e,xi(t.precondition,e)&&e.convertToNoDocument(Jr.min()))}function Oi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Wr(n,r,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof bi&&e instanceof bi||t instanceof Ei&&e instanceof Ei?Wr(t.elements,e.elements,vs):t instanceof _i&&e instanceof _i?vs(t.A,e.A):t instanceof vi&&e instanceof vi)}(t,e)))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask)));var n,r}function Mi(t){return t.isFoundDocument()?t.version:Jr.min()}class Pi extends ki{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Fi extends ki{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function Vi(n){const r=new Map;return n.fieldMask.fields.forEach(t=>{var e;t.isEmpty()||(e=n.data.field(t),r.set(t,e))}),r}function Ui(e,n,r){const s=new Map;Hr(e.length===r.length);for(let t=0;t<r.length;t++){var i=e[t],o=i.transform,a=n.data.field(i.field);s.set(i.field,(i=o,o=a,a=r[t],i instanceof bi?Ti(i,o):i instanceof Ei?Ii(i,o):a))}return s}function qi(t,e,n){const r=new Map;for(const u of t){const t=u.transform,c=n.data.field(u.field);r.set(u.field,(s=t,i=c,o=e,h=a=void 0,s instanceof vi?function(){const t={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return i&&(t.fields.__previous_value__=i),{mapValue:t}}():s instanceof bi?Ti(s,i):s instanceof Ei?Ii(s,i):(h=wi(a=s,i),s=Si(h)+Si(a.A),Ss(h)&&Ss(a.A)?mi(s):gi(a.R,s))))}var s,i,o,a,h;return r}class Bi extends ki{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class ji extends ki{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class $i{constructor(t){this.count=t}}function Ki(t){switch(t){case Fr.OK:return Gr(),0;case Fr.CANCELLED:case Fr.UNKNOWN:case Fr.DEADLINE_EXCEEDED:case Fr.RESOURCE_EXHAUSTED:case Fr.INTERNAL:case Fr.UNAVAILABLE:case Fr.UNAUTHENTICATED:return;case Fr.INVALID_ARGUMENT:case Fr.NOT_FOUND:case Fr.ALREADY_EXISTS:case Fr.PERMISSION_DENIED:case Fr.FAILED_PRECONDITION:case Fr.ABORTED:case Fr.OUT_OF_RANGE:case Fr.UNIMPLEMENTED:case Fr.DATA_LOSS:return 1;default:return Gr(),0}}function Gi(t){if(void 0===t)return jr("GRPC error has no .code"),Fr.UNKNOWN;switch(t){case Sr.OK:return Fr.OK;case Sr.CANCELLED:return Fr.CANCELLED;case Sr.UNKNOWN:return Fr.UNKNOWN;case Sr.DEADLINE_EXCEEDED:return Fr.DEADLINE_EXCEEDED;case Sr.RESOURCE_EXHAUSTED:return Fr.RESOURCE_EXHAUSTED;case Sr.INTERNAL:return Fr.INTERNAL;case Sr.UNAVAILABLE:return Fr.UNAVAILABLE;case Sr.UNAUTHENTICATED:return Fr.UNAUTHENTICATED;case Sr.INVALID_ARGUMENT:return Fr.INVALID_ARGUMENT;case Sr.NOT_FOUND:return Fr.NOT_FOUND;case Sr.ALREADY_EXISTS:return Fr.ALREADY_EXISTS;case Sr.PERMISSION_DENIED:return Fr.PERMISSION_DENIED;case Sr.FAILED_PRECONDITION:return Fr.FAILED_PRECONDITION;case Sr.ABORTED:return Fr.ABORTED;case Sr.OUT_OF_RANGE:return Fr.OUT_OF_RANGE;case Sr.UNIMPLEMENTED:return Fr.UNIMPLEMENTED;case Sr.DATA_LOSS:return Fr.DATA_LOSS;default:return Gr()}}(S=Sr=Sr||{})[S.OK=0]="OK",S[S.CANCELLED=1]="CANCELLED",S[S.UNKNOWN=2]="UNKNOWN",S[S.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",S[S.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",S[S.NOT_FOUND=5]="NOT_FOUND",S[S.ALREADY_EXISTS=6]="ALREADY_EXISTS",S[S.PERMISSION_DENIED=7]="PERMISSION_DENIED",S[S.UNAUTHENTICATED=16]="UNAUTHENTICATED",S[S.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",S[S.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",S[S.ABORTED=10]="ABORTED",S[S.OUT_OF_RANGE=11]="OUT_OF_RANGE",S[S.UNIMPLEMENTED=12]="UNIMPLEMENTED",S[S.INTERNAL=13]="INTERNAL",S[S.UNAVAILABLE=14]="UNAVAILABLE",S[S.DATA_LOSS=15]="DATA_LOSS";class Hi{constructor(t,e){this.comparator=t,this.root=e||Qi.EMPTY}insert(t,e){return new Hi(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Qi.BLACK,null,null))}remove(t){return new Hi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Qi.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(n){this.inorderTraversal((t,e)=>(n(t,e),!1))}toString(){const n=[];return this.inorderTraversal((t,e)=>(n.push(`${t}:${e}`),!1)),`{${n.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new zi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new zi(this.root,t,this.comparator,!1)}getReverseIterator(){return new zi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new zi(this.root,t,this.comparator,!0)}}class zi{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();var e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Qi{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Qi.RED,this.left=null!=r?r:Qi.EMPTY,this.right=null!=s?s:Qi.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Qi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;var s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Qi.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Qi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){var t=this.copy(null,null,Qi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){var t=this.copy(null,null,Qi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){var t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Gr();if(this.right.isRed())throw Gr();var t=this.left.check();if(t!==this.right.check())throw Gr();return t+(this.isRed()?0:1)}}Qi.EMPTY=null,Qi.RED=!0,Qi.BLACK=!1,Qi.EMPTY=new class{constructor(){this.size=0}get key(){throw Gr()}get value(){throw Gr()}get color(){throw Gr()}get left(){throw Gr()}get right(){throw Gr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Qi(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Wi{constructor(t){this.comparator=t,this.data=new Hi(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(n){this.data.inorderTraversal((t,e)=>(n(t),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Yi(this.data.getIterator())}getIteratorFrom(t){return new Yi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof Wi))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(t){const e=new Wi(this.comparator);return e.data=t,e}}class Yi{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const Xi=new Hi(ys.comparator);const Ji=new Hi(ys.comparator);const Zi=new Hi(ys.comparator);const to=new Wi(ys.comparator);function eo(...t){let e=to;for(const n of t)e=e.add(n);return e}const no=new Wi(Qr);class ro{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,so.createSynthesizedTargetChangeForCurrentChange(t,e)),new ro(Jr.min(),n,no,Xi,eo())}}class so{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new so(as.EMPTY_BYTE_STRING,e,eo(),eo(),eo())}}class io{constructor(t,e,n,r){this.P=t,this.removedTargetIds=e,this.key=n,this.v=r}}class oo{constructor(t,e){this.targetId=t,this.V=e}}class ao{constructor(t,e,n=as.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class ho{constructor(){this.S=0,this.D=lo(),this.C=as.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}get current(){return this.N}get resumeToken(){return this.C}get $(){return 0!==this.S}get O(){return this.k}F(t){0<t.approximateByteSize()&&(this.k=!0,this.C=t)}M(){let n=eo(),r=eo(),s=eo();return this.D.forEach((t,e)=>{switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:s=s.add(t);break;default:Gr()}}),new so(this.C,this.N,n,r,s)}L(){this.k=!1,this.D=lo()}B(t,e){this.k=!0,this.D=this.D.insert(t,e)}U(t){this.k=!0,this.D=this.D.remove(t)}q(){this.S+=1}K(){--this.S}j(){this.k=!0,this.N=!0}}class uo{constructor(t){this.W=t,this.G=new Map,this.H=Xi,this.J=co(),this.Y=new Wi(Qr)}X(t){for(const e of t.P)t.v&&t.v.isFoundDocument()?this.Z(e,t.v):this.tt(e,t.key,t.v);for(const n of t.removedTargetIds)this.tt(n,t.key,t.v)}et(n){this.forEachTarget(n,t=>{const e=this.nt(t);switch(n.state){case 0:this.st(t)&&e.F(n.resumeToken);break;case 1:e.K(),e.$||e.L(),e.F(n.resumeToken);break;case 2:e.K(),e.$||this.removeTarget(t);break;case 3:this.st(t)&&(e.j(),e.F(n.resumeToken));break;case 4:this.st(t)&&(this.it(t),e.F(n.resumeToken));break;default:Gr()}})}forEachTarget(t,n){0<t.targetIds.length?t.targetIds.forEach(n):this.G.forEach((t,e)=>{this.st(e)&&n(e)})}rt(t){const e=t.targetId,n=t.V.count,r=this.ot(e);if(r){const t=r.target;if(Fs(t))if(0===n){const n=new ys(t.path);this.tt(e,n,Rs.newNoDocument(n,Jr.min()))}else Hr(1===n);else this.at(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}}ct(r){const s=new Map;this.G.forEach((t,e)=>{var n=this.ot(e);if(n){if(t.current&&Fs(n.target)){const s=new ys(n.target.path);null!==this.H.get(s)||this.ut(e,s)||this.tt(e,s,Rs.newNoDocument(s,r))}t.O&&(s.set(e,t.M()),t.L())}});let i=eo();this.J.forEach((t,e)=>{let n=!0;e.forEachWhile(t=>{t=this.ot(t);return!t||2===t.purpose||(n=!1)}),n&&(i=i.add(t))});var t=new ro(r,s,this.Y,this.H,i);return this.H=Xi,this.J=co(),this.Y=new Wi(Qr),t}Z(t,e){var n;this.st(t)&&(n=this.ut(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))}tt(t,e,n){if(this.st(t)){const r=this.nt(t);this.ut(t,e)?r.B(e,1):r.U(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}}removeTarget(t){this.G.delete(t)}at(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}q(t){this.nt(t).q()}nt(t){let e=this.G.get(t);return e||(e=new ho,this.G.set(t,e)),e}ht(t){let e=this.J.get(t);return e||(e=new Wi(Qr),this.J=this.J.insert(t,e)),e}st(t){var e=null!==this.ot(t);return e||Br("WatchChangeAggregator","Detected inactive target",t),e}ot(t){var e=this.G.get(t);return e&&e.$?null:this.W.lt(t)}it(e){this.G.set(e,new ho),this.W.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}ut(t,e){return this.W.getRemoteKeysForTarget(t).has(e)}}function co(){return new Hi(ys.comparator)}function lo(){return new Hi(ys.comparator)}const fo={asc:"ASCENDING",desc:"DESCENDING"},go={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class mo{constructor(t,e){this.databaseId=t,this.I=e}}function po(t,e){return t.I?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function yo(t,e){return t.I?e.toBase64():e.toUint8Array()}function wo(t){return Hr(!!t),Jr.fromTimestamp((t=us(t),new Xr(t.seconds,t.nanos)))}function vo(t,e){return t=t,new rs(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function bo(t){t=rs.fromString(t);return Hr(qo(t)),t}function To(t,e){return vo(t.databaseId,e.path)}function Eo(t,e){const n=bo(e);if(n.get(1)!==t.databaseId.projectId)throw new Vr(Fr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Vr(Fr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ys(Ao(n))}function Io(t,e){return vo(t.databaseId,e)}function _o(t){t=bo(t);return 4===t.length?rs.emptyPath():Ao(t)}function So(t){return new rs(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ao(t){return Hr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function Do(t,e,n){return{name:To(t,e),fields:n.value.mapValue.fields}}function No(t,e,n){const r=Eo(t,e.name),s=wo(e.updateTime),i=new ks({mapValue:{fields:e.fields}}),o=Rs.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Co(t,e){let n;if(e instanceof Pi)n={update:Do(t,e.key,e.value)};else if(e instanceof Bi)n={delete:To(t,e.key)};else if(e instanceof Fi)n={update:Do(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}(e.fieldMask)};else{if(!(e instanceof ji))return Gr();n={verify:To(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t){var e=t.transform;if(e instanceof vi)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof bi)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Ei)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof _i)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Gr()}(t))),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:po(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Gr()),n}function xo(e,n){const t=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?Ci.updateTime(wo(i.updateTime)):void 0!==i.exists?Ci.exists(i.exists):Ci.none():Ci.none(),r=n.updateTransforms?n.updateTransforms.map(t=>function(t,e){let n=null;if("setToServerValue"in e)Hr("REQUEST_TIME"===e.setToServerValue),n=new vi;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new bi(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Ei(t)}else"increment"in e?n=new _i(t,e.increment):Gr();e=is.fromServerFormat(e.fieldPath);return new Di(e,n)}(e,t)):[];if(n.update){n.update.name;var s=Eo(e,n.update.name),i=new ks({mapValue:{fields:n.update.fields}});if(n.updateMask){const e=function(){const t=n.updateMask.fieldPaths||[];return new os(t.map(t=>is.fromServerFormat(t)))}();return new Fi(s,i,e,t,r)}return new Pi(s,i,t,r)}if(n.delete){const r=Eo(e,n.delete);return new Bi(r,t)}if(n.verify){const r=Eo(e,n.verify);return new ji(r,t)}return Gr()}function ko(t,e){return{documents:[Io(t,e.path)]}}function Ro(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Io(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Io(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s=function(t){if(0!==t.length){t=t.map(t=>function(t){if("=="===t.op){if(Ns(t.value))return{unaryFilter:{field:Po(t.field),op:"IS_NAN"}};if(Ds(t.value))return{unaryFilter:{field:Po(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ns(t.value))return{unaryFilter:{field:Po(t.field),op:"IS_NOT_NAN"}};if(Ds(t.value))return{unaryFilter:{field:Po(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Po(t.field),op:(e=t.op,go[e]),value:t.value}};var e}(t));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);s&&(n.structuredQuery.where=s);s=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:Po(t.field),direction:(t=t.dir,fo[t])}}(t))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);s=e.limit,s=t.I||gs(s)?s:{value:s};return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Oo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Oo(e.endAt)),n}function Lo(t){let e=_o(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(0<r){Hr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function e(t){return t?void 0!==t.unaryFilter?[Uo(t)]:void 0!==t.fieldFilter?[Vo(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(t=>e(t)).reduce((t,e)=>t.concat(e)):Gr():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>function(t){return new Ws(Fo(t.field),function(){switch(t.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(t)));let a=null;n.limit&&(a=function(t){t="object"==typeof t?t.value:t;return gs(t)?null:t}(n.limit));let h=null;n.startAt&&(h=Mo(n.startAt));let u=null;return n.endAt&&(u=Mo(n.endAt)),Zs(e,s,o,i,a,"F",h,u)}function Oo(t){return{before:t.before,values:t.position}}function Mo(t){var e=!!t.before,t=t.values||[];return new zs(t,e)}function Po(t){return{fieldPath:t.canonicalString()}}function Fo(t){return is.fromServerFormat(t.fieldPath)}function Vo(t){return Vs.create(Fo(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Gr()}}(),t.fieldFilter.value)}function Uo(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Fo(t.unaryFilter.field);return Vs.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Fo(t.unaryFilter.field);return Vs.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Fo(t.unaryFilter.field);return Vs.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Fo(t.unaryFilter.field);return Vs.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Gr()}}function qo(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Bo(e){let n="";for(let t=0;t<e.length;t++)0<n.length&&(n=jo(n)),n=function(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(t),n);return jo(n)}function jo(t){return t+""}function $o(n){const r=n.length;if(Hr(2<=r),2===r)return Hr(""===n.charAt(0)&&""===n.charAt(1)),rs.emptyPath();const s=r-2,i=[];let o="";for(let e=0;e<r;){const r=n.indexOf("",e);switch((r<0||r>s)&&Gr(),n.charAt(r+1)){case"":const s=n.substring(e,r);let t;0===o.length?t=s:(o+=s,t=o,o=""),i.push(t);break;case"":o+=n.substring(e,r),o+="\0";break;case"":o+=n.substring(e,r+1);break;default:Gr()}e=r+2}return new rs(i)}class Ko{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Go{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Go.store="owner",Go.key="owner";class Ho{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ho.store="mutationQueues",Ho.keyPath="userId";class zo{constructor(t,e,n,r,s){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}zo.store="mutations",zo.keyPath="batchId",zo.userMutationsIndex="userMutationsIndex",zo.userMutationsKeyPath=["userId","batchId"];class Qo{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Bo(e)]}static key(t,e,n){return[t,Bo(e),n]}}Qo.store="documentMutations",Qo.PLACEHOLDER=new Qo;class Wo{constructor(t,e){this.path=t,this.readTime=e}}class Yo{constructor(t,e){this.path=t,this.version=e}}class Xo{constructor(t,e,n,r,s,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}Xo.store="remoteDocuments",Xo.readTimeIndex="readTimeIndex",Xo.readTimeIndexPath="readTime",Xo.collectionReadTimeIndex="collectionReadTimeIndex",Xo.collectionReadTimeIndexPath=["parentPath","readTime"];class Jo{constructor(t){this.byteSize=t}}Jo.store="remoteDocumentGlobal",Jo.key="remoteDocumentGlobalKey";class Zo{constructor(t,e,n,r,s,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Zo.store="targets",Zo.keyPath="targetId",Zo.queryTargetsIndexName="queryTargetsIndex",Zo.queryTargetsKeyPath=["canonicalId","targetId"];class ta{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}ta.store="targetDocuments",ta.keyPath=["targetId","path"],ta.documentTargetsIndex="documentTargetsIndex",ta.documentTargetsKeyPath=["path","targetId"];class ea{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}ea.key="targetGlobalKey",ea.store="targetGlobal";class na{constructor(t,e){this.collectionId=t,this.parent=e}}na.store="collectionParents",na.keyPath=["collectionId","parent"];class ra{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}ra.store="clientMetadata",ra.keyPath="clientId";class sa{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}sa.store="bundles",sa.keyPath="bundleId";class ia{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}ia.store="namedQueries",ia.keyPath="name";const oa=[Ho.store,zo.store,Qo.store,Xo.store,Zo.store,Go.store,ea.store,ta.store,ra.store,Jo.store,na.store,sa.store,ia.store],aa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ha{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}class ua{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ca{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(r,s){return this.callbackAttached&&Gr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new ca((e,n)=>{this.nextCallback=t=>{this.wrapSuccess(r,t).next(e,n)},this.catchCallback=t=>{this.wrapFailure(s,t).next(e,n)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{var e=t();return e instanceof ca?e:ca.resolve(e)}catch(t){return ca.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):ca.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):ca.reject(e)}static resolve(n){return new ca((t,e)=>{t(n)})}static reject(n){return new ca((t,e)=>{e(n)})}static waitFor(t){return new ca((e,n)=>{let r=0,s=0,i=!1;t.forEach(t=>{++r,t.next(()=>{++s,i&&s===r&&e()},t=>n(t))}),i=!0,s===r&&e()})}static or(t){let e=ca.resolve(!1);for(const n of t)e=e.next(t=>t?ca.resolve(t):n());return e}static forEach(t,n){const r=[];return t.forEach((t,e)=>{r.push(n.call(this,t,e))}),this.waitFor(r)}}class la{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.ft=new ua,this.transaction.oncomplete=()=>{this.ft.resolve()},this.transaction.onabort=()=>{t.error?this.ft.reject(new ga(e,t.error)):this.ft.resolve()},this.transaction.onerror=t=>{t=va(t.target.error);this.ft.reject(new ga(e,t))}}static open(t,e,n,r){try{return new la(e,t.transaction(r,n))}catch(t){throw new ga(e,t)}}get dt(){return this.ft.promise}abort(t){t&&this.ft.reject(t),this.aborted||(Br("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){t=this.transaction.objectStore(t);return new pa(t)}}class da{constructor(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===da._t(d())&&jr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Br("SimpleDb","Removing database:",t),ya(window.indexedDB.deleteDatabase(t)).toPromise()}static gt(){if("undefined"==typeof indexedDB)return!1;if(da.yt())return!0;const t=d(),e=da._t(t),n=0<e&&e<10,r=da.Et(t),s=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||s)}static yt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)}static It(t,e){return t.store(e)}static _t(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Et(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async At(s){return this.db||(Br("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{t=t.target.result;e(t)},r.onblocked=()=>{n(new ga(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{t=t.target.error;"VersionError"===t.name?n(new Vr(Fr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new ga(s,t))},r.onupgradeneeded=t=>{Br("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;this.wt.Rt(e,r.transaction,t.oldVersion,this.version).next(()=>{Br("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Pt&&(this.db.onversionchange=t=>this.Pt(t)),this.db}bt(e){this.Pt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(t,e,n,r){var s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.At(t);const e=la.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).catch(t=>(e.abort(t),ca.reject(t))).toPromise();return i.catch(()=>{}),await e.dt,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if(Br("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class fa{constructor(t){this.vt=t,this.Vt=!1,this.St=null}get isDone(){return this.Vt}get Dt(){return this.St}set cursor(t){this.vt=t}done(){this.Vt=!0}Ct(t){this.St=t}delete(){return ya(this.vt.delete())}}class ga extends Vr{constructor(t,e){super(Fr.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ma(t){return"IndexedDbTransactionError"===t.name}class pa{constructor(t){this.store=t}put(t,e){let n;return n=void 0!==e?(Br("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Br("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)),ya(n)}add(t){return Br("SimpleDb","ADD",this.store.name,t,t),ya(this.store.add(t))}get(e){return ya(this.store.get(e)).next(t=>(Br("SimpleDb","GET",this.store.name,e,t=void 0===t?null:t),t))}delete(t){return Br("SimpleDb","DELETE",this.store.name,t),ya(this.store.delete(t))}count(){return Br("SimpleDb","COUNT",this.store.name),ya(this.store.count())}Nt(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(t,e)=>{r.push(e)}).next(()=>r)}kt(t,e){Br("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.$t=!1;e=this.cursor(n);return this.xt(e,(t,e,n)=>n.delete())}Ot(t,e){let n;e?n=t:(n={},e=t);t=this.cursor(n);return this.xt(t,e)}Ft(r){const t=this.cursor({});return new ca((n,e)=>{t.onerror=t=>{t=va(t.target.error);e(t)},t.onsuccess=t=>{const e=t.target.result;e?r(e.primaryKey,e.value).next(t=>{t?e.continue():n()}):n()}})}xt(t,i){const o=[];return new ca((s,e)=>{t.onerror=t=>{e(t.target.error)},t.onsuccess=t=>{const e=t.target.result;if(e){const n=new fa(e),r=i(e.primaryKey,e.value,n);if(r instanceof ca){const t=r.catch(t=>(n.done(),ca.reject(t)));o.push(t)}n.isDone?s():null===n.Dt?e.continue():e.continue(n.Dt)}else s()}}).next(()=>ca.waitFor(o))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.$t?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ya(t){return new ca((e,n)=>{t.onsuccess=t=>{t=t.target.result;e(t)},t.onerror=t=>{t=va(t.target.error);n(t)}})}let wa=!1;function va(t){const e=da._t(d());if(12.2<=e&&e<13){const e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){const t=new Vr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wa||(wa=!0,setTimeout(()=>{throw t},0)),t}}return t}class ba extends ha{constructor(t,e){super(),this.Mt=t,this.currentSequenceNumber=e}}function Ta(t,e){return da.It(t.Mt,e)}class Ea{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Ri(r,e,n[t])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Li(e,t,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(t.key)&&Li(n,t,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(t=>{const e=r.get(t.key),n=e;this.applyToLocalView(n),e.isValidDocument()||n.convertToNoDocument(Jr.min())})}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),eo())}isEqual(t){return this.batchId===t.batchId&&Wr(this.mutations,t.mutations,(t,e)=>Oi(t,e))&&Wr(this.baseMutations,t.baseMutations,(t,e)=>Oi(t,e))}}class Ia{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Hr(t.mutations.length===n.length);let r=Zi;var s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Ia(t,e,n,r)}}class _a{constructor(t,e,n,r,s=Jr.min(),i=Jr.min(),o=as.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new _a(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new _a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Sa{constructor(t){this.Lt=t}}function Aa(t,e){if(e.document)return No(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=ys.fromSegments(e.noDocument.path),n=ka(e.noDocument.readTime),r=Rs.newNoDocument(t,n);return e.hasCommittedMutations?r.setHasCommittedMutations():r}if(e.unknownDocument){const t=ys.fromSegments(e.unknownDocument.path),s=ka(e.unknownDocument.version);return Rs.newUnknownDocument(t,s)}return Gr()}function Da(t,e,n){var r=Na(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const i={name:To(n=t.Lt,(t=e).key),fields:t.data.value.mapValue.fields,updateTime:po(n,t.version.toTimestamp())},o=e.hasCommittedMutations;return new Xo(null,null,i,o,r,s)}if(e.isNoDocument()){const a=e.key.path.toArray(),i=xa(e.version),h=e.hasCommittedMutations;return new Xo(null,new Wo(a,i),null,h,r,s)}if(e.isUnknownDocument()){const a=e.key.path.toArray(),i=xa(e.version);return new Xo(new Yo(a,i),null,null,!0,r,s)}return Gr()}function Na(t){t=t.toTimestamp();return[t.seconds,t.nanoseconds]}function Ca(t){t=new Xr(t[0],t[1]);return Jr.fromTimestamp(t)}function xa(t){t=t.toTimestamp();return new Ko(t.seconds,t.nanoseconds)}function ka(t){t=new Xr(t.seconds,t.nanoseconds);return Jr.fromTimestamp(t)}function Ra(e,n){const r=(n.baseMutations||[]).map(t=>xo(e.Lt,t));for(let t=0;t<n.mutations.length-1;++t){const r=n.mutations[t];if(t+1<n.mutations.length&&void 0!==n.mutations[t+1].transform){const s=n.mutations[t+1];r.updateTransforms=s.transform.fieldTransforms,n.mutations.splice(t+1,1),++t}}const s=n.mutations.map(t=>xo(e.Lt,t)),t=Xr.fromMillis(n.localWriteTimeMs);return new Ea(n.batchId,t,r,s)}function La(t){var e,n=ka(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?ka(t.lastLimboFreeSnapshotVersion):Jr.min();let s;return s=void 0!==t.query.documents?(Hr(1===(e=t.query).documents.length),ai(ti(_o(e.documents[0])))):ai(Lo(t.query)),new _a(s,t.targetId,0,t.lastListenSequenceNumber,n,r,as.fromBase64String(t.resumeToken))}function Oa(t,e){var n=xa(e.snapshotVersion),r=xa(e.lastLimboFreeSnapshotVersion),s=(Fs(e.target)?ko:Ro)(t.Lt,e.target),t=e.resumeToken.toBase64();return new Zo(e.targetId,Ms(e.target),n,t,e.sequenceNumber,r,s)}function Ma(t){var e=Lo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?hi(e,e.limit,"L"):e}class Pa{getBundleMetadata(t,e){return Fa(t).get(e).next(t=>{if(t)return{id:(t=t).bundleId,createTime:ka(t.createTime),version:t.version}})}saveBundleMetadata(t,e){return Fa(t).put({bundleId:(e=e).id,createTime:xa(wo(e.createTime)),version:e.version})}getNamedQuery(t,e){return Va(t).get(e).next(t=>{if(t)return{name:(t=t).name,query:Ma(t.bundledQuery),readTime:ka(t.readTime)}})}saveNamedQuery(t,e){return Va(t).put({name:(e=e).name,readTime:xa(wo(e.readTime)),bundledQuery:e.bundledQuery})}}function Fa(t){return Ta(t,sa.store)}function Va(t){return Ta(t,ia.store)}class Ua{constructor(){this.Bt=new qa}addToCollectionParentIndex(t,e){return this.Bt.add(e),ca.resolve()}getCollectionParents(t,e){return ca.resolve(this.Bt.getEntries(e))}}class qa{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Wi(rs.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Wi(rs.comparator)).toArray()}}class Ba{constructor(){this.Ut=new qa}addToCollectionParentIndex(t,e){if(this.Ut.has(e))return ca.resolve();var n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener(()=>{this.Ut.add(e)});r={collectionId:n,parent:Bo(r)};return ja(t).put(r)}getCollectionParents(t,n){const r=[],e=IDBKeyRange.bound([n,""],[Yr(n),""],!1,!0);return ja(t).Nt(e).next(t=>{for(const e of t){if(e.collectionId!==n)break;r.push($o(e.parent))}return r})}}function ja(t){return Ta(t,na.store)}const $a={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ka{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Ka(t,Ka.DEFAULT_COLLECTION_PERCENTILE,Ka.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ga(t,e,n){const r=t.store(zo.store),s=t.store(Qo.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=r.Ot({range:o},(t,e,n)=>(a++,n.delete()));i.push(h.next(()=>{Hr(1===a)}));const u=[];for(const t of n.mutations){const r=Qo.key(e,t.key.path,n.batchId);i.push(s.delete(r)),u.push(t.key)}return ca.waitFor(i).next(()=>u)}function Ha(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Gr();e=t.noDocument}return JSON.stringify(e).length}Ka.DEFAULT_COLLECTION_PERCENTILE=10,Ka.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ka.DEFAULT=new Ka(41943040,Ka.DEFAULT_COLLECTION_PERCENTILE,Ka.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ka.DISABLED=new Ka(-1,0,0);class za{constructor(t,e,n,r){this.userId=t,this.R=e,this.qt=n,this.referenceDelegate=r,this.Kt={}}static jt(t,e,n,r){Hr(""!==t.uid);t=t.isAuthenticated()?t.uid:"";return new za(t,e,n,r)}checkEmpty(t){let r=!0;var e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Wa(t).Ot({index:zo.userMutationsIndex,range:e},(t,e,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(c,l,d,f){const g=Ya(c),m=Wa(c);return m.add({}).next(t=>{Hr("number"==typeof t);const e=new Ea(t,l,d,f),n=(s=this.R,i=this.userId,o=e,a=o.baseMutations.map(t=>Co(s.Lt,t)),h=o.mutations.map(t=>Co(s.Lt,t)),new zo(i,o.batchId,o.localWriteTime.toMillis(),a,h)),r=[];var s,i,o,a,h;let u=new Wi((t,e)=>Qr(t.canonicalString(),e.canonicalString()));for(const c of f){const l=Qo.key(this.userId,c.key.path,t);u=u.add(c.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,Qo.PLACEHOLDER))}return u.forEach(t=>{r.push(this.qt.addToCollectionParentIndex(c,t))}),c.addOnCommittedListener(()=>{this.Kt[t]=e.keys()}),ca.waitFor(r).next(()=>e)})}lookupMutationBatch(t,e){return Wa(t).get(e).next(t=>t?(Hr(t.userId===this.userId),Ra(this.R,t)):null)}Qt(t,e){return this.Kt[e]?ca.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(t=>{if(t){t=t.keys();return this.Kt[e]=t}return null})}getNextMutationBatchAfterBatchId(t,e){const r=e+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Wa(t).Ot({index:zo.userMutationsIndex,range:n},(t,e,n)=>{e.userId===this.userId&&(Hr(e.batchId>=r),s=Ra(this.R,e)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Wa(t).Ot({index:zo.userMutationsIndex,range:e,reverse:!0},(t,e,n)=>{r=e.batchId,n.done()}).next(()=>r)}getAllMutationBatches(t){var e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Wa(t).Nt(zo.userMutationsIndex,e).next(t=>t.map(t=>Ra(this.R,t)))}getAllMutationBatchesAffectingDocumentKey(i,o){const t=Qo.prefixForPath(this.userId,o.path),e=IDBKeyRange.lowerBound(t),a=[];return Ya(i).Ot({range:e},(t,e,n)=>{var[r,s,t]=t,s=$o(s);if(r===this.userId&&o.path.isEqual(s))return Wa(i).get(t).next(t=>{if(!t)throw Gr();Hr(t.userId===this.userId),a.push(Ra(this.R,t))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let o=new Wi(Qr);const n=[];return t.forEach(i=>{var t=Qo.prefixForPath(this.userId,i.path),t=IDBKeyRange.lowerBound(t),t=Ya(e).Ot({range:t},(t,e,n)=>{var[r,s,t]=t,s=$o(s);r===this.userId&&i.path.isEqual(s)?o=o.add(t):n.done()});n.push(t)}),ca.waitFor(n).next(()=>this.Wt(e,o))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,o=i.length+1,n=Qo.prefixForPath(this.userId,i),r=IDBKeyRange.lowerBound(n);let a=new Wi(Qr);return Ya(t).Ot({range:r},(t,e,n)=>{var[r,s,t]=t,s=$o(s);r===this.userId&&i.isPrefixOf(s)?s.length===o&&(a=a.add(t)):n.done()}).next(()=>this.Wt(t,a))}Wt(e,t){const n=[],r=[];return t.forEach(t=>{r.push(Wa(e).get(t).next(t=>{if(null===t)throw Gr();Hr(t.userId===this.userId),n.push(Ra(this.R,t))}))}),ca.waitFor(r).next(()=>n)}removeMutationBatch(e,n){return Ga(e.Mt,this.userId,n).next(t=>(e.addOnCommittedListener(()=>{this.Gt(n.batchId)}),ca.forEach(t,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Gt(t){delete this.Kt[t]}performConsistencyCheck(n){return this.checkEmpty(n).next(t=>{if(!t)return ca.resolve();const e=IDBKeyRange.lowerBound(Qo.prefixForUser(this.userId)),r=[];return Ya(n).Ot({range:e},(t,e,n)=>{if(t[0]===this.userId){const e=$o(t[1]);r.push(e)}else n.done()}).next(()=>{Hr(0===r.length)})})}containsKey(t,e){return Qa(t,this.userId,e)}zt(t){return Xa(t).get(this.userId).next(t=>t||new Ho(this.userId,-1,""))}}function Qa(t,s,e){const n=Qo.prefixForPath(s,e.path),i=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Ya(t).Ot({range:r,$t:!0},(t,e,n)=>{var[r,t]=t;r===s&&t===i&&(o=!0),n.done()}).next(()=>o)}function Wa(t){return Ta(t,zo.store)}function Ya(t){return Ta(t,Qo.store)}function Xa(t){return Ta(t,Ho.store)}class Ja{constructor(t){this.Ht=t}next(){return this.Ht+=2,this.Ht}static Jt(){return new Ja(0)}static Yt(){return new Ja(-1)}}class Za{constructor(t,e){this.referenceDelegate=t,this.R=e}allocateTargetId(n){return this.Xt(n).next(t=>{const e=new Ja(t.highestTargetId);return t.highestTargetId=e.next(),this.Zt(n,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Xt(t).next(t=>Jr.fromTimestamp(new Xr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Xt(t).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.Xt(e).next(t=>(t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),this.Zt(e,t)))}addTargetData(e,n){return this.te(e,n).next(()=>this.Xt(e).next(t=>(t.targetCount+=1,this.ee(n,t),this.Zt(e,t))))}updateTargetData(t,e){return this.te(t,e)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>th(e).delete(t.targetId)).next(()=>this.Xt(e)).next(t=>(Hr(0<t.targetCount),--t.targetCount,this.Zt(e,t)))}removeTargets(n,r,s){let i=0;const o=[];return th(n).Ot((t,e)=>{e=La(e);e.sequenceNumber<=r&&null===s.get(e.targetId)&&(i++,o.push(this.removeTargetData(n,e)))}).next(()=>ca.waitFor(o)).next(()=>i)}forEachTarget(t,n){return th(t).Ot((t,e)=>{e=La(e);n(e)})}Xt(t){return eh(t).get(ea.key).next(t=>(Hr(null!==t),t))}Zt(t,e){return eh(t).put(ea.key,e)}te(t,e){return th(t).put(Oa(this.R,e))}ee(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Xt(t).next(t=>t.targetCount)}getTargetData(t,r){var e=Ms(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]);let s=null;return th(t).Ot({range:e,index:Zo.queryTargetsIndexName},(t,e,n)=>{e=La(e);Ps(r,e.target)&&(s=e,n.done())}).next(()=>s)}addMatchingKeys(n,t,r){const s=[],i=nh(n);return t.forEach(t=>{var e=Bo(t.path);s.push(i.put(new ta(r,e))),s.push(this.referenceDelegate.addReference(n,r,t))}),ca.waitFor(s)}removeMatchingKeys(n,t,r){const s=nh(n);return ca.forEach(t,t=>{var e=Bo(t.path);return ca.waitFor([s.delete([r,e]),this.referenceDelegate.removeReference(n,r,t)])})}removeMatchingKeysForTargetId(t,e){const n=nh(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=nh(t);let s=eo();return r.Ot({range:n,$t:!0},(t,e,n)=>{t=$o(t[1]),t=new ys(t);s=s.add(t)}).next(()=>s)}containsKey(t,e){e=Bo(e.path),e=IDBKeyRange.bound([e],[Yr(e)],!1,!0);let r=0;return nh(t).Ot({index:ta.documentTargetsIndex,$t:!0,range:e},([t],e,n)=>{0!==t&&(r++,n.done())}).next(()=>0<r)}lt(t,e){return th(t).get(e).next(t=>t?La(t):null)}}function th(t){return Ta(t,Zo.store)}function eh(t){return Ta(t,ea.store)}function nh(t){return Ta(t,ta.store)}async function rh(t){if(t.code!==Fr.FAILED_PRECONDITION||t.message!==aa)throw t;Br("LocalStore","Unexpectedly lost primary lease")}function sh([t,e],[n,r]){n=Qr(t,n);return 0===n?Qr(e,r):n}class ih{constructor(t){this.ne=t,this.buffer=new Wi(sh),this.se=0}ie(){return++this.se}re(t){t=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();sh(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oh{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ae=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ce(t)}stop(){this.ae&&(this.ae.cancel(),this.ae=null)}get started(){return null!==this.ae}ce(t){var e=this.oe?3e5:6e4;Br("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ae=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.ae=null,this.oe=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){ma(t)?Br("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await rh(t)}await this.ce(t)})}}class ah{constructor(t,e){this.ue=t,this.params=e}calculateTargetCount(t,e){return this.ue.he(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return ca.resolve(Pr.o);const n=new ih(e);return this.ue.forEachTarget(t,t=>n.re(t.sequenceNumber)).next(()=>this.ue.le(t,t=>n.re(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.ue.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.ue.removeOrphanedDocuments(t,e)}collect(e,n){return-1===this.params.cacheSizeCollectionThreshold?(Br("LruGarbageCollector","Garbage collection skipped; disabled"),ca.resolve($a)):this.getCacheSize(e).next(t=>t<this.params.cacheSizeCollectionThreshold?(Br("LruGarbageCollector",`Garbage collection skipped; Cache size ${t} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$a):this.fe(e,n))}getCacheSize(t){return this.ue.getCacheSize(t)}fe(e,n){let r,s,i,o,a,h,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(s=t>this.params.maximumSequenceNumbersToCollect?(Br("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),this.params.maximumSequenceNumbersToCollect):t,o=Date.now(),this.nthSequenceNumber(e,s))).next(t=>(r=t,a=Date.now(),this.removeTargets(e,r,n))).next(t=>(i=t,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(t=>(u=Date.now(),qr()<=w.DEBUG&&Br("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-c}ms\n\tDetermined least recently used ${s} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(h-a)+"ms\n"+`\tRemoved ${t} documents in `+(u-h)+"ms\n"+`Total Duration: ${u-c}ms`),ca.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t})))}}class hh{constructor(t,e){this.db=t,this.garbageCollector=(t=this,e=e,new ah(t,e))}he(t){const n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(e=>n.next(t=>e+t))}de(t){let e=0;return this.le(t,t=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}le(t,n){return this.we(t,(t,e)=>n(e))}addReference(t,e,n){return uh(t,n)}removeReference(t,e,n){return uh(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return uh(t,e)}_e(e,n){let r=!1;return Xa(e).Ft(t=>Qa(e,t,n).next(t=>(t&&(r=!0),ca.resolve(!t)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.we(n,(e,t)=>{if(t<=r){const r=this._e(n,e).next(t=>{if(!t)return o++,s.getEntry(n,e).next(()=>(s.removeEntry(e),nh(n).delete([0,Bo(e.path)])))});i.push(r)}}).next(()=>ca.waitFor(i)).next(()=>s.apply(n)).next(()=>o)}removeTarget(t,e){e=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,e)}updateLimboDocument(t,e){return uh(t,e)}we(t,r){const e=nh(t);let s,i=Pr.o;return e.Ot({index:ta.documentTargetsIndex},([t],{path:e,sequenceNumber:n})=>{0===t?(i!==Pr.o&&r(new ys($o(s)),i),i=n,s=e):i=Pr.o}).next(()=>{i!==Pr.o&&r(new ys($o(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function uh(t,e){return nh(t).put((e=e,t=t.currentSequenceNumber,new ta(0,Bo(e.path),t)))}class ch{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(e,n){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let t=0;t<r.length;t++)if(this.equalsFn(r[t][0],e))return void(r[t]=[e,n]);r.push([e,n])}else this.inner[t]=[[e,n]]}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return!1;for(let t=0;t<r.length;t++)if(this.equalsFn(r[t][0],e))return 1===r.length?delete this.inner[n]:r.splice(t,1),!0;return!1}forEach(r){ts(this.inner,(t,e)=>{for(const[t,n]of e)r(t,n)})}isEmpty(){return es(this.inner)}}class lh{constructor(){this.changes=new ch(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}getReadTime(t){t=this.changes.get(t);return t?t.readTime:Jr.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:Rs.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ca.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class dh{constructor(t,e){this.R=t,this.qt=e}addEntry(t,e,n){return mh(t).put(ph(e),n)}removeEntry(t,e){const n=mh(t),r=ph(e);return n.delete(r)}updateMetadata(e,n){return this.getMetadata(e).next(t=>(t.byteSize+=n,this.me(e,t)))}getEntry(t,e){return mh(t).get(ph(e)).next(t=>this.ge(e,t))}ye(t,e){return mh(t).get(ph(e)).next(t=>({document:this.ge(e,t),size:Ha(t)}))}getEntries(t,e){let n=Xi;return this.pe(t,e,(t,e)=>{e=this.ge(t,e);n=n.insert(t,e)}).next(()=>n)}Ee(t,e){let r=Xi,s=new Hi(ys.comparator);return this.pe(t,e,(t,e)=>{var n=this.ge(t,e);r=r.insert(t,n),s=s.insert(t,Ha(e))}).next(()=>({documents:r,Te:s}))}pe(t,e,s){if(e.isEmpty())return ca.resolve();const n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator();let o=i.getNext();return mh(t).Ot({range:n},(t,e,n)=>{for(var r=ys.fromSegments(t);o&&ys.comparator(o,r)<0;)s(o,null),o=i.getNext();o&&o.isEqual(r)&&(s(o,e),o=i.hasNext()?i.getNext():null),o?n.Ct(o.path.toArray()):n.done()}).next(()=>{for(;o;)s(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(t,r,e){let s=Xi;const i=r.path.length+1,n={};if(e.isEqual(Jr.min())){const t=r.path.toArray();n.range=IDBKeyRange.lowerBound(t)}else{const t=r.path.toArray(),s=Na(e);n.range=IDBKeyRange.lowerBound([t,s],!0),n.index=Xo.collectionReadTimeIndex}return mh(t).Ot(n,(t,e,n)=>{t.length===i&&(e=Aa(this.R,e),r.path.isPrefixOf(e.key.path)?di(r,e)&&(s=s.insert(e.key,e)):n.done())}).next(()=>s)}newChangeBuffer(t){return new fh(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return gh(t).get(Jo.key).next(t=>(Hr(!!t),t))}me(t,e){return gh(t).put(Jo.key,e)}ge(t,e){if(e){const t=Aa(this.R,e);if(!t.isNoDocument()||!t.version.isEqual(Jr.min()))return t}return Rs.newInvalidDocument(t)}}class fh extends lh{constructor(t,e){super(),this.Ie=t,this.trackRemovals=e,this.Ae=new ch(t=>t.toString(),(t,e)=>t.isEqual(e))}applyChanges(s){const i=[];let o=0,a=new Wi((t,e)=>Qr(t.canonicalString(),e.canonicalString()));return this.changes.forEach((t,e)=>{var n=this.Ae.get(t);if(e.document.isValidDocument()){var r=Da(this.Ie.R,e.document,this.getReadTime(t));a=a.add(t.path.popLast());e=Ha(r);o+=e-n,i.push(this.Ie.addEntry(s,t,r))}else if(o-=n,this.trackRemovals){const o=Da(this.Ie.R,Rs.newNoDocument(t,Jr.min()),this.getReadTime(t));i.push(this.Ie.addEntry(s,t,o))}else i.push(this.Ie.removeEntry(s,t))}),a.forEach(t=>{i.push(this.Ie.qt.addToCollectionParentIndex(s,t))}),i.push(this.Ie.updateMetadata(s,o)),ca.waitFor(i)}getFromCache(t,e){return this.Ie.ye(t,e).next(t=>(this.Ae.set(e,t.size),t.document))}getAllFromCache(t,e){return this.Ie.Ee(t,e).next(({documents:t,Te:e})=>(e.forEach((t,e)=>{this.Ae.set(t,e)}),t))}}function gh(t){return Ta(t,Jo.store)}function mh(t){return Ta(t,Xo.store)}function ph(t){return t.path.toArray()}class yh{constructor(t){this.R=t}Rt(e,n,t,r){Hr(t<r&&0<=t&&r<=11);const s=new la("createOrUpgrade",n);var i;t<1&&1<=r&&(e.createObjectStore(Go.store),(i=e).createObjectStore(Ho.store,{keyPath:Ho.keyPath}),i.createObjectStore(zo.store,{keyPath:zo.keyPath,autoIncrement:!0}).createIndex(zo.userMutationsIndex,zo.userMutationsKeyPath,{unique:!0}),i.createObjectStore(Qo.store),wh(e),e.createObjectStore(Xo.store));let o=ca.resolve();return t<3&&3<=r&&(0!==t&&((i=e).deleteObjectStore(ta.store),i.deleteObjectStore(Zo.store),i.deleteObjectStore(ea.store),wh(e)),o=o.next(()=>function(){const t=s.store(ea.store),e=new ea(0,0,Jr.min().toTimestamp(),0);return t.put(ea.key,e)}())),t<4&&4<=r&&(0!==t&&(o=o.next(()=>function(r,s){return s.store(zo.store).Nt().next(t=>{r.deleteObjectStore(zo.store),r.createObjectStore(zo.store,{keyPath:zo.keyPath,autoIncrement:!0}).createIndex(zo.userMutationsIndex,zo.userMutationsKeyPath,{unique:!0});const e=s.store(zo.store),n=t.map(t=>e.put(t));return ca.waitFor(n)})}(e,s))),o=o.next(()=>{e.createObjectStore(ra.store,{keyPath:ra.keyPath})})),t<5&&5<=r&&(o=o.next(()=>this.Re(s))),t<6&&6<=r&&(o=o.next(()=>(e.createObjectStore(Jo.store),this.Pe(s)))),t<7&&7<=r&&(o=o.next(()=>this.be(s))),t<8&&8<=r&&(o=o.next(()=>this.ve(e,s))),t<9&&9<=r&&(o=o.next(()=>{var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),function(){const t=n.objectStore(Xo.store);t.createIndex(Xo.readTimeIndex,Xo.readTimeIndexPath,{unique:!1}),t.createIndex(Xo.collectionReadTimeIndex,Xo.collectionReadTimeIndexPath,{unique:!1})}()})),t<10&&10<=r&&(o=o.next(()=>this.Ve(s))),t<11&&11<=r&&(o=o.next(()=>{e.createObjectStore(sa.store,{keyPath:sa.keyPath}),e.createObjectStore(ia.store,{keyPath:ia.keyPath})})),o}Pe(e){let n=0;return e.store(Xo.store).Ot((t,e)=>{n+=Ha(e)}).next(()=>{var t=new Jo(n);return e.store(Jo.store).put(Jo.key,t)})}Re(n){const t=n.store(Ho.store),r=n.store(zo.store);return t.Nt().next(t=>ca.forEach(t,e=>{var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return r.Nt(zo.userMutationsIndex,t).next(t=>ca.forEach(t,t=>{Hr(t.userId===e.userId);t=Ra(this.R,t);return Ga(n,e.userId,t).next(()=>{})}))}))}be(t){const o=t.store(ta.store),e=t.store(Xo.store);return t.store(ea.store).get(ea.key).next(s=>{const i=[];return e.Ot((t,e)=>{const n=new rs(t),r=[0,Bo(n)];i.push(o.get(r).next(t=>t?ca.resolve():(t=>o.put(new ta(0,Bo(t),s.highestListenSequenceNumber)))(n)))}).next(()=>ca.waitFor(i))})}ve(t,e){t.createObjectStore(na.store,{keyPath:na.keyPath});const n=e.store(na.store),r=new qa,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:Bo(r)})}};return e.store(Xo.store).Ot({$t:!0},(t,e)=>{const n=new rs(t);return s(n.popLast())}).next(()=>e.store(Qo.store).Ot({$t:!0},([,t],e)=>{const n=$o(t);return s(n.popLast())}))}Ve(t){const n=t.store(Zo.store);return n.Ot((t,e)=>{e=La(e),e=Oa(this.R,e);return n.put(e)})}}function wh(t){t.createObjectStore(ta.store,{keyPath:ta.keyPath}).createIndex(ta.documentTargetsIndex,ta.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Zo.store,{keyPath:Zo.keyPath}).createIndex(Zo.queryTargetsIndexName,Zo.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ea.store)}const vh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class bh{constructor(t,e,n,r,s,i,o,a,h,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=s,this.window=i,this.document=o,this.De=h,this.Ce=u,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.$e=null,this.Oe=null,this.Fe=Number.NEGATIVE_INFINITY,this.Me=t=>Promise.resolve(),!bh.gt())throw new Vr(Fr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new hh(this,r),this.Le=e+"main",this.R=new Sa(a),this.Be=new da(this.Le,11,new yh(this.R)),this.Ue=new Za(this.referenceDelegate,this.R),this.qt=new Ba,this.qe=(e=this.R,a=this.qt,new dh(e,a)),this.Ke=new Pa,this.window&&this.window.localStorage?this.je=this.window.localStorage:(this.je=null,!1===u&&jr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Qe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Vr(Fr.FAILED_PRECONDITION,vh);return this.We(),this.Ge(),this.ze(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Ue.getHighestSequenceNumber(t))}).then(t=>{this.Ne=new Pr(t,this.De)}).then(()=>{this.xe=!0}).catch(t=>(this.Be&&this.Be.close(),Promise.reject(t)))}He(e){return this.Me=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Be.bt(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(async()=>{this.started&&await this.Qe()}))}Qe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Eh(e).put(new ra(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Je(e).next(t=>{t||(this.isPrimary=!1,this.Se.enqueueRetryable(()=>this.Me(!1)))})}).next(()=>this.Ye(e)).next(t=>this.isPrimary&&!t?this.Xe(e).next(()=>!1):!!t&&this.Ze(e).next(()=>!0))).catch(t=>{if(ma(t))return Br("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Br("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Se.enqueueRetryable(()=>this.Me(t)),this.isPrimary=t})}Je(t){return Th(t).get(Go.key).next(t=>ca.resolve(this.tn(t)))}en(t){return Eh(t).delete(this.clientId)}async nn(){if(this.isPrimary&&!this.sn(this.Fe,18e5)){this.Fe=Date.now();var t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Ta(t,ra.store);return r.Nt().next(t=>{const e=this.rn(t,18e5),n=t.filter(t=>-1===e.indexOf(t));return ca.forEach(n,t=>r.delete(t.clientId)).next(()=>n)})}).catch(()=>[]);if(this.je)for(const e of t)this.je.removeItem(this.on(e.clientId))}}ze(){this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Qe().then(()=>this.nn()).then(()=>this.ze()))}tn(t){return!!t&&t.ownerId===this.clientId}Ye(e){return this.Ce?ca.resolve(!0):Th(e).get(Go.key).next(t=>{if(null!==t&&this.sn(t.leaseTimestampMs,5e3)&&!this.an(t.ownerId)){if(this.tn(t)&&this.networkEnabled)return!0;if(!this.tn(t)){if(!t.allowTabSynchronization)throw new Vr(Fr.FAILED_PRECONDITION,vh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Eh(e).Nt().next(t=>void 0===this.rn(t,5e3).find(t=>{if(this.clientId!==t.clientId){var e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,t=this.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&Br("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.xe=!1,this.cn(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.un(),this.hn(),await this.Be.runTransaction("shutdown","readwrite",[Go.store,ra.store],t=>{const e=new ba(t,Pr.o);return this.Xe(e).next(()=>this.en(e))}),this.Be.close(),this.ln()}rn(t,e){return t.filter(t=>this.sn(t.updateTimeMs,e)&&!this.an(t.clientId))}fn(){return this.runTransaction("getActiveClients","readonly",t=>Eh(t).Nt().next(t=>this.rn(t,18e5).map(t=>t.clientId)))}get started(){return this.xe}getMutationQueue(t){return za.jt(t,this.R,this.qt,this.referenceDelegate)}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getIndexManager(){return this.qt}getBundleCache(){return this.Ke}runTransaction(e,n,r){Br("IndexedDbPersistence","Starting transaction:",e);let s;return this.Be.runTransaction(e,"readonly"===n?"readonly":"readwrite",oa,t=>(s=new ba(t,this.Ne?this.Ne.next():Pr.o),"readwrite-primary"===n?this.Je(s).next(t=>!!t||this.Ye(s)).next(t=>{if(!t)throw jr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Se.enqueueRetryable(()=>this.Me(!1)),new Vr(Fr.FAILED_PRECONDITION,aa);return r(s)}).next(t=>this.Ze(s).next(()=>t)):this.dn(s).next(()=>r(s)))).then(t=>(s.raiseOnCommittedEvent(),t))}dn(t){return Th(t).get(Go.key).next(t=>{if(null!==t&&this.sn(t.leaseTimestampMs,5e3)&&!this.an(t.ownerId)&&!this.tn(t)&&!(this.Ce||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Vr(Fr.FAILED_PRECONDITION,vh)})}Ze(t){var e=new Go(this.clientId,this.allowTabSynchronization,Date.now());return Th(t).put(Go.key,e)}static gt(){return da.gt()}Xe(t){const e=Th(t);return e.get(Go.key).next(t=>this.tn(t)?(Br("IndexedDbPersistence","Releasing primary lease."),e.delete(Go.key)):ca.resolve())}sn(t,e){var n=Date.now();return!(t<n-e||n<t&&(jr(`Detected an update time that is in the future: ${t} > ${n}`),1))}We(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.$e=()=>{this.Se.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Qe()))},this.document.addEventListener("visibilitychange",this.$e),this.inForeground="visible"===this.document.visibilityState)}un(){this.$e&&(this.document.removeEventListener("visibilitychange",this.$e),this.$e=null)}Ge(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=()=>{this.cn(),i()&&navigator.appVersion.match("Version/14")&&this.Se.enterRestrictedMode(!0),this.Se.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ke))}hn(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)}an(t){var e;try{var n=null!==(null===(e=this.je)||void 0===e?void 0:e.getItem(this.on(t)));return Br("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return jr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}cn(){if(this.je)try{this.je.setItem(this.on(this.clientId),String(Date.now()))}catch(t){jr("Failed to set zombie client id.",t)}}ln(){if(this.je)try{this.je.removeItem(this.on(this.clientId))}catch(t){}}on(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Th(t){return Ta(t,Go.store)}function Eh(t){return Ta(t,ra.store)}function Ih(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class _h{constructor(t,e){this.progress=t,this.wn=e}}class Sh{constructor(t,e,n){this.qe=t,this._n=e,this.qt=n}mn(e,n){return this._n.getAllMutationBatchesAffectingDocumentKey(e,n).next(t=>this.gn(e,n,t))}gn(t,e,n){return this.qe.getEntry(t,e).next(t=>{for(const e of n)e.applyToLocalView(t);return t})}yn(t,n){t.forEach((t,e)=>{for(const t of n)t.applyToLocalView(e)})}pn(e,t){return this.qe.getEntries(e,t).next(t=>this.En(e,t).next(()=>t))}En(t,e){return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>this.yn(e,t))}getDocumentsMatchingQuery(t,e,n){return r=e,ys.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):ii(e)?this.In(t,e,n):this.An(t,e,n);var r}Tn(t,e){return this.mn(t,new ys(e)).next(t=>{let e=Ji;return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}In(n,r,s){const i=r.collectionGroup;let o=Ji;return this.qt.getCollectionParents(n,i).next(t=>ca.forEach(t,t=>{var e,e=(e=r,t=t.child(i),new Js(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return this.An(n,e,s).next(t=>{t.forEach((t,e)=>{o=o.insert(t,e)})})}).next(()=>o))}An(e,n,t){let s,i;return this.qe.getDocumentsMatchingQuery(e,n,t).next(t=>(s=t,this._n.getAllMutationBatchesAffectingQuery(e,n))).next(t=>(i=t,this.Rn(e,i,s).next(e=>{s=e;for(const e of i)for(const r of e.mutations){var n=r.key;let t=s.get(n);null==t&&(t=Rs.newInvalidDocument(n),s=s.insert(n,t)),Li(r,t,e.localWriteTime),t.isFoundDocument()||(s=s.remove(n))}}))).next(()=>(s.forEach((t,e)=>{di(n,e)||(s=s.remove(t))}),s))}Rn(t,e,n){let r=eo();for(const t of e)for(const e of t.mutations)e instanceof Fi&&null===n.get(e.key)&&(r=r.add(e.key));let s=n;return this.qe.getEntries(t,r).next(t=>(t.forEach((t,e)=>{e.isFoundDocument()&&(s=s.insert(t,e))}),s))}}class Ah{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Pn=n,this.bn=r}static vn(t,e){let n=eo(),r=eo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Ah(t,e.fromCache,n,r)}}class Dh{Vn(t){this.Sn=t}getDocumentsMatchingQuery(e,r,s,i){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||s.isEqual(Jr.min())?this.Dn(e,r):this.Sn.pn(e,i).next(t=>{const n=this.Cn(r,t);return(ei(r)||ni(r))&&this.Nn(r.limitType,n,i,s)?this.Dn(e,r):(qr()<=w.DEBUG&&Br("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),li(r)),this.Sn.getDocumentsMatchingQuery(e,r,s).next(e=>(n.forEach(t=>{e=e.insert(t.key,t)}),e)))})}Cn(n,t){let r=new Wi(fi(n));return t.forEach((t,e)=>{di(n,e)&&(r=r.add(e))}),r}Nn(t,e,n,r){if(n.size!==e.size)return!0;const s="F"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}Dn(t,e){return qr()<=w.DEBUG&&Br("QueryEngine","Using full collection scan to execute query:",li(e)),this.Sn.getDocumentsMatchingQuery(t,e,Jr.min())}}class Nh{constructor(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Hi(Qr),this.$n=new ch(t=>Ms(t),Ps),this.On=Jr.min(),this._n=t.getMutationQueue(n),this.Fn=t.getRemoteDocumentCache(),this.Ue=t.getTargetCache(),this.Mn=new Sh(this.Fn,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.kn))}}function Ch(t,e,n,r){return new Nh(t,e,n,r)}async function xh(t,e){const n=t;let r=n._n,o=n.Mn;t=await n.persistence.runTransaction("Handle user change","readonly",s=>{let i;return n._n.getAllMutationBatches(s).next(t=>(i=t,r=n.persistence.getMutationQueue(e),o=new Sh(n.Fn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(s))).next(t=>{const e=[],n=[];let r=eo();for(const s of i){e.push(s.batchId);for(const t of s.mutations)r=r.add(t.key)}for(const s of t){n.push(s.batchId);for(const t of s.mutations)r=r.add(t.key)}return o.pn(s,r).next(t=>({Ln:t,removedBatchIds:e,addedBatchIds:n}))})});return n._n=r,n.Mn=o,n.xn.Vn(n.Mn),t}function kh(t){const e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ue.getLastRemoteSnapshotVersion(t))}function Rh(t,n){const c=t,l=n.snapshotVersion;let d=c.kn;return c.persistence.runTransaction("Apply remote event","readwrite-primary",h=>{const t=c.Fn.newChangeBuffer({trackRemovals:!0});d=c.kn;const u=[];n.targetChanges.forEach((t,e)=>{const n=d.get(e);if(n){u.push(c.Ue.removeMatchingKeys(h,t.removedDocuments,e).next(()=>c.Ue.addMatchingKeys(h,t.addedDocuments,e)));const a=t.resumeToken;var r,s,i,o;0<a.approximateByteSize()&&(r=n.withResumeToken(a,l).withSequenceNumber(h.currentSequenceNumber),d=d.insert(e,r),s=n,o=t,Hr(0<(i=r).resumeToken.approximateByteSize()),0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||u.push(c.Ue.updateTargetData(h,r)))}});let e=Xi;if(n.documentUpdates.forEach((t,e)=>{n.resolvedLimboDocuments.has(t)&&u.push(c.persistence.referenceDelegate.updateLimboDocument(h,t))}),u.push(Lh(h,t,n.documentUpdates,l,void 0).next(t=>{e=t})),!l.isEqual(Jr.min())){const n=c.Ue.getLastRemoteSnapshotVersion(h).next(t=>c.Ue.setTargetsMetadata(h,h.currentSequenceNumber,l));u.push(n)}return ca.waitFor(u).next(()=>t.apply(h)).next(()=>c.Mn.En(h,e)).next(()=>e)}).then(t=>(c.kn=d,t))}function Lh(t,o,e,a,h){let n=eo();return e.forEach(t=>n=n.add(t)),o.getEntries(t,n).next(s=>{let i=Xi;return e.forEach((t,e)=>{const n=s.get(t),r=(null==h?void 0:h.get(t))||a;e.isNoDocument()&&e.version.isEqual(Jr.min())?(o.removeEntry(t,r),i=i.insert(t,e)):!n.isValidDocument()||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(o.addEntry(e,r),i=i.insert(t,e)):Br("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),i})}function Oh(t,r){const s=t;return s.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return s.Ue.getTargetData(e,r).next(t=>t?(n=t,ca.resolve(n)):s.Ue.allocateTargetId(e).next(t=>(n=new _a(r,t,0,e.currentSequenceNumber),s.Ue.addTargetData(e,n).next(()=>n))))}).then(t=>{var e=s.kn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(s.kn=s.kn.insert(t.targetId,t),s.$n.set(r,t.targetId)),t})}async function Mh(t,e,n){const r=t,s=r.kn.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,t=>r.persistence.referenceDelegate.removeTarget(t,s))}catch(t){if(!ma(t))throw t;Br("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.kn=r.kn.remove(e),r.$n.delete(s.target)}function Ph(t,n,r){const s=t;let i=Jr.min(),o=eo();return s.persistence.runTransaction("Execute query","readonly",e=>function(t,e,n){const r=t,s=r.$n.get(n);return void 0!==s?ca.resolve(r.kn.get(s)):r.Ue.getTargetData(e,n)}(s,e,ai(n)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,s.Ue.getMatchingKeysForTargetId(e,t.targetId).next(t=>{o=t})}).next(()=>s.xn.getDocumentsMatchingQuery(e,n,r?i:Jr.min(),r?o:eo())).next(t=>({documents:t,Bn:o})))}function Fh(t,e){const n=t,r=n.Ue,s=n.kn.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",t=>r.lt(t,e).next(t=>t?t.target:null))}function Vh(t){const n=t;return n.persistence.runTransaction("Get new document changes","readonly",t=>function(t,e,n){const r=t;let s=Xi,i=Na(n);const o=mh(e),a=IDBKeyRange.lowerBound(i,!0);return o.Ot({index:Xo.readTimeIndex,range:a},(t,e)=>{var n=Aa(r.R,e);s=s.insert(n.key,n),i=e.readTime}).next(()=>({wn:s,readTime:Ca(i)}))}(n.Fn,t,n.On)).then(({wn:t,readTime:e})=>(n.On=e,t))}class Uh{constructor(t){this.R=t,this.jn=new Map,this.Qn=new Map}getBundleMetadata(t,e){return ca.resolve(this.jn.get(e))}saveBundleMetadata(t,e){return this.jn.set(e.id,{id:e.id,version:e.version,createTime:wo(e.createTime)}),ca.resolve()}getNamedQuery(t,e){return ca.resolve(this.Qn.get(e))}saveNamedQuery(t,e){return this.Qn.set(e.name,{name:(e=e).name,query:Ma(e.bundledQuery),readTime:wo(e.readTime)}),ca.resolve()}}class qh{constructor(){this.Wn=new Wi(Bh.Gn),this.zn=new Wi(Bh.Hn)}isEmpty(){return this.Wn.isEmpty()}addReference(t,e){e=new Bh(t,e);this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)}Jn(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Yn(new Bh(t,e))}Xn(t,e){t.forEach(t=>this.removeReference(t,e))}Zn(t){const e=new ys(new rs([])),n=new Bh(e,t),r=new Bh(e,t+1),s=[];return this.zn.forEachInRange([n,r],t=>{this.Yn(t),s.push(t.key)}),s}ts(){this.Wn.forEach(t=>this.Yn(t))}Yn(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)}es(t){var e=new ys(new rs([])),n=new Bh(e,t),t=new Bh(e,t+1);let r=eo();return this.zn.forEachInRange([n,t],t=>{r=r.add(t.key)}),r}containsKey(t){var e=new Bh(t,0),e=this.Wn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)}}class Bh{constructor(t,e){this.key=t,this.ns=e}static Gn(t,e){return ys.comparator(t.key,e.key)||Qr(t.ns,e.ns)}static Hn(t,e){return Qr(t.ns,e.ns)||ys.comparator(t.key,e.key)}}class jh{constructor(t,e){this.qt=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Wi(Bh.Gn)}checkEmpty(t){return ca.resolve(0===this._n.length)}addMutationBatch(t,e,n,r){var s=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1];n=new Ea(s,e,n,r);this._n.push(n);for(const e of r)this.rs=this.rs.add(new Bh(e.key,s)),this.qt.addToCollectionParentIndex(t,e.key.path.popLast());return ca.resolve(n)}lookupMutationBatch(t,e){return ca.resolve(this.os(e))}getNextMutationBatchAfterBatchId(t,e){e=this.cs(e+1),e=e<0?0:e;return ca.resolve(this._n.length>e?this._n[e]:null)}getHighestUnacknowledgedBatchId(){return ca.resolve(0===this._n.length?-1:this.ss-1)}getAllMutationBatches(t){return ca.resolve(this._n.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Bh(e,0),r=new Bh(e,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([n,r],t=>{t=this.os(t.ns);s.push(t)}),ca.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Wi(Qr);return e.forEach(t=>{var e=new Bh(t,0),t=new Bh(t,Number.POSITIVE_INFINITY);this.rs.forEachInRange([e,t],t=>{n=n.add(t.ns)})}),ca.resolve(this.us(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;ys.isDocumentKey(s)||(s=s.child(""));e=new Bh(new ys(s),0);let i=new Wi(Qr);return this.rs.forEachWhile(t=>{var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)},e),ca.resolve(this.us(i))}us(t){const e=[];return t.forEach(t=>{t=this.os(t);null!==t&&e.push(t)}),e}removeMutationBatch(n,r){Hr(0===this.hs(r.batchId,"removed")),this._n.shift();let s=this.rs;return ca.forEach(r.mutations,t=>{var e=new Bh(t.key,r.batchId);return s=s.delete(e),this.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(()=>{this.rs=s})}Gt(t){}containsKey(t,e){var n=new Bh(e,0),n=this.rs.firstAfterOrEqual(n);return ca.resolve(e.isEqual(n&&n.key))}performConsistencyCheck(t){return this._n.length,ca.resolve()}hs(t,e){return this.cs(t)}cs(t){return 0===this._n.length?0:t-this._n[0].batchId}os(t){t=this.cs(t);return t<0||t>=this._n.length?null:this._n[t]}}class $h{constructor(t,e){this.qt=t,this.ls=e,this.docs=new Hi(ys.comparator),this.size=0}addEntry(t,e,n){const r=e.key,s=this.docs.get(r),i=s?s.size:0,o=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-i,this.qt.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ca.resolve(n?n.document.clone():Rs.newInvalidDocument(e))}getEntries(t,e){let n=Xi;return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():Rs.newInvalidDocument(t))}),ca.resolve(n)}getDocumentsMatchingQuery(t,e,n){let r=Xi;const s=new ys(e.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s,readTime:o}}=i.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||di(e,s)&&(r=r.insert(s.key,s.clone()))}return ca.resolve(r)}fs(t,e){return ca.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new Kh(this)}getSize(t){return ca.resolve(this.size)}}class Kh extends lh{constructor(t){super(),this.Ie=t}applyChanges(n){const r=[];return this.changes.forEach((t,e)=>{e.document.isValidDocument()?r.push(this.Ie.addEntry(n,e.document,this.getReadTime(t))):this.Ie.removeEntry(t)}),ca.waitFor(r)}getFromCache(t,e){return this.Ie.getEntry(t,e)}getAllFromCache(t,e){return this.Ie.getEntries(t,e)}}class Gh{constructor(t){this.persistence=t,this.ds=new ch(t=>Ms(t),Ps),this.lastRemoteSnapshotVersion=Jr.min(),this.highestTargetId=0,this.ws=0,this._s=new qh,this.targetCount=0,this.gs=Ja.Jt()}forEachTarget(t,n){return this.ds.forEach((t,e)=>n(e)),ca.resolve()}getLastRemoteSnapshotVersion(t){return ca.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ca.resolve(this.ws)}allocateTargetId(t){return this.highestTargetId=this.gs.next(),ca.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ca.resolve()}te(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.gs=new Ja(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)}addTargetData(t,e){return this.te(e),this.targetCount+=1,ca.resolve()}updateTargetData(t,e){return this.te(e),ca.resolve()}removeTargetData(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,ca.resolve()}removeTargets(n,r,s){let i=0;const o=[];return this.ds.forEach((t,e)=>{e.sequenceNumber<=r&&null===s.get(e.targetId)&&(this.ds.delete(t),o.push(this.removeMatchingKeysForTargetId(n,e.targetId)),i++)}),ca.waitFor(o).next(()=>i)}getTargetCount(t){return ca.resolve(this.targetCount)}getTargetData(t,e){e=this.ds.get(e)||null;return ca.resolve(e)}addMatchingKeys(t,e,n){return this._s.Jn(e,n),ca.resolve()}removeMatchingKeys(e,t,n){this._s.Xn(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(t=>{s.push(r.markPotentiallyOrphaned(e,t))}),ca.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._s.Zn(e),ca.resolve()}getMatchingKeysForTargetId(t,e){e=this._s.es(e);return ca.resolve(e)}containsKey(t,e){return ca.resolve(this._s.containsKey(e))}}class Hh{constructor(t,e){var n;this.ys={},this.Ne=new Pr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.Ue=new Gh(this),this.qt=new Ua,this.qe=(n=this.qt,t=t=>this.referenceDelegate.ps(t),new $h(n,t)),this.R=new Sa(e),this.Ke=new Uh(this.R)}start(){return Promise.resolve()}shutdown(){return this.xe=!1,Promise.resolve()}get started(){return this.xe}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.qt}getMutationQueue(t){let e=this.ys[t.toKey()];return e||(e=new jh(this.qt,this.referenceDelegate),this.ys[t.toKey()]=e),e}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getBundleCache(){return this.Ke}runTransaction(t,e,n){Br("MemoryPersistence","Starting transaction:",t);const r=new zh(this.Ne.next());return this.referenceDelegate.Es(),n(r).next(t=>this.referenceDelegate.Ts(r).next(()=>t)).toPromise().then(t=>(r.raiseOnCommittedEvent(),t))}Is(e,n){return ca.or(Object.values(this.ys).map(t=>()=>t.containsKey(e,n)))}}class zh extends ha{constructor(t){super(),this.currentSequenceNumber=t}}class Qh{constructor(t){this.persistence=t,this.As=new qh,this.Rs=null}static Ps(t){return new Qh(t)}get bs(){if(this.Rs)return this.Rs;throw Gr()}addReference(t,e,n){return this.As.addReference(n,e),this.bs.delete(n.toString()),ca.resolve()}removeReference(t,e,n){return this.As.removeReference(n,e),this.bs.add(n.toString()),ca.resolve()}markPotentiallyOrphaned(t,e){return this.bs.add(e.toString()),ca.resolve()}removeTarget(t,e){this.As.Zn(e.targetId).forEach(t=>this.bs.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.bs.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Es(){this.Rs=new Set}Ts(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ca.forEach(this.bs,t=>{const e=ys.fromPath(t);return this.vs(n,e).next(t=>{t||r.removeEntry(e)})}).next(()=>(this.Rs=null,r.apply(n)))}updateLimboDocument(t,e){return this.vs(t,e).next(t=>{t?this.bs.delete(e.toString()):this.bs.add(e.toString())})}ps(t){return 0}vs(t,e){return ca.or([()=>ca.resolve(this.As.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Is(t,e)])}}class Wh{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}function Yh(t,e){return`firestore_clients_${t}_${e}`}function Xh(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Jh(t,e){return`firestore_targets_${t}_${e}`}Wh.UNAUTHENTICATED=new Wh(null),Wh.GOOGLE_CREDENTIALS=new Wh("google-credentials-uid"),Wh.FIRST_PARTY=new Wh("first-party-uid"),Wh.MOCK_USER=new Wh("mock-user");class Zh{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Vs(t,e,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new Vr(r.error.code,r.error.message))),i?new Zh(t,e,r.state,s):(jr("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ss(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class tu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Vs(t,e){var n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new Vr(n.error.code,n.error.message))),s?new tu(t,n.state,r):(jr("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Ss(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class eu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Vs(t,e){var n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=no;for(let t=0;r&&t<n.activeTargetIds.length;++t)r=ps(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new eu(t,s):(jr("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class nu{constructor(t,e){this.clientId=t,this.onlineState=e}static Vs(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new nu(e.clientId,e.onlineState):(jr("SharedClientState",`Failed to parse online state: ${t}`),null)}}class ru{constructor(){this.activeTargetIds=no}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}Cs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class su{constructor(t,e,n,r,s){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.$s=new Hi(Qr),this.started=!1,this.Os=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Fs=Yh(this.persistenceKey,this.Ns),this.Ms=`firestore_sequence_number_${this.persistenceKey}`,this.$s=this.$s.insert(this.Ns,new ru),this.Ls=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Bs=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.Us=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.qs=`firestore_online_state_${this.persistenceKey}`,this.Ks=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.xs)}static gt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.fn();for(const n of t)if(n!==this.Ns){const t=this.getItem(Yh(this.persistenceKey,n));var e;!t||(e=eu.Vs(n,t))&&(this.$s=this.$s.insert(e.clientId,e))}this.js();const n=this.storage.getItem(this.qs);if(n){const t=this.Qs(n);t&&this.Ws(t)}for(const t of this.Os)this.ks(t);this.Os=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(t){this.setItem(this.Ms,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Gs(this.$s)}isActiveQueryTarget(n){let r=!1;return this.$s.forEach((t,e)=>{e.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(t){this.zs(t,"pending")}updateMutationState(t,e,n){this.zs(t,e,n),this.Hs(t)}addLocalQueryTarget(t){let e="not-current";var n;return this.isActiveQueryTarget(t)&&(!(n=this.storage.getItem(Jh(this.persistenceKey,t)))||(n=tu.Vs(t,n))&&(e=n.state)),this.Js.Ds(t),this.js(),e}removeLocalQueryTarget(t){this.Js.Cs(t),this.js()}isLocalQueryTarget(t){return this.Js.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Jh(this.persistenceKey,t))}updateQueryState(t,e,n){this.Ys(t,e,n)}handleUserChange(t,e,n){e.forEach(t=>{this.Hs(t)}),this.currentUser=t,n.forEach(t=>{this.addPendingMutation(t)})}setOnlineState(t){this.Xs(t)}notifyBundleLoaded(){this.Zs()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Fs),this.started=!1)}getItem(t){var e=this.storage.getItem(t);return Br("SharedClientState","READ",t,e),e}setItem(t,e){Br("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Br("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ks(t){const r=t;r.storageArea===this.storage&&(Br("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.Fs?this.Se.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Ls.test(r.key)){if(null==r.newValue){var t=this.ti(r.key);return this.ei(t,null)}t=this.ni(r.key,r.newValue);if(t)return this.ei(t.clientId,t)}else if(this.Bs.test(r.key)){if(null!==r.newValue){var e=this.si(r.key,r.newValue);if(e)return this.ii(e)}}else if(this.Us.test(r.key)){if(null!==r.newValue){e=this.ri(r.key,r.newValue);if(e)return this.oi(e)}}else if(r.key===this.qs){if(null!==r.newValue){var n=this.Qs(r.newValue);if(n)return this.Ws(n)}}else if(r.key===this.Ms){n=function(t){let e=Pr.o;if(null!=t)try{var n=JSON.parse(t);Hr("number"==typeof n),e=n}catch(t){jr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(r.newValue);n!==Pr.o&&this.sequenceNumberHandler(n)}else if(r.key===this.Ks)return this.syncEngine.ai()}else this.Os.push(r)}):jr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Js(){return this.$s.get(this.Ns)}js(){this.setItem(this.Fs,this.Js.Ss())}zs(t,e,n){const r=new Zh(this.currentUser,t,e,n),s=Xh(this.persistenceKey,this.currentUser,t);this.setItem(s,r.Ss())}Hs(t){t=Xh(this.persistenceKey,this.currentUser,t);this.removeItem(t)}Xs(t){t={clientId:this.Ns,onlineState:t};this.storage.setItem(this.qs,JSON.stringify(t))}Ys(t,e,n){const r=Jh(this.persistenceKey,t),s=new tu(t,e,n);this.setItem(r,s.Ss())}Zs(){this.setItem(this.Ks,"value-not-used")}ti(t){t=this.Ls.exec(t);return t?t[1]:null}ni(t,e){t=this.ti(t);return eu.Vs(t,e)}si(t,e){var n=this.Bs.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Zh.Vs(new Wh(n),t,e)}ri(t,e){t=this.Us.exec(t),t=Number(t[1]);return tu.Vs(t,e)}Qs(t){return nu.Vs(t)}async ii(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.ci(t.batchId,t.state,t.error);Br("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}oi(t){return this.syncEngine.ui(t.targetId,t.state,t.error)}ei(t,e){const n=e?this.$s.insert(t,e):this.$s.remove(t),r=this.Gs(this.$s),s=this.Gs(n),i=[],o=[];return s.forEach(t=>{r.has(t)||i.push(t)}),r.forEach(t=>{s.has(t)||o.push(t)}),this.syncEngine.hi(i,o).then(()=>{this.$s=n})}Ws(t){this.$s.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Gs(t){let n=no;return t.forEach((t,e)=>{n=n.unionWith(e.activeTargetIds)}),n}}class iu{constructor(){this.li=new ru,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.li.Ds(t),this.fi[t]||"not-current"}updateQueryState(t,e,n){this.fi[t]=e}removeLocalQueryTarget(t){this.li.Cs(t)}isLocalQueryTarget(t){return this.li.activeTargetIds.has(t)}clearQueryState(t){delete this.fi[t]}getAllActiveQueryTargets(){return this.li.activeTargetIds}isActiveQueryTarget(t){return this.li.activeTargetIds.has(t)}start(){return this.li=new ru,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class ou{di(t){}shutdown(){}}class au{constructor(){this.wi=()=>this._i(),this.mi=()=>this.gi(),this.yi=[],this.pi()}di(t){this.yi.push(t)}shutdown(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)}pi(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)}_i(){Br("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.yi)t(0)}gi(){Br("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.yi)t(1)}static gt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const hu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class uu{constructor(t){this.Ei=t.Ei,this.Ti=t.Ti}Ii(t){this.Ai=t}Ri(t){this.Pi=t}onMessage(t){this.bi=t}close(){this.Ti()}send(t){this.Ei(t)}vi(){this.Ai()}Vi(t){this.Pi(t)}Si(t){this.bi(t)}}class cu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Ni(e,t,n,r){const s=this.xi(e,t);Br("RestConnection","Sending: ",s,n);t={};return this.ki(t,r),this.$i(e,s,t,n).then(t=>(Br("RestConnection","Received: ",t),t),t=>{throw $r("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t})}Oi(t,e,n,r){return this.Ni(t,e,n,r)}ki(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+Mr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}xi(t,e){t=hu[t];return`${this.Di}/v1/${e}:${t}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}$i(a,e,n,r){return new Promise((s,i)=>{const o=new Or;o.listenOnce(Nr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Dr.NO_ERROR:var t=o.getResponseJson();Br("Connection","XHR received:",JSON.stringify(t)),s(t);break;case Dr.TIMEOUT:Br("Connection",'RPC "'+a+'" timed out'),i(new Vr(Fr.DEADLINE_EXCEEDED,"Request time out"));break;case Dr.HTTP_ERROR:var e,n=o.getStatus();if(Br("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Fr).indexOf(r)?r:Fr.UNKNOWN,i(new Vr(e,a.message))):i(new Vr(Fr.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Vr(Fr.UNAVAILABLE,"Connection failed."));break;default:Gr()}}finally{Br("Connection",'RPC "'+a+'" completed.')}var r});var t=JSON.stringify(r);o.send(e,"POST",t,n,15)})}Fi(t,e){const n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new br,s=Ar(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(i.xmlHttpFactory=new Rr({})),this.ki(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=d().indexOf("Electron/")||(0<=(e=d()).indexOf("MSIE ")||0<=e.indexOf("Trident/"))||0<=d().indexOf("MSAppHost/")||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Br("Connection","Creating WebChannel: "+o,i);const a=r.createWebChannel(o,i);let h=!1,u=!1;const c=new uu({Ei:t=>{u?Br("Connection","Not sending because WebChannel is closed:",t):(h||(Br("Connection","Opening WebChannel transport."),a.open(),h=!0),Br("Connection","WebChannel sending:",t),a.send(t))},Ti:()=>a.close()}),l=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return l(a,Lr.EventType.OPEN,()=>{u||Br("Connection","WebChannel transport opened.")}),l(a,Lr.EventType.CLOSE,()=>{u||(u=!0,Br("Connection","WebChannel transport closed"),c.Vi())}),l(a,Lr.EventType.ERROR,t=>{u||(u=!0,$r("Connection","WebChannel transport errored:",t),c.Vi(new Vr(Fr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Lr.EventType.MESSAGE,t=>{if(!u){t=t.data[0];Hr(!!t);var n=t.error||(null===(n=t[0])||void 0===n?void 0:n.error);if(n){Br("Connection","WebChannel received error:",n);const r=n.status;let t=function(t){t=Sr[t];if(void 0!==t)return Gi(t)}(r),e=n.message;void 0===t&&(t=Fr.INTERNAL,e="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Vr(t,e)),a.close()}else Br("Connection","WebChannel received:",t),c.Si(t)}}),l(s,Cr.STAT_EVENT,t=>{t.stat===xr?Br("Connection","Detected buffering proxy"):t.stat===kr&&Br("Connection","Detected no buffering proxy")}),setTimeout(()=>{c.vi()},0),c}}function lu(){return"undefined"!=typeof window?window:null}function du(){return"undefined"!=typeof document?document:null}function fu(t){return new mo(t,!0)}class gu{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=s,this.Ui=0,this.qi=null,this.Ki=Date.now(),this.reset()}reset(){this.Ui=0}ji(){this.Ui=this.Bi}Qi(t){this.cancel();var e=Math.floor(this.Ui+this.Wi()),n=Math.max(0,Date.now()-this.Ki),r=Math.max(0,e-n);0<r&&Br("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ui} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qi=this.Se.enqueueAfterDelay(this.timerId,r,()=>(this.Ki=Date.now(),t())),this.Ui*=this.Li,this.Ui<this.Mi&&(this.Ui=this.Mi),this.Ui>this.Bi&&(this.Ui=this.Bi)}Gi(){null!==this.qi&&(this.qi.skipDelay(),this.qi=null)}cancel(){null!==this.qi&&(this.qi.cancel(),this.qi=null)}Wi(){return(Math.random()-.5)*this.Ui}}class mu{constructor(t,e,n,r,s,i){this.Se=t,this.zi=n,this.Hi=r,this.Ji=s,this.listener=i,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new gu(t,e)}tr(){return 1===this.state||2===this.state||4===this.state}er(){return 2===this.state}start(){3!==this.state?this.auth():this.nr()}async stop(){this.tr()&&await this.close(0)}sr(){this.state=0,this.Zi.reset()}ir(){this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,()=>this.rr()))}ar(t){this.cr(),this.stream.send(t)}async rr(){if(this.er())return this.close(0)}cr(){this.Xi&&(this.Xi.cancel(),this.Xi=null)}async close(t,e){this.cr(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Fr.RESOURCE_EXHAUSTED?(jr(e.toString()),jr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.ji()):e&&e.code===Fr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ur(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ri(e)}ur(){}auth(){this.state=1;const t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then(t=>{this.Yi===e&&this.lr(t)},e=>{t(()=>{var t=new Vr(Fr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.dr(t)})})}lr(t){const e=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(()=>{e(()=>(this.state=2,this.listener.Ii()))}),this.stream.Ri(t=>{e(()=>this.dr(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}nr(){this.state=4,this.Zi.Qi(async()=>{this.state=0,this.start()})}dr(t){return Br("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}hr(e){return t=>{this.Se.enqueueAndForget(()=>this.Yi===e?t():(Br("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pu extends mu{constructor(t,e,n,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,s),this.R=r}wr(t){return this.Hi.Fi("Listen",t)}onMessage(t){this.Zi.reset();var e=function(t,e){let n;if("targetChange"in e){e.targetChange;var r="NO_CHANGE"===(i=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:Gr(),s=e.targetChange.targetIds||[],i=(o=e.targetChange.resumeToken,t.I?(Hr(void 0===o||"string"==typeof o),as.fromBase64String(o||"")):(Hr(void 0===o||o instanceof Uint8Array),as.fromUint8Array(o||new Uint8Array))),o=e.targetChange.cause,a=o&&(o=void 0===(a=o).code?Fr.UNKNOWN:Gi(a.code),new Vr(o,a.message||""));n=new ao(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;var h=e.documentChange;h.document,h.document.name,h.document.updateTime;var i=Eo(t,h.document.name),u=wo(h.document.updateTime),a=new ks({mapValue:{fields:h.document.fields}}),u=Rs.newFoundDocument(i,u,a),a=h.targetIds||[],h=h.removedTargetIds||[];n=new io(a,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;h=e.documentDelete;h.document;var u=Eo(t,h.document),c=h.readTime?wo(h.readTime):Jr.min(),c=Rs.newNoDocument(u,c),h=h.removedTargetIds||[];n=new io([],h,c.key,c)}else if("documentRemove"in e){e.documentRemove;c=e.documentRemove;c.document;var l=Eo(t,c.document),c=c.removedTargetIds||[];n=new io([],c,l,null)}else{if(!("filter"in e))return Gr();{e.filter;const t=e.filter;t.targetId;l=t.count||0,e=new $i(l),l=t.targetId;n=new oo(l,e)}}var a,i;return n}(this.R,t),t=function(t){if(!("targetChange"in t))return Jr.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?wo(t.readTime):Jr.min()}(t);return this.listener._r(e,t)}mr(t){const e={};e.database=So(this.R),e.addTarget=function(t,e){let n;var r=e.target;return n=Fs(r)?{documents:ko(t,r)}:{query:Ro(t,r)},n.targetId=e.targetId,0<e.resumeToken.approximateByteSize()?n.resumeToken=yo(t,e.resumeToken):0<e.snapshotVersion.compareTo(Jr.min())&&(n.readTime=po(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n,t=(this.R,n=t,null==(t=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Gr()}}())?null:{"goog-listen-tags":t});t&&(e.labels=t),this.ar(e)}gr(t){const e={};e.database=So(this.R),e.removeTarget=t,this.ar(e)}}class yu extends mu{constructor(t,e,n,r,s){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,s),this.R=r,this.yr=!1}get pr(){return this.yr}start(){this.yr=!1,this.lastStreamToken=void 0,super.start()}ur(){this.yr&&this.Er([])}wr(t){return this.Hi.Fi("Write",t)}onMessage(t){if(Hr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.yr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Hr(void 0!==r),n.map(t=>function(t,e){let n=t.updateTime?wo(t.updateTime):wo(e);return n.isEqual(Jr.min())&&(n=wo(e)),new Ni(n,t.transformResults||[])}(t,r))):[]),n=wo(t.commitTime);return this.listener.Tr(n,e)}var n,r;return Hr(!t.writeResults||0===t.writeResults.length),this.yr=!0,this.listener.Ir()}Ar(){const t={};t.database=So(this.R),this.ar(t)}Er(t){t={streamToken:this.lastStreamToken,writes:t.map(t=>Co(this.R,t))};this.ar(t)}}class wu extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Hi=e,this.R=n,this.Rr=!1}Pr(){if(this.Rr)throw new Vr(Fr.FAILED_PRECONDITION,"The client has already been terminated.")}Ni(e,n,r){return this.Pr(),this.credentials.getToken().then(t=>this.Hi.Ni(e,n,r,t)).catch(t=>{throw"FirebaseError"===t.name?(t.code===Fr.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Vr(Fr.UNKNOWN,t.toString())})}Oi(e,n,r){return this.Pr(),this.credentials.getToken().then(t=>this.Hi.Oi(e,n,r,t)).catch(t=>{throw"FirebaseError"===t.name?(t.code===Fr.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Vr(Fr.UNKNOWN,t.toString())})}terminate(){this.Rr=!0}}class vu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.br=0,this.vr=null,this.Vr=!0}Sr(){0===this.br&&(this.Dr("Unknown"),this.vr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.vr=null,this.Cr("Backend didn't respond within 10 seconds."),this.Dr("Offline"),Promise.resolve())))}Nr(t){"Online"===this.state?this.Dr("Unknown"):(this.br++,1<=this.br&&(this.kr(),this.Cr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Dr("Offline")))}set(t){this.kr(),this.br=0,"Online"===t&&(this.Vr=!1),this.Dr(t)}Dr(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Cr(t){t=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(jr(t),this.Vr=!1):Br("OnlineStateTracker",t)}kr(){null!==this.vr&&(this.vr.cancel(),this.vr=null)}}class bu{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.$r=[],this.Or=new Map,this.Fr=new Set,this.Mr=[],this.Lr=s,this.Lr.di(t=>{n.enqueueAndForget(async()=>{Cu(this)&&(Br("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=t;e.Fr.add(4),await Eu(e),e.Br.set("Unknown"),e.Fr.delete(4),await Tu(e)}(this))})}),this.Br=new vu(n,r)}}async function Tu(t){if(Cu(t))for(const e of t.Mr)await e(!0)}async function Eu(t){for(const e of t.Mr)await e(!1)}function Iu(t,e){const n=t;n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Nu(n)?Du(n):Fu(n).er()&&Su(n,e))}function _u(t,e){const n=t,r=Fu(n);n.Or.delete(e),r.er()&&Au(n,e),0===n.Or.size&&(r.er()?r.ir():Cu(n)&&n.Br.set("Unknown"))}function Su(t,e){t.Ur.q(e.targetId),Fu(t).mr(e)}function Au(t,e){t.Ur.q(e),Fu(t).gr(e)}function Du(e){e.Ur=new uo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.Or.get(t)||null}),Fu(e).start(),e.Br.Sr()}function Nu(t){return Cu(t)&&!Fu(t).tr()&&0<t.Or.size}function Cu(t){return 0===t.Fr.size}function xu(t){t.Ur=void 0}async function ku(t,e,n){if(!ma(e))throw e;t.Fr.add(1),await Eu(t),t.Br.set("Offline"),n=n||(()=>kh(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Br("RemoteStore","Retrying IndexedDB access"),await n(),t.Fr.delete(1),await Tu(t)})}function Ru(e,n){return n().catch(t=>ku(e,t,n))}async function Lu(t){const e=t,n=Vu(e);let r=0<e.$r.length?e.$r[e.$r.length-1].batchId:-1;for(;Cu(s=e)&&s.$r.length<10;)try{const t=await function(t,e){const n=t;return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)))}(e.localStore,r);if(null===t){0===e.$r.length&&n.ir();break}r=t.batchId,function(t,e){t.$r.push(e);const n=Vu(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,t)}catch(t){await ku(e,t)}var s;Ou(e)&&Mu(e)}function Ou(t){return Cu(t)&&!Vu(t).tr()&&0<t.$r.length}function Mu(t){Vu(t).start()}async function Pu(t,e){const n=t;e?(n.Fr.delete(2),await Tu(n)):e||(n.Fr.add(2),await Eu(n),n.Br.set("Unknown"))}function Fu(e){return e.qr||(e.qr=function(t,e,n){const r=t;return r.Pr(),new pu(e,r.Hi,r.credentials,r.R,n)}(e.datastore,e.asyncQueue,{Ii:async function(n){n.Or.forEach((t,e)=>{Su(n,t)})}.bind(null,e),Ri:async function(t,e){xu(t),Nu(t)?(t.Br.Nr(e),Du(t)):t.Br.set("Unknown")}.bind(null,e),_r:async function(t,r,e){if(t.Br.set("Online"),r instanceof ao&&2===r.state&&r.cause)try{await async function(t){var e=r.cause;for(const n of r.targetIds)t.Or.has(n)&&(await t.remoteSyncer.rejectListen(n,e),t.Or.delete(n),t.Ur.removeTarget(n))}(t)}catch(e){Br("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),e),await ku(t,e)}else if(r instanceof io?t.Ur.X(r):r instanceof oo?t.Ur.rt(r):t.Ur.et(r),!e.isEqual(Jr.min()))try{const r=await kh(t.localStore);0<=e.compareTo(r)&&await function(r,s){const t=r.Ur.ct(s);return t.targetChanges.forEach((t,e)=>{if(0<t.resumeToken.approximateByteSize()){const n=r.Or.get(e);n&&r.Or.set(e,n.withResumeToken(t.resumeToken,s))}}),t.targetMismatches.forEach(t=>{const e=r.Or.get(t);e&&(r.Or.set(t,e.withResumeToken(as.EMPTY_BYTE_STRING,e.snapshotVersion)),Au(r,t),t=new _a(e.target,t,1,e.sequenceNumber),Su(r,t))}),r.remoteSyncer.applyRemoteEvent(t)}(t,e)}catch(r){Br("RemoteStore","Failed to raise snapshot:",r),await ku(t,r)}}.bind(null,e)}),e.Mr.push(async t=>{t?(e.qr.sr(),Nu(e)?Du(e):e.Br.set("Unknown")):(await e.qr.stop(),xu(e))})),e.qr}function Vu(e){return e.Kr||(e.Kr=function(t,e,n){const r=t;return r.Pr(),new yu(e,r.Hi,r.credentials,r.R,n)}(e.datastore,e.asyncQueue,{Ii:async function(t){Vu(t).Ar()}.bind(null,e),Ri:async function(t,e){e&&Vu(t).pr&&await async function(t,e){if(Ki(n=e.code)&&n!==Fr.ABORTED){const n=t.$r.shift();Vu(t).sr(),await Ru(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await Lu(t)}var n}(t,e),Ou(t)&&Mu(t)}.bind(null,e),Ir:async function(t){const e=Vu(t);for(const n of t.$r)e.Er(n.mutations)}.bind(null,e),Tr:async function(t,e,n){const r=t.$r.shift(),s=Ia.from(r,e,n);await Ru(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Lu(t)}.bind(null,e)}),e.Mr.push(async t=>{t?(e.Kr.sr(),await Lu(e)):(await e.Kr.stop(),0<e.$r.length&&(Br("RemoteStore",`Stopping write stream with ${e.$r.length} pending writes`),e.$r=[]))})),e.Kr}class Uu{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new ua,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Uu(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Vr(Fr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qu(t,e){if(jr("AsyncQueue",`${e}: ${t}`),ma(t))return new Vr(Fr.UNAVAILABLE,`${e}: ${t}`);throw t}class Bu{constructor(n){this.comparator=n?(t,e)=>n(t,e)||ys.comparator(t.key,e.key):(t,e)=>ys.comparator(t.key,e.key),this.keyedMap=Ji,this.sortedSet=new Hi(this.comparator)}static emptySet(t){return new Bu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((t,e)=>(n(t),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Bu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(t,e){const n=new Bu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class ju{constructor(){this.jr=new Hi(ys.comparator)}track(t){var e=t.doc.key,n=this.jr.get(e);!n||0!==t.type&&3===n.type?this.jr=this.jr.insert(e,t):3===t.type&&1!==n.type?this.jr=this.jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.jr=this.jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.jr=this.jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.jr=this.jr.remove(e):1===t.type&&2===n.type?this.jr=this.jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.jr=this.jr.insert(e,{type:2,doc:t.doc}):Gr()}Qr(){const n=[];return this.jr.inorderTraversal((t,e)=>{n.push(e)}),n}}class $u{constructor(t,e,n,r,s,i,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,r){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new $u(t,e,Bu.emptySet(e),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ui(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Ku{constructor(){this.Wr=void 0,this.listeners=[]}}class Gu{constructor(){this.queries=new ch(t=>ci(t),ui),this.onlineState="Unknown",this.Gr=new Set}}async function Hu(t,e){const n=t,r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Ku),s)try{i.Wr=await n.onListen(r)}catch(t){const n=qu(t,`Initialization of query '${li(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.zr(n.onlineState),!i.Wr||e.Hr(i.Wr)&&Qu(n)}async function zu(t,e){const n=t,r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);0<=t&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Qu(t){t.Gr.forEach(t=>{t.next()})}class Wu{constructor(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}Hr(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new $u(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),e=!0):this.eo(t,this.onlineState)&&(this.no(t),e=!0),this.Xr=t,e}onError(t){this.Jr.error(t)}zr(t){this.onlineState=t;let e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e}eo(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)}Zr(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}no(t){t=$u.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)}}class Yu{constructor(t,e){this.payload=t,this.byteLength=e}io(){return"metadata"in this.payload}}class Xu{constructor(t){this.R=t}Un(t){return Eo(this.R,t)}qn(t){return t.metadata.exists?No(this.R,t.document,!1):Rs.newNoDocument(this.Un(t.metadata.name),this.Kn(t.metadata.readTime))}Kn(t){return wo(t)}}class Ju{constructor(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=Zu(t)}oo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ao(t){const e=new Map,n=new Xu(this.R);for(const s of t)if(s.metadata.queries){const t=n.Un(s.metadata.name);for(const n of s.metadata.queries){var r=(e.get(n)||eo()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=t;let i=eo(),o=Xi,a=Zi;for(const t of n){const n=e.Un(t.metadata.name);t.document&&(i=i.add(n)),o=o.insert(n,e.qn(t)),a=a.insert(n,e.Kn(t.metadata.readTime))}const h=s.Fn.newChangeBuffer({trackRemovals:!0}),u=await Oh(s,(r=r,ai(ti(rs.fromString(`__bundle__/docs/${r}`)))));return s.persistence.runTransaction("Apply bundle documents","readwrite",e=>Lh(e,h,o,Jr.min(),a).next(t=>(h.apply(e),t)).next(t=>s.Ue.removeMatchingKeysForTargetId(e,u.targetId).next(()=>s.Ue.addMatchingKeys(e,i,u.targetId)).next(()=>s.Mn.En(e,t)).next(()=>t)))}(this.localStore,new Xu(this.R),this.documents,this.ro.id),e=this.ao(this.documents);for(const t of this.queries)await async function(t,n,r=eo()){const s=await Oh(t,ai(Ma(n.bundledQuery))),i=t;return i.persistence.runTransaction("Save named query","readwrite",t=>{var e=wo(n.readTime);if(0<=s.snapshotVersion.compareTo(e))return i.Ke.saveNamedQuery(t,n);e=s.withResumeToken(as.EMPTY_BYTE_STRING,e);return i.kn=i.kn.insert(e.targetId,e),i.Ue.updateTargetData(t,e).next(()=>i.Ue.removeMatchingKeysForTargetId(t,s.targetId)).next(()=>i.Ue.addMatchingKeys(t,r,s.targetId)).next(()=>i.Ke.saveNamedQuery(t,n))})}(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new _h(Object.assign({},this.progress),t)}}function Zu(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class tc{constructor(t){this.key=t}}class ec{constructor(t){this.key=t}}class nc{constructor(t,e){this.query=t,this.co=e,this.uo=null,this.current=!1,this.ho=eo(),this.mutatedKeys=eo(),this.lo=fi(t),this.fo=new Bu(this.lo)}get wo(){return this.co}_o(t,e){const a=e?e.mo:new ju,h=(e||this).fo;let u=(e||this).mutatedKeys,c=h,l=!1;const d=ei(this.query)&&h.size===this.query.limit?h.last():null,f=ni(this.query)&&h.size===this.query.limit?h.first():null;if(t.inorderTraversal((t,e)=>{const n=h.get(t),r=di(this.query,e)?e:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(a.track({type:3,doc:r}),o=!0):this.yo(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.lo(r,d)||f&&this.lo(r,f)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(l=!0)),o&&(u=r?(c=c.add(r),i?u.add(t):u.delete(t)):(c=c.delete(t),u.delete(t)))}),ei(this.query)||ni(this.query))for(;c.size>this.query.limit;){const t=ei(this.query)?c.last():c.first();c=c.delete(t.key),u=u.delete(t.key),a.track({type:1,doc:t})}return{fo:c,mo:a,Nn:l,mutatedKeys:u}}yo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){var r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;const s=t.mo.Qr();s.sort((t,e)=>function(t,e){var n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gr()}};return n(t)-n(e)}(t.type,e.type)||this.lo(t.doc,e.doc)),this.po(n);var i=e?this.Eo():[],n=0===this.ho.size&&this.current?1:0,e=n!==this.uo;return this.uo=n,0!==s.length||e?{snapshot:new $u(this.query,t.fo,r,s,t.mutatedKeys,0==n,e,!1),To:i}:{To:i}}zr(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ju,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}}Io(t){return!this.co.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations}po(t){t&&(t.addedDocuments.forEach(t=>this.co=this.co.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.co=this.co.delete(t)),this.current=t.current)}Eo(){if(!this.current)return[];const e=this.ho;this.ho=eo(),this.fo.forEach(t=>{this.Io(t.key)&&(this.ho=this.ho.add(t.key))});const n=[];return e.forEach(t=>{this.ho.has(t)||n.push(new ec(t))}),this.ho.forEach(t=>{e.has(t)||n.push(new tc(t))}),n}Ao(t){this.co=t.Bn,this.ho=eo();t=this._o(t.documents);return this.applyChanges(t,!0)}Ro(){return $u.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.uo)}}class rc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class sc{constructor(t){this.key=t,this.Po=!1}}class ic{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.bo={},this.vo=new ch(t=>ci(t),ui),this.Vo=new Map,this.So=new Set,this.Do=new Hi(ys.comparator),this.Co=new Map,this.No=new qh,this.xo={},this.ko=new Map,this.$o=Ja.Yt(),this.onlineState="Unknown",this.Oo=void 0}get isPrimaryClient(){return!0===this.Oo}}async function oc(n,t,e,r){n.Fo=(t,s,e)=>async function(t,e,n){let r=e.view._o(s);r.Nn&&(r=await Ph(t.localStore,e.query,!1).then(({documents:t})=>e.view._o(t,r)));n=n&&n.targetChanges.get(e.targetId),n=e.view.applyChanges(r,t.isPrimaryClient,n);return mc(t,e.targetId,n.To),n.snapshot}(n,t,e);const s=await Ph(n.localStore,t,!0),i=new nc(t,s.Bn),o=i._o(s.documents),a=so.createSynthesizedTargetChangeForCurrentChange(e,r&&"Offline"!==n.onlineState),h=i.applyChanges(o,n.isPrimaryClient,a);mc(n,e,h.To);r=new rc(t,e,i);return n.vo.set(t,r),n.Vo.has(e)?n.Vo.get(e).push(t):n.Vo.set(e,[t]),h.snapshot}async function ac(t,e,n){const r=Ec(t);try{const t=await function(t,r){const s=t,i=Xr.now(),e=r.reduce((t,e)=>t.add(e.key),eo());let o;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>s.Mn.pn(n,e).next(t=>{o=t;const e=[];for(const n of r){const r=function(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=wi(r.transform,t||null);null!=s&&(null==n&&(n=ks.empty()),n.set(r.field,s))}return n||null}(n,o.get(n.key));null!=r&&e.push(new Fi(n.key,r,function r(t){const s=[];return ts(t.fields,(t,e)=>{const n=new is([t]);if(Cs(e)){const t=r(e.mapValue).fields;if(0===t.length)s.push(n);else for(const e of t)s.push(n.child(e))}else s.push(n)}),new os(s)}(r.value.mapValue),Ci.exists(!0)))}return s._n.addMutationBatch(n,i,e,r)})).then(t=>(t.applyToLocalDocumentSet(o),{batchId:t.batchId,changes:o}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.xo[t.currentUser.toKey()];r=r||new Hi(Qr),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,t.batchId,n),await yc(r,t.changes),await Lu(r.remoteStore)}catch(t){const e=qu(t,"Failed to persist write");n.reject(e)}}async function hc(t,e){const r=t;try{const t=await Rh(r.localStore,e);e.targetChanges.forEach((t,e)=>{const n=r.Co.get(e);n&&(Hr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?n.Po=!0:0<t.modifiedDocuments.size?Hr(n.Po):0<t.removedDocuments.size&&(Hr(n.Po),n.Po=!1))}),await yc(r,t,e)}catch(t){await rh(t)}}function uc(n,r,t){const e=n;if(e.isPrimaryClient&&0===t||!e.isPrimaryClient&&1===t){const n=[];e.vo.forEach((t,e)=>{e=e.view.zr(r);e.snapshot&&n.push(e.snapshot)}),function(t,n){const e=t;e.onlineState=n;let r=!1;e.queries.forEach((t,e)=>{for(const t of e.listeners)t.zr(n)&&(r=!0)}),r&&Qu(e)}(e.eventManager,r),n.length&&e.bo._r(n),e.onlineState=r,e.isPrimaryClient&&e.sharedClientState.setOnlineState(r)}}async function cc(t,e){const n=t,r=e.batch.batchId;try{const t=await function(t,r){const s=t;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const e=r.batch.keys(),n=s.Fn.newChangeBuffer({trackRemovals:!0});return function(t,e,r,s){const i=r.batch,n=i.keys();let o=ca.resolve();return n.forEach(n=>{o=o.next(()=>s.getEntry(e,n)).next(t=>{var e=r.docVersions.get(n);Hr(null!==e),t.version.compareTo(e)<0&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&s.addEntry(t,r.commitVersion))})}),o.next(()=>t._n.removeMutationBatch(e,i))}(s,t,r,n).next(()=>n.apply(t)).next(()=>s._n.performConsistencyCheck(t)).next(()=>s.Mn.pn(t,e))})}(n.localStore,e);dc(n,r,null),lc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await yc(n,t)}catch(t){await rh(t)}}function lc(t,e){(t.ko.get(e)||[]).forEach(t=>{t.resolve()}),t.ko.delete(e)}function dc(t,e,n){const r=t;let s=r.xo[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.xo[r.currentUser.toKey()]=s}}function fc(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Vo.get(t))e.vo.delete(r),n&&e.bo.Mo(r,n);e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(t=>{e.No.containsKey(t)||gc(e,t)})}function gc(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(_u(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),pc(t))}function mc(t,e,n){for(const r of n)r instanceof tc?(t.No.addReference(r.key,e),function(t,e){const n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Br("SyncEngine","New document in limbo: "+n),t.So.add(r),pc(t))}(t,r)):r instanceof ec?(Br("SyncEngine","Document no longer in limbo: "+r.key),t.No.removeReference(r.key,e),t.No.containsKey(r.key)||gc(t,r.key)):Gr()}function pc(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ys(rs.fromString(e)),e=t.$o.next();t.Co.set(e,new sc(n)),t.Do=t.Do.insert(n,e),Iu(t.remoteStore,new _a(ai(ti(n.path)),e,2,Pr.o))}}async function yc(t,n,r){const s=t,i=[],o=[],a=[];s.vo.isEmpty()||(s.vo.forEach((t,e)=>{a.push(s.Fo(e,n,r).then(t=>{t&&(s.isPrimaryClient&&s.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),i.push(t),t=Ah.vn(e.targetId,t),o.push(t))}))}),await Promise.all(a),s.bo._r(i),await async function(t,e){const r=t;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ca.forEach(e,e=>ca.forEach(e.Pn,t=>r.persistence.referenceDelegate.addReference(n,e.targetId,t)).next(()=>ca.forEach(e.bn,t=>r.persistence.referenceDelegate.removeReference(n,e.targetId,t)))))}catch(t){if(!ma(t))throw t;Br("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=r.kn.get(e),n=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(n);r.kn=r.kn.insert(e,s)}}}(s.localStore,o))}async function wc(r,t){const s=r;if(Tc(s),Ec(s),!0===t&&!0!==s.Oo){const r=s.sharedClientState.getAllActiveQueryTargets(),t=await vc(s,r.toArray());s.Oo=!0,await Pu(s.remoteStore,!0);for(const r of t)Iu(s.remoteStore,r)}else if(!1===t&&!1!==s.Oo){const r=[];let n=Promise.resolve();s.Vo.forEach((t,e)=>{s.sharedClientState.isLocalQueryTarget(e)?r.push(e):n=n.then(()=>(fc(s,e),Mh(s.localStore,e,!0))),_u(s.remoteStore,e)}),await n,await vc(s,r),function(){const n=s;n.Co.forEach((t,e)=>{_u(n.remoteStore,e)}),n.No.ts(),n.Co=new Map,n.Do=new Hi(ys.comparator)}(),s.Oo=!1,await Pu(s.remoteStore,!1)}}async function vc(e,n){const r=e,s=[],i=[];for(const e of n){let t;const u=r.Vo.get(e);if(u&&0!==u.length){t=await Oh(r.localStore,ai(u[0]));for(const e of u){const n=r.vo.get(e),u=(o=r,a=n,h=void 0,o=await Ph((h=o).localStore,a.query,!0),o=a.view.Ao(o),h.isPrimaryClient&&mc(h,a.targetId,o.To),await o);u.snapshot&&i.push(u.snapshot)}}else{const u=await Fh(r.localStore,e);t=await Oh(r.localStore,u),await oc(r,bc(u),e,!1)}s.push(t)}var o,a,h;return r.bo._r(i),s}function bc(t){return Zs(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Tc(t){const e=t;return e.remoteStore.remoteSyncer.applyRemoteEvent=hc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){const n=t,r=n.Co.get(e);if(r&&r.Po)return eo().add(r.key);{let t=eo();const r=n.Vo.get(e);if(!r)return t;for(const e of r){const r=n.vo.get(e);t=t.unionWith(r.view.wo)}return t}}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=async function(t,e,n){const r=t;r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Co.get(e),i=s&&s.key;if(i){let t=new Hi(ys.comparator);t=t.insert(i,Rs.newNoDocument(i,Jr.min()));const n=eo().add(i),s=new ro(Jr.min(),new Map,new Wi(Qr),t,n);await hc(r,s),r.Do=r.Do.remove(i),r.Co.delete(e),pc(r)}else await Mh(r.localStore,e,!1).then(()=>fc(r,e,n)).catch(rh)}.bind(null,e),e.bo._r=function(t,e){const n=t;let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Hr(t)&&(r=!0);s.Wr=t}}r&&Qu(n)}.bind(null,e.eventManager),e.bo.Mo=function(t,e,n){const r=t,s=r.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);r.queries.delete(e)}.bind(null,e.eventManager),e}function Ec(t){const e=t;return e.remoteStore.remoteSyncer.applySuccessfulWrite=cc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=async function(t,e,n){const r=t;try{const t=await function(t,r){const s=t;return s.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return s._n.lookupMutationBatch(e,r).next(t=>(Hr(null!==t),n=t.keys(),s._n.removeMutationBatch(e,t))).next(()=>s._n.performConsistencyCheck(e)).next(()=>s.Mn.pn(e,n))})}(r.localStore,e);dc(r,e,n),lc(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await yc(r,t)}catch(n){await rh(n)}}.bind(null,e),e}class Ic{constructor(){this.synchronizeTabs=!1}async initialize(t){this.R=fu(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.Uo(t),await this.persistence.start(),this.gcScheduler=this.qo(t),this.localStore=this.Ko(t)}qo(t){return null}Ko(t){return Ch(this.persistence,new Dh,t.initialUser,this.R)}Uo(t){return new Hh(Qh.Ps,this.R)}Bo(t){return new iu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class _c extends Ic{constructor(t,e,n){super(),this.jo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=t;return e.persistence.runTransaction("Synchronize last document change read time","readonly",e=>function(){const t=mh(e);let r=Jr.min();return t.Ot({index:Xo.readTimeIndex,reverse:!0},(t,e,n)=>{e.readTime&&(r=Ca(e.readTime)),n.done()}).next(()=>r)}()).then(t=>{e.On=t})}(this.localStore),await this.jo.initialize(this,t),await Ec(this.jo.syncEngine),await Lu(this.jo.remoteStore),await this.persistence.He(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ko(t){return Ch(this.persistence,new Dh,t.initialUser,this.R)}qo(t){var e=this.persistence.referenceDelegate.garbageCollector;return new oh(e,t.asyncQueue)}Uo(t){var e=Ih(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ka.withCacheSize(this.cacheSizeBytes):Ka.DEFAULT;return new bh(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,lu(),du(),this.R,this.sharedClientState,!!this.forceOwnership)}Bo(t){return new iu}}class Sc extends _c{constructor(t,e){super(t,e,!1),this.jo=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);t=this.jo.syncEngine;this.sharedClientState instanceof su&&(this.sharedClientState.syncEngine={ci:async function(t,e,n,r){var s=t;null!==(t=await function(t,n){const r=t,s=r._n;return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>s.Qt(e,n).next(t=>t?r.Mn.pn(e,t):ca.resolve(null)))}(s.localStore,e))?("pending"===n?await Lu(s.remoteStore):"acknowledged"===n||"rejected"===n?(dc(s,e,r||null),lc(s,e),s.localStore._n.Gt(e)):Gr(),await yc(s,t)):Br("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,t),ui:async function(t,e,n,r){const s=t;if(s.Oo)Br("SyncEngine","Ignoring unexpected query state notification.");else if(s.Vo.has(e))switch(n){case"current":case"not-current":{const t=await Vh(s.localStore),r=ro.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await yc(s,t,r);break}case"rejected":await Mh(s.localStore,e,!0),fc(s,e,r);break;default:Gr()}}.bind(null,t),hi:async function(t,e,n){const r=Tc(t);if(r.Oo){for(const t of e)if(r.Vo.has(t))Br("SyncEngine","Adding an already active target "+t);else{const e=await Fh(r.localStore,t),n=await Oh(r.localStore,e);await oc(r,bc(e),n.targetId,!1),Iu(r.remoteStore,n)}for(const t of n)r.Vo.has(t)&&await Mh(r.localStore,t,!1).then(()=>{_u(r.remoteStore,t),fc(r,t)}).catch(rh)}}.bind(null,t),fn:function(t){return t.localStore.persistence.fn()}.bind(null,t),ai:async function(t){const e=t;return Vh(e.localStore).then(t=>yc(e,t))}.bind(null,t)},await this.sharedClientState.start()),await this.persistence.He(async t=>{await wc(this.jo.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())})}Bo(t){var e=lu();if(!su.gt(e))throw new Vr(Fr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ih(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new su(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class Ac{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>uc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(t,e){const n=t;if(!n.currentUser.isEqual(e)){Br("SyncEngine","User change. New user:",e.toKey());const r=await xh(n.localStore,e);n.currentUser=e,(t=n).ko.forEach(t=>{t.forEach(t=>{t.reject(new Vr(Fr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.ko.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await yc(n,r.Ln)}}.bind(null,this.syncEngine),await Pu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Gu}createDatastore(t){var e,n=fu(t.databaseInfo.databaseId),e=(e=t.databaseInfo,new cu(e));return t=t.credentials,e=e,n=n,new wu(t,e,n)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>uc(this.syncEngine,t,0),t=new(au.gt()?au:ou),new bu(e,n,r,s,t);var e,n,r,s}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new ic(t,e,n,r,s,i);return o&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=t;Br("RemoteStore","RemoteStore shutting down."),e.Fr.add(5),await Eu(e),e.Lr.shutdown(),e.Br.set("Unknown")}(this.remoteStore)}}function Dc(e,n=10240){let r=0;return{async read(){if(r<e.byteLength){var t={value:e.slice(r,r+n),done:!1};return r+=n,t}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Nc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Qo(this.observer.next,t)}error(t){this.observer.error?this.Qo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Wo(){this.muted=!0}Qo(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Cc{constructor(t,e){this.Go=t,this.R=e,this.metadata=new ua,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(t=>{t&&t.io()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))},t=>this.metadata.reject(t))}close(){return this.Go.cancel()}async getMetadata(){return this.metadata.promise}async Lo(){return await this.getMetadata(),this.Ho()}async Ho(){var t=await this.Jo();if(null===t)return null;var e=this.zo.decode(t),n=Number(e);isNaN(n)&&this.Yo(`length string (${e}) is not valid number`);e=await this.Xo(n);return new Yu(JSON.parse(e),t.length+n)}Zo(){return this.buffer.findIndex(t=>t==="{".charCodeAt(0))}async Jo(){for(;this.Zo()<0&&!await this.ta(););if(0===this.buffer.length)return null;var t=this.Zo();t<0&&this.Yo("Reached the end of bundle when a length string is expected.");var e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Xo(t){for(;this.buffer.length<t;)await this.ta()&&this.Yo("Reached the end of bundle when more is expected.");var e=this.zo.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Yo(t){throw this.Go.cancel(),new Error(`Invalid bundle format: ${t}`)}async ta(){var t=await this.Go.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class xc{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Vr(Fr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const r=t,n=So(r.R)+"/documents",s={documents:e.map(t=>To(r.R,t))},i=await r.Oi("BatchGetDocuments",n,s),o=new Map;i.forEach(t=>{const e=(n=r.R,"found"in(t=t)?function(t,e){Hr(!!e.found),e.found.name,e.found.updateTime;var n=Eo(t,e.found.name),t=wo(e.found.updateTime),e=new ks({mapValue:{fields:e.found.fields}});return Rs.newFoundDocument(n,t,e)}(n,t):"missing"in t?function(t,e){Hr(!!e.missing),Hr(!!e.readTime);t=Eo(t,e.missing),e=wo(e.readTime);return Rs.newNoDocument(t,e)}(n,t):Gr());var n;o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{t=o.get(t.toString());Hr(!!t),a.push(t)}),a}(this.datastore,t);return e.forEach(t=>this.recordVersion(t)),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Bi(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,e)=>{e=ys.fromPath(e);this.mutations.push(new ji(e,this.precondition(e)))}),await async function(t,e){const n=t,r=So(n.R)+"/documents",s={writes:e.map(t=>Co(n.R,t))};await n.Ni("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Gr();e=Jr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Vr(Fr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Ci.updateTime(e):Ci.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return Ci.exists(!0);if(e.isEqual(Jr.min()))throw new Vr(Fr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ci.updateTime(e)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class kc{constructor(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ea=5,this.Zi=new gu(this.asyncQueue,"transaction_retry")}run(){--this.ea,this.na()}na(){this.Zi.Qi(async()=>{const e=new xc(this.datastore),t=this.sa(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(t=>{this.ia(t)}))}).catch(t=>{this.ia(t)})})}sa(t){try{var e=this.updateFunction(t);return!gs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ia(t){0<this.ea&&this.ra(t)?(--this.ea,this.asyncQueue.enqueueAndForget(()=>(this.na(),Promise.resolve()))):this.deferred.reject(t)}ra(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Ki(t)}}class Rc{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Wh.UNAUTHENTICATED,this.clientId=zr.u(),this.credentialListener=()=>Promise.resolve(),this.credentials.setChangeListener(e,async t=>{Br("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Vr(Fr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new ua;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.removeChangeListener(),n.resolve()}catch(t){var e=qu(t,"Failed to shutdown persistence");n.reject(e)}}),n.promise}}async function Lc(t,e){t.asyncQueue.verifyOperationInProgress(),Br("FirestoreClient","Initializing OfflineComponentProvider");var n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async t=>{r.isEqual(t)||(await xh(e.localStore,t),r=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function Oc(t,e){t.asyncQueue.verifyOperationInProgress();var n=await Mc(t);Br("FirestoreClient","Initializing OnlineComponentProvider");var r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(t=>async function(t,e){const n=t;n.asyncQueue.verifyOperationInProgress(),Br("RemoteStore","RemoteStore received new credentials");t=Cu(n);n.Fr.add(3),await Eu(n),t&&n.Br.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Fr.delete(3),await Tu(n)}(e.remoteStore,t)),t.onlineComponents=e}async function Mc(t){return t.offlineComponents||(Br("FirestoreClient","Using default OfflineComponentProvider"),await Lc(t,new Ic)),t.offlineComponents}async function Pc(t){return t.onlineComponents||(Br("FirestoreClient","Using default OnlineComponentProvider"),await Oc(t,new Ac)),t.onlineComponents}function Fc(t){return Mc(t).then(t=>t.persistence)}function Vc(t){return Mc(t).then(t=>t.localStore)}function Uc(t){return Pc(t).then(t=>t.remoteStore)}function qc(t){return Pc(t).then(t=>t.syncEngine)}async function Bc(t){const e=await Pc(t),n=e.eventManager;return n.onListen=async function(t,e){const n=Tc(t);let r,s;const i=n.vo.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Ro();else{const t=await Oh(n.localStore,ai(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await oc(n,e,r,"current"===i),n.isPrimaryClient&&Iu(n.remoteStore,t)}return s}.bind(null,e.syncEngine),n.onUnlisten=async function(t,e){const n=t,r=n.vo.get(e),s=n.Vo.get(r.targetId);if(1<s.length)return n.Vo.set(r.targetId,s.filter(t=>!ui(t,e))),void n.vo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Mh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),_u(n.remoteStore,r.targetId),fc(n,r.targetId)}).catch(rh)):(fc(n,r.targetId),await Mh(n.localStore,r.targetId,!0))}.bind(null,e.syncEngine),n}function jc(t,e,n={}){const r=new ua;return t.asyncQueue.enqueueAndForget(async()=>function(n,r,s,i,o){const t=new Nc({next:t=>{r.enqueueAndForget(()=>zu(n,a));var e=t.docs.has(s);!e&&t.fromCache?o.reject(new Vr(Fr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&i&&"server"===i.source?o.reject(new Vr(Fr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(t)},error:t=>o.reject(t)}),a=new Wu(ti(s.path),t,{includeMetadataChanges:!0,so:!0});return Hu(n,a)}(await Bc(t),t.asyncQueue,e,n,r)),r.promise}function $c(t,e,n={}){const r=new ua;return t.asyncQueue.enqueueAndForget(async()=>function(e,n,t,r,s){const i=new Nc({next:t=>{n.enqueueAndForget(()=>zu(e,o)),t.fromCache&&"server"===r.source?s.reject(new Vr(Fr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(t)},error:t=>s.reject(t)}),o=new Wu(t,i,{includeMetadataChanges:!0,so:!0});return Hu(e,o)}(await Bc(t),t.asyncQueue,e,n,r)),r.promise}function Kc(t,e,n,r){const s=function(t,e){t="string"==typeof t?(new TextEncoder).encode(t):t;return t=function(t){if(t instanceof Uint8Array)return Dc(t,void 0);if(t instanceof ArrayBuffer)return Dc(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(t),e=e,new Cc(t,e)}(n,fu(e));t.asyncQueue.enqueueAndForget(async()=>{!function(t,e,n){const r=t;!async function(e,n,r){try{var s=await n.getMetadata();if(await function(t,e){const n=t,r=wo(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",t=>n.Ke.getBundleMetadata(t,e.id)).then(t=>!!t&&0<=t.createTime.compareTo(r))}(e.localStore,s))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes});r._updateProgress(Zu(s));const o=new Ju(s,e.localStore,n.R);let t=await n.Lo();for(;t;){const e=await o.oo(t);e&&r._updateProgress(e),t=await n.Lo()}var i=await o.complete();await yc(e,i.wn,void 0),await function(t,e){const n=t;return n.persistence.runTransaction("Save bundle","readwrite",t=>n.Ke.saveBundleMetadata(t,e))}(e.localStore,s),r._completeWith(i.progress)}catch(e){$r("SyncEngine",`Loading bundle failed with ${e}`),r._failWith(e)}}(r,e,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await qc(t),s,r)})}class Gc{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Hc{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Hc&&t.projectId===this.projectId&&t.database===this.database}}const zc=new Map;class Qc{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class Wc{constructor(){this.changeListener=null}getToken(){return Promise.resolve(null)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(Wh.UNAUTHENTICATED))}removeChangeListener(){this.changeListener=null}}class Yc{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}removeChangeListener(){this.changeListener=null}}class Xc{constructor(e){this.currentUser=Wh.UNAUTHENTICATED,this.oa=new ua,this.aa=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.ca=()=>{this.aa++,this.currentUser=this.ua(),this.oa.resolve(),this.changeListener&&this.asyncQueue.enqueueRetryable(()=>this.changeListener(this.currentUser))};const n=t=>{Br("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.ca)};e.onInit(t=>n(t)),setTimeout(()=>{var t;this.auth||((t=e.getImmediate({optional:!0}))?n(t):(Br("FirebaseCredentialsProvider","Auth not yet detected"),this.oa.resolve()))},0)}getToken(){const e=this.aa,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.aa!==e?(Br("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Hr("string"==typeof t.accessToken),new Qc(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}setChangeListener(t,e){this.asyncQueue=t,this.asyncQueue.enqueueRetryable(async()=>{await this.oa.promise,await e(this.currentUser),this.changeListener=e})}removeChangeListener(){this.auth&&this.auth.removeAuthTokenListener(this.ca),this.changeListener=()=>Promise.resolve()}ua(){var t=this.auth&&this.auth.getUid();return Hr(null===t||"string"==typeof t),new Wh(t)}}class Jc{constructor(t,e,n){this.ha=t,this.la=e,this.fa=n,this.type="FirstParty",this.user=Wh.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.la},e=this.ha.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fa&&(t["X-Goog-Iam-Authorization-Token"]=this.fa),t}}class Zc{constructor(t,e,n){this.ha=t,this.la=e,this.fa=n}getToken(){return Promise.resolve(new Jc(this.ha,this.la,this.fa))}setChangeListener(t,e){t.enqueueRetryable(()=>e(Wh.FIRST_PARTY))}removeChangeListener(){}invalidateToken(){}}function tl(t,e,n){if(!n)throw new Vr(Fr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function el(t,e,n,r){if(!0===e&&!0===r)throw new Vr(Fr.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function nl(t){if(!ys.isDocumentKey(t))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function rl(t){if(ys.isDocumentKey(t))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function sl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Gr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?`a custom ${t} object`:"an object"}function il(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Vr(Fr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=sl(t);throw new Vr(Fr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}function ol(t,e){if(e<=0)throw new Vr(Fr.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class al{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(Fr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Vr(Fr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,el("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class hl{constructor(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new al({}),this._settingsFrozen=!1,t instanceof Hc?(this._databaseId=t,this._credentials=new Wc):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Vr(Fr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hc(t.options.projectId)}(t),this._credentials=new Xc(e))}get app(){if(!this._app)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new al(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Wc;switch(t.type){case"gapi":var e=t.client;return Hr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Zc(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Vr(Fr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=zc.get(t);e&&(Br("ComponentProvider","Removing Datastore"),zc.delete(t),e.terminate())}(this),Promise.resolve()}}function ul(n,t,r,s={}){const i=(n=il(n,hl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==t&&$r("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${t}:${r}`,ssl:!1})),s.mockUserToken){let t,e;if("string"==typeof s.mockUserToken)t=s.mockUserToken,e=Wh.MOCK_USER;else{t=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=o({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(t)),""].join(".")}(s.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new Vr(Fr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");e=new Wh(i)}n._credentials=new Yc(new Qc(t,e))}}class cl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new cl(this.firestore,t,this._key)}}class ll{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ll(this.firestore,t,this._query)}}class dl extends ll{constructor(t,e,n){super(t,e,ti(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new cl(this.firestore,null,new ys(t))}withConverter(t){return new dl(this.firestore,t,this._path)}}function fl(t,e,...n){if(t=y(t),tl("collection","path",e),t instanceof hl){var r=rs.fromString(e,...n);return rl(r),new dl(t,null,r)}if(!(t instanceof cl||t instanceof dl))throw new Vr(Fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");e=rs.fromString(t.path,...n).child(rs.fromString(e));return rl(e),new dl(t.firestore,null,e)}function gl(t,e,...n){if(t=y(t),tl("doc","path",e=1===arguments.length?zr.u():e),t instanceof hl){var r=rs.fromString(e,...n);return nl(r),new cl(t,null,new ys(r))}if(!(t instanceof cl||t instanceof dl))throw new Vr(Fr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=t._path.child(rs.fromString(e,...n));return nl(n),new cl(t.firestore,t instanceof dl?t.converter:null,new ys(n))}function ml(t,e){return t=y(t),e=y(e),(t instanceof cl||t instanceof dl)&&(e instanceof cl||e instanceof dl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function pl(t,e){return t=y(t),e=y(e),t instanceof ll&&e instanceof ll&&t.firestore===e.firestore&&ui(t._query,e._query)&&t.converter===e.converter}class yl{constructor(){this.da=Promise.resolve(),this.wa=[],this._a=!1,this.ma=[],this.ga=null,this.ya=!1,this.pa=!1,this.Ea=[],this.Zi=new gu(this,"async_queue_retry"),this.Ta=()=>{var t=du();t&&Br("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Zi.Gi()};const t=du();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ta)}get isShuttingDown(){return this._a}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ia(),this.Aa(t)}enterRestrictedMode(t){if(!this._a){this._a=!0,this.pa=t||!1;const e=du();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ta)}}enqueue(t){if(this.Ia(),this._a)return new Promise(()=>{});const e=new ua;return this.Aa(()=>this._a&&this.pa?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.wa.push(t),this.Ra()))}async Ra(){if(0!==this.wa.length){try{await this.wa[0](),this.wa.shift(),this.Zi.reset()}catch(t){if(!ma(t))throw t;Br("AsyncQueue","Operation failed with retryable error: "+t)}0<this.wa.length&&this.Zi.Qi(()=>this.Ra())}}Aa(t){var e=this.da.then(()=>(this.ya=!0,t().catch(t=>{throw this.ga=t,this.ya=!1,jr("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.ya=!1,t))));return this.da=e}enqueueAfterDelay(t,e,n){this.Ia(),-1<this.Ea.indexOf(t)&&(e=0);n=Uu.createAndSchedule(this,t,e,n,t=>this.Pa(t));return this.ma.push(n),n}Ia(){this.ga&&Gr()}verifyOperationInProgress(){}async ba(){for(var t;await(t=this.da),t!==this.da;);}va(t){for(const e of this.ma)if(e.timerId===t)return!0;return!1}Va(e){return this.ba().then(()=>{this.ma.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const t of this.ma)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ba()})}Sa(t){this.Ea.push(t)}Pa(t){t=this.ma.indexOf(t);this.ma.splice(t,1)}}function wl(t){return function(t){if("object"==typeof t&&null!==t){var e=t;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return 1}}(t)}class vl{constructor(){this._progressObserver={},this._taskCompletionResolver=new ua,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}var bl,Tl;class El extends hl{constructor(t,e){super(t,e),this.type="firestore",this._queue=new yl,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||_l(this),this._firestoreClient.terminate()}}function Il(t){return t._firestoreClient||_l(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function _l(t){var e,n,r,s=t._freezeSettings(),s=(e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,s=s,new Gc(e,n,r,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));t._firestoreClient=new Rc(t._credentials,t._queue,s)}function Sl(t,n,r){const s=new ua;return t.asyncQueue.enqueue(async()=>{try{await Lc(t,r),await Oc(t,n),s.resolve()}catch(t){if(!("FirebaseError"===(e=t).name?e.code===Fr.FAILED_PRECONDITION||e.code===Fr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}var e}).then(()=>s.promise)}function Al(t){return function(t){const e=new ua;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e){const n=t;Cu(n.remoteStore)||Br("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(){const e=n.localStore;return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e._n.getHighestUnacknowledgedBatchId(t))}();if(-1===t)return void e.resolve();const r=n.ko.get(t)||[];r.push(e),n.ko.set(t,r)}catch(t){const n=qu(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await qc(t),e)),e.promise}(Il(t=il(t,El)))}function Dl(t){return(n=Il(t=il(t,El))).asyncQueue.enqueue(async()=>{const t=await Fc(n),e=await Uc(n);return t.setNetworkEnabled(!0),function(){const t=e;return t.Fr.delete(0),Tu(t)}()});var n}function Nl(t){return(n=Il(t=il(t,El))).asyncQueue.enqueue(async()=>{const t=await Fc(n),e=await Uc(n);return t.setNetworkEnabled(!1),async function(){const t=e;t.Fr.add(0),await Eu(t),t.Br.set("Offline")}()});var n}function Cl(e,t){return n=Il(e=il(e,El)),r=t,n.asyncQueue.enqueue(async()=>function(t,e){const n=t;return n.persistence.runTransaction("Get named query","readonly",t=>n.Ke.getNamedQuery(t,e))}(await Vc(n),r)).then(t=>t?new ll(e,null,t.query):null);var n,r}function xl(t){if(t._initialized||t._terminated)throw new Vr(Fr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class kl{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new is(e)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Rl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Rl(as.fromBase64String(t))}catch(t){throw new Vr(Fr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Rl(as.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Ll{constructor(t){this._methodName=t}}class Ol{constructor(t,e){if(!isFinite(t)||t<-90||90<t)throw new Vr(Fr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Vr(Fr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Qr(this._lat,t._lat)||Qr(this._long,t._long)}}const Ml=/^__.*__$/;class Pl{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Fi(t,this.data,this.fieldMask,e,this.fieldTransforms):new Pi(t,this.data,e,this.fieldTransforms)}}class Fl{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Fi(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Vl(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Gr()}}class Ul{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Da(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ca(){return this.settings.Ca}Na(t){return new Ul(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}xa(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Na({path:n,ka:!1});return r.$a(t),r}Oa(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Na({path:n,ka:!1});return r.Da(),r}Fa(t){return this.Na({path:void 0,ka:!0})}Ma(t){return id(t,this.settings.methodName,this.settings.La||!1,this.path,this.settings.Ba)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Da(){if(this.path)for(let t=0;t<this.path.length;t++)this.$a(this.path.get(t))}$a(t){if(0===t.length)throw this.Ma("Document fields must not be empty");if(Vl(this.Ca)&&Ml.test(t))throw this.Ma('Document fields cannot begin and end with "__"')}}class ql{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||fu(t)}Ua(t,e,n,r=!1){return new Ul({Ca:t,methodName:e,Ba:n,path:is.emptyPath(),ka:!1,La:r},this.databaseId,this.R,this.ignoreUndefinedProperties)}}function Bl(t){var e=t._freezeSettings(),n=fu(t._databaseId);return new ql(t._databaseId,!!e.ignoreUndefinedProperties,n)}function jl(t,e,n,r,s,i={}){const o=t.Ua(i.merge||i.mergeFields?2:0,e,n,s);ed("Data must be an object, but it was:",o,r);r=Zl(r,o);let a,h;if(i.merge)a=new os(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const u of i.mergeFields){const s=nd(e,u,n);if(!o.contains(s))throw new Vr(Fr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);od(t,s)||t.push(s)}a=new os(t),h=o.fieldTransforms.filter(t=>a.covers(t.field))}else a=null,h=o.fieldTransforms;return new Pl(new ks(r),a,h)}class $l extends Ll{_toFieldTransform(t){if(2!==t.Ca)throw 1===t.Ca?t.Ma(`${this._methodName}() can only appear at the top level of your update data`):t.Ma(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof $l}}function Kl(t,e,n){return new Ul({Ca:3,Ba:e.settings.Ba,methodName:t._methodName,ka:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}class Gl extends Ll{_toFieldTransform(t){return new Di(t.path,new vi)}isEqual(t){return t instanceof Gl}}class Hl extends Ll{constructor(t,e){super(t),this.qa=e}_toFieldTransform(t){const e=Kl(this,t,!0),n=this.qa.map(t=>Jl(t,e)),r=new bi(n);return new Di(t.path,r)}isEqual(t){return this===t}}class zl extends Ll{constructor(t,e){super(t),this.qa=e}_toFieldTransform(t){const e=Kl(this,t,!0),n=this.qa.map(t=>Jl(t,e)),r=new Ei(n);return new Di(t.path,r)}isEqual(t){return this===t}}class Ql extends Ll{constructor(t,e){super(t),this.Ka=e}_toFieldTransform(t){var e=new _i(t.R,pi(t.R,this.Ka));return new Di(t.path,e)}isEqual(t){return this===t}}function Wl(t,s,i,e){const o=t.Ua(1,s,i);ed("Data must be an object, but it was:",o,e);const a=[],h=ks.empty();ts(e,(t,e)=>{var n=sd(s,t,i);e=y(e);t=o.Oa(n);if(e instanceof $l)a.push(n);else{const r=Jl(e,t);null!=r&&(a.push(n),h.set(n,r))}});e=new os(a);return new Fl(h,e,o.fieldTransforms)}function Yl(e,n,t,r,s,i){const o=e.Ua(1,n,t),a=[nd(n,r,t)],h=[s];if(i.length%2!=0)throw new Vr(Fr.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(nd(n,i[t])),h.push(i[t+1]);const u=[],c=ks.empty();for(let t=a.length-1;0<=t;--t)if(!od(u,a[t])){const n=a[t];var l=y(l=h[t]);const r=o.Oa(n);if(l instanceof $l)u.push(n);else{const e=Jl(l,r);null!=e&&(u.push(n),c.set(n,e))}}s=new os(u);return new Fl(c,s,o.fieldTransforms)}function Xl(t,e,n,r=!1){return Jl(n,t.Ua(r?4:3,e))}function Jl(i,t){if(td(i=y(i)))return ed("Unsupported field value:",t,i),Zl(i,t);if(i instanceof Ll)return function(t,e){if(!Vl(e.Ca))throw e.Ma(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Ma(`${t._methodName}() is not currently supported inside arrays`);t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(i,t),null;if(void 0===i&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),i instanceof Array){if(t.settings.ka&&4!==t.Ca)throw t.Ma("Nested arrays are not supported");return function(e){const n=[];let r=0;for(const s of i){let t=Jl(s,e.Fa(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t)}return function(t,e){if(null===(t=y(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return pi(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Xr.fromDate(t);return{timestampValue:po(e.R,n)}}if(t instanceof Xr){n=new Xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:po(e.R,n)}}if(t instanceof Ol)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Rl)return{bytesValue:yo(e.R,t._byteString)};if(t instanceof cl){const r=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw e.Ma(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:vo(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Ma(`Unsupported field value: ${sl(t)}`)}(0,t)}function Zl(t,n){const r={};return es(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):ts(t,(t,e)=>{e=Jl(e,n.xa(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function td(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Xr||t instanceof Ol||t instanceof Rl||t instanceof cl||t instanceof Ll)}function ed(t,e,n){if(!td(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=sl(n);throw"an object"===n?e.Ma(t+" a custom object"):e.Ma(t+" "+n)}var r}function nd(t,e,n){if((e=y(e))instanceof kl)return e._internalPath;if("string"==typeof e)return sd(t,e);throw id("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const rd=new RegExp("[~\\*/\\[\\]]");function sd(e,n,r){if(0<=n.search(rd))throw id(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new kl(...n.split("."))._internalPath}catch(t){throw id(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function id(t,e,n,r,s){var i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${r}`),o&&(h+=` in document ${s}`),h+=")"),new Vr(Fr.INVALID_ARGUMENT,a+t+h)}function od(t,e){return t.some(t=>t.isEqual(e))}class ad{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new cl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var t=new hd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){t=this._document.data.field(ud("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}}}class hd extends ad{data(){return super.data()}}function ud(t,e){return"string"==typeof e?sd(t,e):(e instanceof kl?e:e._delegate)._internalPath}class cd{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ld extends ad{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){var e=new dd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){t=this._document.data.field(ud("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}}}class dd extends ld{data(t={}){return super.data(t)}}class fd{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new cd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,n){this._snapshot.docs.forEach(t=>{e.call(n,new dd(this._firestore,this._userDataWriter,t.key,t,new cd(this._snapshot.mutatedKeys.has(t.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){t=!!t.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Vr(Fr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){let e=0;return i._snapshot.docChanges.map(t=>({type:"added",doc:new dd(i._firestore,i._userDataWriter,t.doc.key,t.doc,new cd(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:e++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(t=>e||3!==t.type).map(t=>{var e=new dd(i._firestore,i._userDataWriter,t.doc.key,t.doc,new cd(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(s=s.add(t.doc),r=s.indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function gd(t,e){return t instanceof ld&&e instanceof ld?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof fd&&e instanceof fd&&t._firestore===e._firestore&&pl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function md(t){if(ni(t)&&0===t.explicitOrderBy.length)throw new Vr(Fr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pd{}function yd(t,...e){for(const n of e)t=n._apply(t);return t}class wd extends pd{constructor(t,e,n){super(),this.ja=t,this.Qa=e,this.Wa=n,this.type="where"}_apply(t){var e=Bl(t.firestore),e=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Vr(Fr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Sd(o,i);const e=[];for(const n of o)e.push(_d(r,t,n));a={arrayValue:{values:e}}}else a=_d(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Sd(o,i),a=Xl(n,e,o,"in"===i||"not-in"===i);i=Vs.create(s,i,a);return function(t,e){if(e.g()){const r=si(t);if(null!==r&&!r.isEqual(e.field))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${e.field.toString()}'`);var n=ri(t);null!==n&&Ad(0,e.field,n)}const r=function(t,e){for(const n of t.filters)if(0<=e.indexOf(n.op))return n.op;return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===e.op?new Vr(Fr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Vr(Fr.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}(t,i),i}(t._query,"where",e,t.firestore._databaseId,this.ja,this.Qa,this.Wa);return new ll(t.firestore,t.converter,(t=t._query,e=t.filters.concat([e]),new Js(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))}}class vd extends pd{constructor(t,e){super(),this.ja=t,this.Ga=e,this.type="orderBy"}_apply(t){var e=function(t,e,n){if(null!==t.startAt)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ws(e,n);return e=r,null!==ri(n=t)||null!==(t=si(n))&&Ad(0,t,e.field),r}(t._query,this.ja,this.Ga);return new ll(t.firestore,t.converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new Js(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}class bd extends pd{constructor(t,e,n){super(),this.type=t,this.za=e,this.Ha=n}_apply(t){return new ll(t.firestore,t.converter,hi(t._query,this.za,this.Ha))}}class Td extends pd{constructor(t,e,n){super(),this.type=t,this.Ja=e,this.Ya=n}_apply(t){var e=Id(t,this.type,this.Ja,this.Ya);return new ll(t.firestore,t.converter,(t=t._query,e=e,new Js(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class Ed extends pd{constructor(t,e,n){super(),this.type=t,this.Ja=e,this.Ya=n}_apply(t){var e=Id(t,this.type,this.Ja,this.Ya);return new ll(t.firestore,t.converter,(t=t._query,e=e,new Js(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function Id(t,e,n,r){if(n[0]=y(n[0]),n[0]instanceof ad)return function(t,e,n,r,s){if(!r)throw new Vr(Fr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of oi(t))if(n.field.isKeyField())i.push(_s(e,r.key));else{const t=r.data.field(n.field);if(ds(t))throw new Vr(Fr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new zs(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var s=Bl(t.firestore);return function(e,n,r,s,i,t){const o=e.explicitOrderBy;if(i.length>o.length)throw new Vr(Fr.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let t=0;t<i.length;t++){const h=i[t];if(o[t].field.isKeyField()){if("string"!=typeof h)throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!ii(e)&&-1!==h.indexOf("/"))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const r=e.path.child(rs.fromString(h));if(!ys.isDocumentKey(r))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const i=new ys(r);a.push(_s(n,i))}else{const e=Xl(r,s,h);a.push(e)}}return new zs(a,t)}(t._query,t.firestore._databaseId,s,e,n,r)}function _d(t,e,n){if("string"==typeof(n=y(n))){if(""===n)throw new Vr(Fr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ii(e)&&-1!==n.indexOf("/"))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);e=e.path.child(rs.fromString(n));if(!ys.isDocumentKey(e))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${e}' is not because it has an odd number of segments (${e.length}).`);return _s(t,new ys(e))}if(n instanceof cl)return _s(t,n._key);throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${sl(n)}.`)}function Sd(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(Fr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(10<t.length)throw new Vr(Fr.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Ad(t,e,n){if(!n.isEqual(e))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Dd{convertValue(t,e="none"){switch(ws(t)){case 0:return null;case 1:return t.booleanValue;case 2:return cs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ls(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Gr()}}convertObject(t,n){const r={};return ts(t.fields,(t,e)=>{r[t]=this.convertValue(e,n)}),r}convertGeoPoint(t){return new Ol(cs(t.latitude),cs(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return ds(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(fs(t));default:return null}}convertTimestamp(t){t=us(t);return new Xr(t.seconds,t.nanos)}convertDocumentKey(t,e){const n=rs.fromString(t);Hr(qo(n));const r=new Hc(n.get(1),n.get(3)),s=new ys(n.popFirst(5));return r.isEqual(e)||jr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function Nd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class Cd extends Dd{constructor(t){super(),this.firestore=t}convertBytes(t){return new Rl(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new cl(this.firestore,null,t)}}class xd{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Bl(t)}set(t,e,n){this._verifyNotCommitted();const r=kd(t,this._firestore),s=Nd(r.converter,e,n),i=jl(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,Ci.none())),this}update(t,e,n,...r){this._verifyNotCommitted();t=kd(t,this._firestore);let s;return s="string"==typeof(e=y(e))||e instanceof kl?Yl(this._dataReader,"WriteBatch.update",t._key,e,n,r):Wl(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(s.toMutation(t._key,Ci.exists(!0))),this}delete(t){this._verifyNotCommitted();t=kd(t,this._firestore);return this._mutations=this._mutations.concat(new Bi(t._key,Ci.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Vr(Fr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function kd(t,e){if((t=y(t)).firestore!==e)throw new Vr(Fr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class Rd extends Dd{constructor(t){super(),this.firestore=t}convertBytes(t){return new Rl(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new cl(this.firestore,null,t)}}function Ld(e){e=il(e,cl);const n=il(e.firestore,El),t=Il(n),r=new Rd(n);return function(t,e){const n=new ua;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){try{const r=await function(e){const n=t;return n.persistence.runTransaction("read document","readonly",t=>n.Mn.mn(t,e))}(e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Vr(Fr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){e=qu(t,`Failed to get document '${e} from cache`);n.reject(e)}}(await Vc(t),e,n)),n.promise}(t,e._key).then(t=>new ld(n,r,e._key,t,new cd(null!==t&&t.hasLocalMutations,!0),e.converter))}function Od(e){e=il(e,ll);const n=il(e.firestore,El),t=Il(n),r=new Rd(n);return function(t,e){const n=new ua;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){try{const r=await Ph(t,e,!0),s=new nc(e,r.Bn),i=s._o(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){e=qu(t,`Failed to execute query '${e} against cache`);n.reject(e)}}(await Vc(t),e,n)),n.promise}(t,e._query).then(t=>new fd(n,r,e,t))}function Md(t,e,n){t=il(t,cl);var r=il(t.firestore,El),e=Nd(t.converter,e,n);return Ud(r,[jl(Bl(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,Ci.none())])}function Pd(t,e,n,...r){t=il(t,cl);var s=il(t.firestore,El),i=Bl(s);let o;return o="string"==typeof(e=y(e))||e instanceof kl?Yl(i,"updateDoc",t._key,e,n,r):Wl(i,"updateDoc",t._key,e),Ud(s,[o.toMutation(t._key,Ci.exists(!0))])}function Fd(e,...n){var t;e=y(e);let r={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||wl(n[s])||(r=n[s],s++);var i={includeMetadataChanges:r.includeMetadataChanges};if(wl(n[s])){const e=n[s];n[s]=null===(t=e.next)||void 0===t?void 0:t.bind(e),n[s+1]=null===(t=e.error)||void 0===t?void 0:t.bind(e),n[s+2]=null===(t=e.complete)||void 0===t?void 0:t.bind(e)}let o,a,h;if(e instanceof cl)a=il(e.firestore,El),h=ti(e._key.path),o={next:t=>{n[s]&&n[s](qd(a,e,t))},error:n[s+1],complete:n[s+2]};else{const u=il(e,ll);a=il(u.firestore,El),h=u._query;const c=new Rd(a);o={next:t=>{n[s]&&n[s](new fd(a,c,u,t))},error:n[s+1],complete:n[s+2]},md(e._query)}return function(t,e,n,r){const s=new Nc(r),i=new Wu(e,s,n);return t.asyncQueue.enqueueAndForget(async()=>Hu(await Bc(t),i)),()=>{s.Wo(),t.asyncQueue.enqueueAndForget(async()=>zu(await Bc(t),i))}}(Il(a),h,i,o)}function Vd(t,e){return function(t,e){const n=new Nc(e);return t.asyncQueue.enqueueAndForget(async()=>function(t,e){t.Gr.add(e),e.next()}(await Bc(t),n)),()=>{n.Wo(),t.asyncQueue.enqueueAndForget(async()=>function(t,e){t.Gr.delete(e)}(await Bc(t),n))}}(Il(t=il(t,El)),wl(e)?e:{next:e})}function Ud(t,e){return function(t,e){const n=new ua;return t.asyncQueue.enqueueAndForget(async()=>ac(await qc(t),e,n)),n.promise}(Il(t),e)}function qd(t,e,n){var r=n.docs.get(e._key),s=new Rd(t);return new ld(t,s,e._key,r,new cd(n.hasPendingWrites,n.fromCache),e.converter)}class Bd extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Bl(t)}get(t){const n=kd(t,this._firestore),r=new Cd(this._firestore);return this._transaction.lookup([n._key]).then(t=>{if(!t||1!==t.length)return Gr();const e=t[0];if(e.isFoundDocument())return new ad(this._firestore,r,e.key,e,n.converter);if(e.isNoDocument())return new ad(this._firestore,r,n._key,null,n.converter);throw Gr()})}set(t,e,n){t=kd(t,this._firestore),e=Nd(t.converter,e,n),n=jl(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n);return this._transaction.set(t._key,n),this}update(t,e,n,...r){t=kd(t,this._firestore),e="string"==typeof(e=y(e))||e instanceof kl?Yl(this._dataReader,"Transaction.update",t._key,e,n,r):Wl(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this}delete(t){t=kd(t,this._firestore);return this._transaction.delete(t._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=kd(t,this._firestore),n=new Rd(this._firestore);return super.get(t).then(t=>new ld(this._firestore,n,e._key,t._document,new cd(!1,!1),e.converter))}}function jd(e,n){return function(e,n){const r=new ua;return e.asyncQueue.enqueueAndForget(async()=>{var t=await Pc(e).then(t=>t.datastore);new kc(e.asyncQueue,t,n,r).run()}),r.promise}(Il(e),t=>n(new Bd(e,t)))}S=gf.SDK_VERSION,Mr=S,gf._registerComponent(new v("firestore",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=new El(n,t.getProvider("auth-internal"));return e=Object.assign({useFetchStreams:!0},e),r._setSettings(e),r},"PUBLIC")),gf.registerVersion("@firebase/firestore","3.0.0-2021720181311",void 0);function $d(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr("invalid-argument",`Invalid options passed to function ${t}(): You cannot `+'specify both "merge" and "mergeFields".');return e}function Kd(){if("undefined"==typeof Uint8Array)throw new Vr("unimplemented","Uint8Arrays are not available in this environment.")}function Gd(){if("undefined"==typeof atob)throw new Vr("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Hd{constructor(t){this._delegate=t}static fromBase64String(t){return Gd(),new Hd(Rl.fromBase64String(t))}static fromUint8Array(t){return Kd(),new Hd(Rl.fromUint8Array(t))}toBase64(){return Gd(),this._delegate.toBase64()}toUint8Array(){return Kd(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function zd(t){return function(t,e){if("object"!=typeof t||null===t)return;var n=t;for(const r of e)if(r in n&&"function"==typeof n[r])return 1;return}(t,["next","error","complete"])}class Qd{enableIndexedDbPersistence(t,e){return function(t,e){xl(t=il(t,El));var n=Il(t),r=t._freezeSettings(),t=new Ac;return Sl(n,t,new _c(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return function(t){xl(t=il(t,El));var e=Il(t),n=t._freezeSettings(),t=new Ac;return Sl(e,t,new Sc(t,n.cacheSizeBytes))}(t._delegate)}clearIndexedDbPersistence(t){return function(t){if(t._initialized&&!t._terminated)throw new Vr(Fr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ua;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!da.gt())return Promise.resolve();t+="main";await da.delete(t)}(Ih(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}(t._delegate)}}class Wd{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof Hc||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||$r("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){ul(this._delegate,t,e,n)}enableNetwork(){return Dl(this._delegate)}disableNetwork(){return Nl(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,el("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Al(this._delegate)}onSnapshotsInSync(t){return Vd(this._delegate,t)}get app(){if(!this._appCompat)throw new Vr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new cf(this,fl(this._delegate,t))}catch(t){throw ef(t,"collection()","Firestore.collection()")}}doc(t){try{return new tf(this,gl(this._delegate,t))}catch(t){throw ef(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new af(this,function(t,e){if(t=il(t,hl),tl("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Vr(Fr.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ll(t,null,(e=e,new Js(rs.emptyPath(),e)))}(this._delegate,t))}catch(t){throw ef(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return jd(this._delegate,t=>e(new Xd(this,t)))}batch(){return Il(this._delegate),new Jd(new xd(this._delegate,t=>Ud(this._delegate,t)))}loadBundle(t){return e=this._delegate,n=t,r=Il(e=il(e,El)),t=new vl,Kc(r,e._databaseId,n,t),t;var e,n,r}namedQuery(t){return Cl(this._delegate,t).then(t=>t?new af(this,t):null)}}class Yd extends Dd{constructor(t){super(),this.firestore=t}convertBytes(t){return new Hd(new Rl(t))}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return tf.forKey(t,this.firestore,null)}}class Xd{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Yd(t)}get(t){const e=lf(t);return this._delegate.get(e).then(t=>new sf(this._firestore,new ld(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter)))}set(t,e,n){t=lf(t);return n?($d("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this}update(t,e,n,...r){t=lf(t);return 2===arguments.length?this._delegate.update(t,e):this._delegate.update(t,e,n,...r),this}delete(t){t=lf(t);return this._delegate.delete(t),this}}class Jd{constructor(t){this._delegate=t}set(t,e,n){t=lf(t);return n?($d("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this}update(t,e,n,...r){t=lf(t);return 2===arguments.length?this._delegate.update(t,e):this._delegate.update(t,e,n,...r),this}delete(t){t=lf(t);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Zd{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){t=new dd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new of(this._firestore,t),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=Zd.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let s=r.get(e);return s||(s=new Zd(t,new Yd(t),e),r.set(e,s)),s}}Zd.INSTANCES=new WeakMap;class tf{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Yd(t)}static forPath(t,e,n){if(t.length%2!=0)throw new Vr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${t.canonicalString()} has ${t.length}`);return new tf(e,new cl(e._delegate,n,new ys(t)))}static forKey(t,e,n){return new tf(e,new cl(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new cf(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new cf(this.firestore,fl(this._delegate,t))}catch(t){throw ef(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=y(t))instanceof cl&&ml(this._delegate,t)}set(t,e){e=$d("DocumentReference.set",e);try{return e?Md(this._delegate,t,e):Md(this._delegate,t)}catch(t){throw ef(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Pd(this._delegate,t):Pd(this._delegate,t,e,...n)}catch(t){throw ef(t,"updateDoc()","DocumentReference.update()")}}delete(){return Ud(il((t=this._delegate).firestore,El),[new Bi(t._key,Ci.none())]);var t}onSnapshot(...t){var e=nf(t),t=rf(t,t=>new sf(this.firestore,new ld(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter)));return Fd(this._delegate,e,t)}get(t){let e;return e=("cache"===(null==t?void 0:t.source)?Ld:"server"===(null==t?void 0:t.source)?function(e){e=il(e,cl);const n=il(e.firestore,El);return jc(Il(n),e._key,{source:"server"}).then(t=>qd(n,e,t))}:function(e){e=il(e,cl);const n=il(e.firestore,El);return jc(Il(n),e._key).then(t=>qd(n,e,t))})(this._delegate),e.then(t=>new sf(this.firestore,new ld(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter)))}withConverter(t){return new tf(this.firestore,t?this._delegate.withConverter(Zd.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function ef(t,e,n){return t.message=t.message.replace(e,n),t}function nf(t){for(const e of t)if("object"==typeof e&&!zd(e))return e;return{}}function rf(t,e){let n;return n=zd(t[0])?t[0]:zd(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{n.next&&n.next(e(t))},error:null===(t=n.error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}class sf{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new tf(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return gd(this._delegate,t._delegate)}}class of extends sf{data(t){t=this._delegate.data(t);return void 0!==t||Gr(),t}}class af{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Yd(t)}where(t,e,n){try{return new af(this.firestore,yd(this._delegate,(r=t,s=e,i=n,r=ud("where",t),new wd(r,s,i))))}catch(t){throw ef(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(t,e){try{return new af(this.firestore,yd(this._delegate,([n,r="asc"]=[t,e],n=ud("orderBy",n),new vd(n,r))))}catch(t){throw ef(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r}limit(t){try{return new af(this.firestore,yd(this._delegate,(ol("limit",e=t),new bd("limit",e,"F"))))}catch(t){throw ef(t,"limit()","Query.limit()")}var e}limitToLast(t){try{return new af(this.firestore,yd(this._delegate,(ol("limitToLast",e=t),new bd("limitToLast",e,"L"))))}catch(t){throw ef(t,"limitToLast()","Query.limitToLast()")}var e}startAt(...t){try{return new af(this.firestore,yd(this._delegate,function(...t){return new Td("startAt",t,!0)}(...t)))}catch(t){throw ef(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new af(this.firestore,yd(this._delegate,function(...t){return new Td("startAfter",t,!1)}(...t)))}catch(t){throw ef(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new af(this.firestore,yd(this._delegate,function(...t){return new Ed("endBefore",t,!0)}(...t)))}catch(t){throw ef(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new af(this.firestore,yd(this._delegate,function(...t){return new Ed("endAt",t,!1)}(...t)))}catch(t){throw ef(t,"endAt()","Query.endAt()")}}isEqual(t){return pl(this._delegate,t._delegate)}get(t){let e;return e=("cache"===(null==t?void 0:t.source)?Od:"server"===(null==t?void 0:t.source)?function(e){e=il(e,ll);const n=il(e.firestore,El),t=Il(n),r=new Rd(n);return $c(t,e._query,{source:"server"}).then(t=>new fd(n,r,e,t))}:function(e){e=il(e,ll);const n=il(e.firestore,El),t=Il(n),r=new Rd(n);return md(e._query),$c(t,e._query).then(t=>new fd(n,r,e,t))})(this._delegate),e.then(t=>new uf(this.firestore,new fd(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot)))}onSnapshot(...t){var e=nf(t),t=rf(t,t=>new uf(this.firestore,new fd(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot)));return Fd(this._delegate,e,t)}withConverter(t){return new af(this.firestore,t?this._delegate.withConverter(Zd.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class hf{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new of(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class uf{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new af(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new of(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(t=>new hf(this._firestore,t))}forEach(e,n){this._delegate.forEach(t=>{e.call(n,new of(this._firestore,t))})}isEqual(t){return gd(this._delegate,t._delegate)}}class cf extends af{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var t=this._delegate.parent;return t?new tf(this.firestore,t):null}doc(t){try{return void 0===t?new tf(this.firestore,gl(this._delegate)):new tf(this.firestore,gl(this._delegate,t))}catch(t){throw ef(t,"doc()","CollectionReference.doc()")}}add(t){return function(t,e){const n=il(t.firestore,El),r=gl(t),s=Nd(t.converter,e);return Ud(n,[jl(Bl(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,Ci.exists(!1))]).then(()=>r)}(this._delegate,t).then(t=>new tf(this.firestore,t))}isEqual(t){return ml(this._delegate,t._delegate)}withConverter(t){return new cf(this.firestore,t?this._delegate.withConverter(Zd.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function lf(t){return il(t,cl)}const df={Firestore:Wd,GeoPoint:Ol,Timestamp:Xr,Blob:Hd,Transaction:Xd,WriteBatch:Jd,DocumentReference:tf,DocumentSnapshot:sf,Query:af,QueryDocumentSnapshot:of,QuerySnapshot:uf,CollectionReference:cf,FieldPath:class t{constructor(...t){this._delegate=new kl(...t)}static documentId(){return new t(is.keyField().canonicalString())}isEqual(t){return(t=y(t))instanceof kl&&this._delegate._internalPath.isEqual(t._internalPath)}},FieldValue:class n{constructor(t){this._delegate=t}static serverTimestamp(){const t=new Gl("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new n(t)}static delete(){const t=new $l("deleteField");return t._methodName="FieldValue.delete",new n(t)}static arrayUnion(...t){const e=function(...t){return new Hl("arrayUnion",t)}(...t);return e._methodName="FieldValue.arrayUnion",new n(e)}static arrayRemove(...t){const e=function(...t){return new zl("arrayRemove",t)}(...t);return e._methodName="FieldValue.arrayRemove",new n(e)}static increment(t){const e=new Ql("increment",t);return e._methodName="FieldValue.increment",new n(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}},setLogLevel:function(t){t=t,Ur.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};bl=e.default,Tl=(t,e)=>new Wd(t,e,new Qd),bl.INTERNAL.registerComponent(new v("firestore-compat",t=>{var e=t.getProvider("app-compat").getImmediate(),t=t.getProvider("firestore").getImmediate();return Tl(e,t)},"PUBLIC").setServiceProps(Object.assign({},df))),bl.registerVersion("@firebase/firestore-compat","0.1.0-2021720181311")}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore-compat.js.map
